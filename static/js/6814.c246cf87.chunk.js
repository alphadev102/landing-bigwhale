"use strict";(self.webpackChunkonboard_notify_react=self.webpackChunkonboard_notify_react||[]).push([[6814],{96039:function(e,t,n){n.d(t,{d:function(){return v}});var r=n(53755),i=n(47061),s=n(59900),o=n(14771),a=n(24269),c=n(24593),u=n(70886),h=n(20240),p=n(88047),d=n.n(p),l=n(46622);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,c.Z)(this,n)}}var v=function(e){(0,a.Z)(n,e);var t=f(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.Z)(this,n),e=t.call(this),(0,h.Z)((0,o.Z)(e),"clientId",void 0),e.clientId=r.clientId,e}return(0,s.Z)(n,[{key:"authenticateUser",value:function(){var e=(0,r.Z)(d().mark((function e(){var t,n,r,i,s,o,a,c,u,h;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.provider&&null!==(t=this.chainConfig)&&void 0!==t&&t.chainId){e.next=2;break}throw l.WalletLoginError.notConnectedError();case 2:if(n=this.chainConfig,r=n.chainNamespace,i=n.chainId,this.status===l.ADAPTER_STATUS.CONNECTED){e.next=5;break}throw l.WalletLoginError.notConnectedError("Not connected with wallet, Please login/connect first");case 5:return e.next=7,this.provider.request({method:"eth_accounts"});case 7:if(!((s=e.sent)&&s.length>0)){e.next=26;break}if(!(o=(0,l.getSavedToken)(s[0],this.name))){e.next=14;break}if((0,l.checkIfTokenIsExpired)(o)){e.next=14;break}return e.abrupt("return",{idToken:o});case 14:return a={domain:window.location.origin,uri:window.location.href,address:s[0],chainId:parseInt(i,16),version:"1",nonce:Math.random().toString(36).slice(2),issuedAt:(new Date).toISOString()},e.next=17,(0,l.signChallenge)(a,r);case 17:return c=e.sent,e.next=20,this.provider.request({method:"personal_sign",params:[c,s[0]]});case 20:return u=e.sent,e.next=23,(0,l.verifySignedChallenge)(r,u,c,this.name,this.sessionTime,this.clientId);case 23:return h=e.sent,(0,l.saveToken)(s[0],this.name,h),e.abrupt("return",{idToken:h});case 26:throw l.WalletLoginError.notConnectedError("Not connected with wallet, Please login/connect first");case 27:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e=(0,r.Z)(d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.status===l.ADAPTER_STATUS.CONNECTED){e.next=2;break}throw l.WalletLoginError.disconnectionError("Not connected with wallet");case 2:return e.next=4,this.provider.request({method:"eth_accounts"});case 4:(t=e.sent)&&t.length>0&&(0,l.clearToken)(t[0],this.name);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(l.BaseAdapter)},66814:function(e,t,n){n.r(t),n.d(t,{WalletConnectV1Adapter:function(){return Et}});var r={};n.r(r),n.d(r,{decrypt:function(){return ft},encrypt:function(){return dt},generateKey:function(){return ct},verifyHmac:function(){return ht}});var i=n(53755),s=n(47061),o=n(59900),a=n(14771),c=n(12731),u=n(24269),h=n(24593),p=n(70886),d=n(20240),l=n(88047),f=n.n(l),v=n(38114),g=n(24611),_=n(19961),k=n(64731),y=n(87239),w=n(67330);function m(e){return(0,w.qY)(e)}function b(){var e=m();return e&&e.os?e.os:void 0}function E(){return!!b()&&(function(){var e=b();return!!e&&e.toLowerCase().includes("android")}()||function(){var e=b();return!!e&&(e.toLowerCase().includes("ios")||e.toLowerCase().includes("mac")&&navigator.maxTouchPoints>1)}())}function S(){return!function(){var e=m();return!(!e||!e.name)&&"node"===e.name.toLowerCase()}()&&!!I()}y.getFromWindow,y.getFromWindowOrThrow,y.getDocumentOrThrow,y.getDocument,y.getNavigatorOrThrow;var I=y.getNavigator,x=(y.getLocationOrThrow,y.getLocation),T=(y.getCryptoOrThrow,y.getCrypto,y.getLocalStorageOrThrow,y.getLocalStorage);function R(){return k.D()}var Z=n(35297),C=Z.D,A=Z.u;function O(e){var t=null,n=T();return n&&(t=n.getItem(e)),t?C(t):t}function M(e){var t=T();t&&t.removeItem(e)}var N="WALLETCONNECT_DEEPLINK_CHOICE";var P=["session_request","session_update","exchange_key","connect","disconnect","display_uri","modal_closed","transport_open","transport_close","transport_error"],q=["eth_sendTransaction","eth_signTransaction","eth_sign","eth_signTypedData","eth_signTypedData_v1","eth_signTypedData_v2","eth_signTypedData_v3","eth_signTypedData_v4","personal_sign","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],D=n(45081),W=n.n(D),L=(n(6279),n(48179)),U=n.n(L),j=n(30261).Buffer,V="hex",J="utf8",H="0";function z(e){return new Uint8Array(e)}function Y(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.toString(V);return t?ae(n):n}function F(e){return e.toString(J)}function B(e){return U()(e)}function Q(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Y(B(e),t)}function K(e){return F(B(e))}function G(e){return j.from(oe(e),V)}function $(e){return z(G(e))}function X(e){return j.from(e,J)}function ee(e){return z(X(e))}function te(e,t){return!("string"!==typeof e||!e.match(/^0x[0-9A-Fa-f]*$/))&&(!t||e.length===2+2*t)}function ne(){for(var e=[],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){return e=e.concat(Array.from(t))})),new Uint8Array((0,_.Z)(e))}function re(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=e%t;return n?(e-n)/t*t+t:e}function ie(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H;return se(e,re(e.length,t),n)}function se(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:H;return ue(e,t,!0,n)}function oe(e){return e.replace(/^0x/,"")}function ae(e){return e.startsWith("0x")?e:"0x".concat(e)}function ce(e){return(e=ie(e=oe(e),2))&&(e=ae(e)),e}function ue(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:H,i=t-e.length,s=e;if(i>0){var o=r.repeat(i);s=n?o+e:e+o}return s}function he(e){return B(new Uint8Array(e))}function pe(e){return z(e).buffer}function de(e,t){return function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Y(X(e),t)}(e,!t)}function le(e,t){var n=oe(ce(new(W())(e).toString(16)));return t?n:ae(n)}var fe=n(75502);function ve(e){return ce(e)}function ge(e){return function(e){var t=e.startsWith("0x");return e=(e=oe(e)).startsWith(H)?e.substring(1):e,t?ae(e):e}(ae(e))}var _e=n(55521).payloadId;function ke(){return function(e,t){for(t=e="";e++<36;t+=51*e&52?(15^e?8^Math.random()*(20^e?16:4):4).toString(16):"-");return t}()}function ye(e,t){return te(e,t)}function we(e){return"undefined"!==typeof e.result}function me(e){return"undefined"!==typeof e.error}function be(e){return"undefined"!==typeof e.event}function Ee(e){return!!e.method.startsWith("wc_")||!q.includes(e.method)}function Se(e){e=oe(e.toLowerCase());for(var t=oe((0,fe.keccak_256)(X(e))),n="",r=0;r<e.length;r++)parseInt(t[r],16)>7?n+=e[r].toUpperCase():n+=e[r];return ae(n)}function Ie(e){var t;return(t=e)&&t.length&&!ye(e[0])&&(e[0]=de(e[0])),e}function xe(e){if("undefined"!==typeof e.type&&"0"!==e.type)return e;if("undefined"===typeof e.from||(!(t=e.from)||"0x"!==t.toLowerCase().substring(0,2)||!/^(0x)?[0-9a-f]{40}$/i.test(t)||!/^(0x)?[0-9a-f]{40}$/.test(t)&&!/^(0x)?[0-9A-F]{40}$/.test(t)&&t!==Se(t)))throw new Error("Transaction object must include a valid 'from' value.");var t;function n(e){var t=e;return("number"===typeof e||"string"===typeof e&&!function(e){return""===e||"string"===typeof e&&""===e.trim()}(e))&&(ye(e)?"string"===typeof e&&(t=ve(e)):t=le(e)),"string"===typeof t&&(t=ge(t)),t}var r={from:ve(e.from),to:"undefined"===typeof e.to?void 0:ve(e.to),gasPrice:"undefined"===typeof e.gasPrice?"":n(e.gasPrice),gas:"undefined"===typeof e.gas?"undefined"===typeof e.gasLimit?"":n(e.gasLimit):n(e.gas),value:"undefined"===typeof e.value?"":n(e.value),nonce:"undefined"===typeof e.nonce?"":n(e.nonce),data:"undefined"===typeof e.data?"":ve(e.data)||"0x"},i=["gasPrice","gas","value","nonce"];return Object.keys(r).forEach((function(e){("undefined"===typeof r[e]||"string"===typeof r[e]&&!r[e].trim().length)&&i.includes(e)&&delete r[e]})),r}var Te=n(21957);function Re(e,t){var n=Ze(e);return e=function(e){return Te.stringify(e)}(n=Object.assign(Object.assign({},n),t))}function Ze(e){return Te.parse(e)}var Ce=function(){function e(){var t=this;(0,s.Z)(this,e),this._eventEmitters=[],"undefined"!==typeof window&&"undefined"!==typeof window.addEventListener&&(window.addEventListener("online",(function(){return t.trigger("online")})),window.addEventListener("offline",(function(){return t.trigger("offline")})))}return(0,o.Z)(e,[{key:"on",value:function(e,t){this._eventEmitters.push({event:e,callback:t})}},{key:"trigger",value:function(e){var t=[];e&&(t=this._eventEmitters.filter((function(t){return t.event===e}))),t.forEach((function(e){e.callback()}))}}]),e}(),Ae="undefined"!==typeof n.g.WebSocket?n.g.WebSocket:n(22607),Oe=function(){function e(t){var n=this;if((0,s.Z)(this,e),this.opts=t,this._queue=[],this._events=[],this._subscriptions=[],this._protocol=t.protocol,this._version=t.version,this._url="",this._netMonitor=null,this._socket=null,this._nextSocket=null,this._subscriptions=t.subscriptions||[],this._netMonitor=t.netMonitor||new Ce,!t.url||"string"!==typeof t.url)throw new Error("Missing or invalid WebSocket url");this._url=t.url,this._netMonitor.on("online",(function(){return n._socketCreate()}))}return(0,o.Z)(e,[{key:"readyState",get:function(){return this._socket?this._socket.readyState:-1},set:function(e){}},{key:"connecting",get:function(){return 0===this.readyState},set:function(e){}},{key:"connected",get:function(){return 1===this.readyState},set:function(e){}},{key:"closing",get:function(){return 2===this.readyState},set:function(e){}},{key:"closed",get:function(){return 3===this.readyState},set:function(e){}},{key:"open",value:function(){this._socketCreate()}},{key:"close",value:function(){this._socketClose()}},{key:"send",value:function(e,t,n){if(!t||"string"!==typeof t)throw new Error("Missing or invalid topic field");this._socketSend({topic:t,type:"pub",payload:e,silent:!!n})}},{key:"subscribe",value:function(e){this._socketSend({topic:e,type:"sub",payload:"",silent:!0})}},{key:"on",value:function(e,t){this._events.push({event:e,callback:t})}},{key:"_socketCreate",value:function(){var e=this;if(!this._nextSocket){var t=function(e,t,n){var r,i,s=e.startsWith("https")?e.replace("https","wss"):e.startsWith("http")?e.replace("http","ws"):e,o=s.split("?"),a=S()?{protocol:t,version:n,env:"browser",host:(null===(r=x())||void 0===r?void 0:r.host)||""}:{protocol:t,version:n,env:(null===(i=m())||void 0===i?void 0:i.name)||""},c=Re(function(e){var t=-1!==e.indexOf("?")?e.indexOf("?"):void 0;return"undefined"!==typeof t?e.substr(t):""}(o[1]||""),a);return o[0]+"?"+c}(this._url,this._protocol,this._version);if(this._nextSocket=new Ae(t),!this._nextSocket)throw new Error("Failed to create socket");this._nextSocket.onmessage=function(t){return e._socketReceive(t)},this._nextSocket.onopen=function(){return e._socketOpen()},this._nextSocket.onerror=function(t){return e._socketError(t)},this._nextSocket.onclose=function(){setTimeout((function(){e._nextSocket=null,e._socketCreate()}),1e3)}}}},{key:"_socketOpen",value:function(){this._socketClose(),this._socket=this._nextSocket,this._nextSocket=null,this._queueSubscriptions(),this._pushQueue()}},{key:"_socketClose",value:function(){this._socket&&(this._socket.onclose=function(){},this._socket.close())}},{key:"_socketSend",value:function(e){var t=JSON.stringify(e);this._socket&&1===this._socket.readyState?this._socket.send(t):(this._setToQueue(e),this._socketCreate())}},{key:"_socketReceive",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t){var n,r;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=JSON.parse(t.data),e.next=7;break;case 4:return e.prev=4,e.t0=e.catch(0),e.abrupt("return");case 7:this._socketSend({topic:n.topic,type:"ack",payload:"",silent:!0}),this._socket&&1===this._socket.readyState&&(r=this._events.filter((function(e){return"message"===e.event})),r&&r.length&&r.forEach((function(e){return e.callback(n)})));case 9:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_socketError",value:function(e){var t=this._events.filter((function(e){return"error"===e.event}));t&&t.length&&t.forEach((function(t){return t.callback(e)}))}},{key:"_queueSubscriptions",value:function(){var e=this;this._subscriptions.forEach((function(t){return e._queue.push({topic:t,type:"sub",payload:"",silent:!0})})),this._subscriptions=this.opts.subscriptions||[]}},{key:"_setToQueue",value:function(e){this._queue.push(e)}},{key:"_pushQueue",value:function(){var e=this;this._queue.forEach((function(t){return e._socketSend(t)})),this._queue=[]}}]),e}();var Me=Oe,Ne="Session currently connected",Pe="Session currently disconnected",qe="JSON RPC response format is invalid",De="User close QRCode Modal",We=function(){function e(){(0,s.Z)(this,e),this._eventEmitters=[]}return(0,o.Z)(e,[{key:"subscribe",value:function(e){this._eventEmitters.push(e)}},{key:"unsubscribe",value:function(e){this._eventEmitters=this._eventEmitters.filter((function(t){return t.event!==e}))}},{key:"trigger",value:function(e){var t,n=[];(t="undefined"!==typeof e.method?e.method:we(e)||me(e)?"response:".concat(e.id):be(e)?e.event:"")&&(n=this._eventEmitters.filter((function(e){return e.event===t}))),n&&n.length||function(e){return P.includes(e)||e.startsWith("wc_")}(t)||be(t)||(n=this._eventEmitters.filter((function(e){return"call_request"===e.event}))),n.forEach((function(t){if(me(e)){var n=new Error(e.error.message);t.callback(n,null)}else t.callback(null,e)}))}}]),e}(),Le=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"walletconnect";(0,s.Z)(this,e),this.storageId=t}return(0,o.Z)(e,[{key:"getSession",value:function(){var e=null,t=O(this.storageId);return t&&"undefined"!==typeof t.bridge&&(e=t),e}},{key:"setSession",value:function(e){return function(e,t){var n=A(t),r=T();r&&r.setItem(e,n)}(this.storageId,e),e}},{key:"removeSession",value:function(){M(this.storageId)}}]),e}(),Ue=Le,je="abcdefghijklmnopqrstuvwxyz0123456789".split("").map((function(e){return"https://".concat(e,".bridge.walletconnect.org")}));function Ve(){return je[Math.floor(Math.random()*je.length)]}var Je=function(){function e(t){if((0,s.Z)(this,e),this.protocol="wc",this.version=1,this._bridge="",this._key=null,this._clientId="",this._clientMeta=null,this._peerId="",this._peerMeta=null,this._handshakeId=0,this._handshakeTopic="",this._connected=!1,this._accounts=[],this._chainId=0,this._networkId=0,this._rpcUrl="",this._eventManager=new We,this._clientMeta=R()||t.connectorOpts.clientMeta||null,this._cryptoLib=t.cryptoLib,this._sessionStorage=t.sessionStorage||new Ue(t.connectorOpts.storageId),this._qrcodeModal=t.connectorOpts.qrcodeModal,this._qrcodeModalOptions=t.connectorOpts.qrcodeModalOptions,this._signingMethods=[].concat((0,_.Z)(q),(0,_.Z)(t.connectorOpts.signingMethods||[])),!t.connectorOpts.bridge&&!t.connectorOpts.uri&&!t.connectorOpts.session)throw new Error("Missing one of the required parameters: bridge / uri / session");var n;t.connectorOpts.bridge&&(this.bridge=function(e){return"walletconnect.org"===function(e){return function(e){var t=e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0];return(t=t.split(":")[0]).split("?")[0]}(e).split(".").slice(-2).join(".")}(e)}(n=t.connectorOpts.bridge)?Ve():n),t.connectorOpts.uri&&(this.uri=t.connectorOpts.uri);var r=t.connectorOpts.session||this._getStorageSession();r&&(this.session=r),this.handshakeId&&this._subscribeToSessionResponse(this.handshakeId,"Session request rejected"),this._transport=t.transport||new Me({protocol:this.protocol,version:this.version,url:this.bridge,subscriptions:[this.clientId]}),this._subscribeToInternalEvents(),this._initTransport(),t.connectorOpts.uri&&this._subscribeToSessionRequest(),t.pushServerOpts&&this._registerPushServer(t.pushServerOpts)}return(0,o.Z)(e,[{key:"bridge",get:function(){return this._bridge},set:function(e){e&&(this._bridge=e)}},{key:"key",get:function(){var e,t;return this._key?(e=this._key,t=!0,Q(new Uint8Array(e),!t)):""},set:function(e){if(e){var t=$(e).buffer;this._key=t}}},{key:"clientId",get:function(){var e=this._clientId;return e||(e=this._clientId=ke()),this._clientId},set:function(e){e&&(this._clientId=e)}},{key:"peerId",get:function(){return this._peerId},set:function(e){e&&(this._peerId=e)}},{key:"clientMeta",get:function(){var e=this._clientMeta;return e||(e=this._clientMeta=R()),e},set:function(e){}},{key:"peerMeta",get:function(){return this._peerMeta},set:function(e){this._peerMeta=e}},{key:"handshakeTopic",get:function(){return this._handshakeTopic},set:function(e){e&&(this._handshakeTopic=e)}},{key:"handshakeId",get:function(){return this._handshakeId},set:function(e){e&&(this._handshakeId=e)}},{key:"uri",get:function(){return this._formatUri()},set:function(e){if(e){var t=this._parseUri(e),n=t.handshakeTopic,r=t.bridge,i=t.key;this.handshakeTopic=n,this.bridge=r,this.key=i}}},{key:"chainId",get:function(){return this._chainId},set:function(e){this._chainId=e}},{key:"networkId",get:function(){return this._networkId},set:function(e){this._networkId=e}},{key:"accounts",get:function(){return this._accounts},set:function(e){this._accounts=e}},{key:"rpcUrl",get:function(){return this._rpcUrl},set:function(e){this._rpcUrl=e}},{key:"connected",get:function(){return this._connected},set:function(e){}},{key:"pending",get:function(){return!!this._handshakeTopic},set:function(e){}},{key:"session",get:function(){return{connected:this.connected,accounts:this.accounts,chainId:this.chainId,bridge:this.bridge,key:this.key,clientId:this.clientId,clientMeta:this.clientMeta,peerId:this.peerId,peerMeta:this.peerMeta,handshakeId:this.handshakeId,handshakeTopic:this.handshakeTopic}},set:function(e){e&&(this._connected=e.connected,this.accounts=e.accounts,this.chainId=e.chainId,this.bridge=e.bridge,this.key=e.key,this.clientId=e.clientId,this.clientMeta=e.clientMeta,this.peerId=e.peerId,this.peerMeta=e.peerMeta,this.handshakeId=e.handshakeId,this.handshakeTopic=e.handshakeTopic)}},{key:"on",value:function(e,t){var n={event:e,callback:t};this._eventManager.subscribe(n)}},{key:"off",value:function(e){this._eventManager.unsubscribe(e)}},{key:"createInstantRequest",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t){var n,r,i,s=this;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._generateKey();case 2:return this._key=e.sent,n=this._formatRequest({method:"wc_instantRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,request:this._formatRequest(t)}]}),this.handshakeId=n.id,this.handshakeTopic=ke(),this._eventManager.trigger({event:"display_uri",params:[this.uri]}),this.on("modal_closed",(function(){throw new Error(De)})),r=function(){s.killSession()},e.prev=9,e.next=12,this._sendCallRequest(n);case 12:return(i=e.sent)&&r(),e.abrupt("return",i);case 17:throw e.prev=17,e.t0=e.catch(9),r(),e.t0;case 21:case"end":return e.stop()}}),e,this,[[9,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"connect",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t){var n=this;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._qrcodeModal){e.next=2;break}throw new Error("QRCode Modal not provided");case 2:if(!this.connected){e.next=4;break}return e.abrupt("return",{chainId:this.chainId,accounts:this.accounts});case 4:return e.next=6,this.createSession(t);case 6:return e.abrupt("return",new Promise(function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t,r){return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.on("modal_closed",(function(){return r(new Error(De))})),n.on("connect",(function(e,n){if(e)return r(e);t(n.params[0])}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSession",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t){var n;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._connected){e.next=2;break}throw new Error(Ne);case 2:if(!this.pending){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this._generateKey();case 6:this._key=e.sent,n=this._formatRequest({method:"wc_sessionRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,chainId:t&&t.chainId?t.chainId:null}]}),this.handshakeId=n.id,this.handshakeTopic=ke(),this._sendSessionRequest(n,"Session update rejected",{topic:this.handshakeTopic}),this._eventManager.trigger({event:"display_uri",params:[this.uri]});case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"approveSession",value:function(e){if(this._connected)throw new Error(Ne);this.chainId=e.chainId,this.accounts=e.accounts,this.networkId=e.networkId||0,this.rpcUrl=e.rpcUrl||"";var t={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl,peerId:this.clientId,peerMeta:this.clientMeta},n={id:this.handshakeId,jsonrpc:"2.0",result:t};this._sendResponse(n),this._connected=!0,this._setStorageSession(),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})}},{key:"rejectSession",value:function(e){if(this._connected)throw new Error(Ne);var t=e&&e.message?e.message:"Session Rejected",n=this._formatResponse({id:this.handshakeId,error:{message:t}});this._sendResponse(n),this._connected=!1,this._eventManager.trigger({event:"disconnect",params:[{message:t}]}),this._removeStorageSession()}},{key:"updateSession",value:function(e){if(!this._connected)throw new Error(Pe);this.chainId=e.chainId,this.accounts=e.accounts,this.networkId=e.networkId||0,this.rpcUrl=e.rpcUrl||"";var t={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl},n=this._formatRequest({method:"wc_sessionUpdate",params:[t]});this._sendSessionRequest(n,"Session update rejected"),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]}),this._manageStorageSession()}},{key:"killSession",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t){var n,r,i;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?t.message:"Session Disconnected",r={approved:!1,chainId:null,networkId:null,accounts:null},i=this._formatRequest({method:"wc_sessionUpdate",params:[r]}),e.next=5,this._sendRequest(i);case 5:this._handleSessionDisconnect(n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendTransaction",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t){var n,r,i;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._connected){e.next=2;break}throw new Error(Pe);case 2:return n=xe(t),r=this._formatRequest({method:"eth_sendTransaction",params:[n]}),e.next=6,this._sendCallRequest(r);case 6:return i=e.sent,e.abrupt("return",i);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signTransaction",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t){var n,r,i;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._connected){e.next=2;break}throw new Error(Pe);case 2:return n=xe(t),r=this._formatRequest({method:"eth_signTransaction",params:[n]}),e.next=6,this._sendCallRequest(r);case 6:return i=e.sent,e.abrupt("return",i);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signMessage",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t){var n,r;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._connected){e.next=2;break}throw new Error(Pe);case 2:return n=this._formatRequest({method:"eth_sign",params:t}),e.next=5,this._sendCallRequest(n);case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signPersonalMessage",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t){var n,r;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._connected){e.next=2;break}throw new Error(Pe);case 2:return t=Ie(t),n=this._formatRequest({method:"personal_sign",params:t}),e.next=6,this._sendCallRequest(n);case 6:return r=e.sent,e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signTypedData",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t){var n,r;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._connected){e.next=2;break}throw new Error(Pe);case 2:return n=this._formatRequest({method:"eth_signTypedData",params:t}),e.next=5,this._sendCallRequest(n);case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateChain",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t){var n,r;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._connected){e.next=2;break}throw new Error("Session currently disconnected");case 2:return n=this._formatRequest({method:"wallet_updateChain",params:[t]}),e.next=5,this._sendCallRequest(n);case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unsafeSend",value:function(e,t){var n=this;return this._sendRequest(e,t),this._eventManager.trigger({event:"call_request_sent",params:[{request:e,options:t}]}),new Promise((function(t,r){n._subscribeToResponse(e.id,(function(e,n){if(e)r(e);else{if(!n)throw new Error("Missing JSON RPC response");t(n)}}))}))}},{key:"sendCustomRequest",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t,n){var r,i;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._connected){e.next=2;break}throw new Error(Pe);case 2:e.t0=t.method,e.next="eth_accounts"===e.t0?5:"eth_chainId"===e.t0?6:"eth_sendTransaction"===e.t0||"eth_signTransaction"===e.t0?7:"personal_sign"===e.t0?9:11;break;case 5:return e.abrupt("return",this.accounts);case 6:return e.abrupt("return",le(this.chainId));case 7:return t.params&&(t.params[0]=xe(t.params[0])),e.abrupt("break",12);case 9:return t.params&&(t.params=Ie(t.params)),e.abrupt("break",12);case 11:return e.abrupt("break",12);case 12:return r=this._formatRequest(t),e.next=15,this._sendCallRequest(r,n);case 15:return i=e.sent,e.abrupt("return",i);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"approveRequest",value:function(e){if(!we(e))throw new Error('JSON-RPC success response must include "result" field');var t=this._formatResponse(e);this._sendResponse(t)}},{key:"rejectRequest",value:function(e){if(!me(e))throw new Error('JSON-RPC error response must include "error" field');var t=this._formatResponse(e);this._sendResponse(t)}},{key:"transportClose",value:function(){this._transport.close()}},{key:"_sendRequest",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t,n){var r,i,s,o,a;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._formatRequest(t),e.next=3,this._encrypt(r);case 3:i=e.sent,s="undefined"!==typeof(null===n||void 0===n?void 0:n.topic)?n.topic:this.peerId,o=JSON.stringify(i),a="undefined"!==typeof(null===n||void 0===n?void 0:n.forcePushNotification)?!n.forcePushNotification:Ee(r),this._transport.send(o,s,a);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_sendResponse",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t){var n,r,i;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._encrypt(t);case 2:n=e.sent,r=this.peerId,i=JSON.stringify(n),!0,this._transport.send(i,r,true);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_sendSessionRequest",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t,n,r){return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._sendRequest(t,r),this._subscribeToSessionResponse(t.id,n);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_sendCallRequest",value:function(e,t){return this._sendRequest(e,t),this._eventManager.trigger({event:"call_request_sent",params:[{request:e,options:t}]}),this._subscribeToCallResponse(e.id)}},{key:"_formatRequest",value:function(e){if("undefined"===typeof e.method)throw new Error('JSON RPC request must have valid "method" value');return{id:"undefined"===typeof e.id?_e():e.id,jsonrpc:"2.0",method:e.method,params:"undefined"===typeof e.params?[]:e.params}}},{key:"_formatResponse",value:function(e){if("undefined"===typeof e.id)throw new Error('JSON RPC request must have valid "id" value');var t={id:e.id,jsonrpc:"2.0"};if(me(e)){var n=function(e){var t=e.message||"Failed or Rejected Request",n=-32e3;if(e&&!e.code)switch(t){case"Parse error":n=-32700;break;case"Invalid request":n=-32600;break;case"Method not found":n=-32601;break;case"Invalid params":n=-32602;break;case"Internal error":n=-32603;break;default:n=-32e3}var r={code:n,message:t};return e.data&&(r.data=e.data),r}(e.error);return Object.assign(Object.assign(Object.assign({},t),e),{error:n})}if(we(e))return Object.assign(Object.assign({},t),e);throw new Error(qe)}},{key:"_handleSessionDisconnect",value:function(e){var t=e||"Session Disconnected";this._connected||(this._qrcodeModal&&this._qrcodeModal.close(),M(N)),this._connected&&(this._connected=!1),this._handshakeId&&(this._handshakeId=0),this._handshakeTopic&&(this._handshakeTopic=""),this._peerId&&(this._peerId=""),this._eventManager.trigger({event:"disconnect",params:[{message:t}]}),this._removeStorageSession(),this.transportClose()}},{key:"_handleSessionResponse",value:function(e,t){t&&t.approved?(this._connected?(t.chainId&&(this.chainId=t.chainId),t.accounts&&(this.accounts=t.accounts),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]})):(this._connected=!0,t.chainId&&(this.chainId=t.chainId),t.accounts&&(this.accounts=t.accounts),t.peerId&&!this.peerId&&(this.peerId=t.peerId),t.peerMeta&&!this.peerMeta&&(this.peerMeta=t.peerMeta),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})),this._manageStorageSession()):this._handleSessionDisconnect(e)}},{key:"_handleIncomingMessages",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t){var n,r;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if([this.clientId,this.handshakeTopic].includes(t.topic)){e.next=3;break}return e.abrupt("return");case 3:e.prev=3,n=JSON.parse(t.payload),e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(3),e.abrupt("return");case 10:return e.next=12,this._decrypt(n);case 12:(r=e.sent)&&this._eventManager.trigger(r);case 14:case"end":return e.stop()}}),e,this,[[3,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_subscribeToSessionRequest",value:function(){this._transport.subscribe(this.handshakeTopic)}},{key:"_subscribeToResponse",value:function(e,t){this.on("response:".concat(e),t)}},{key:"_subscribeToSessionResponse",value:function(e,t){var n=this;this._subscribeToResponse(e,(function(e,r){e?n._handleSessionResponse(e.message):we(r)?n._handleSessionResponse(t,r.result):r.error&&r.error.message?n._handleSessionResponse(r.error.message):n._handleSessionResponse(t)}))}},{key:"_subscribeToCallResponse",value:function(e){var t=this;return new Promise((function(n,r){t._subscribeToResponse(e,(function(e,t){e?r(e):we(t)?n(t.result):t.error&&t.error.message?r(t.error):r(new Error(qe))}))}))}},{key:"_subscribeToInternalEvents",value:function(){var e=this;this.on("display_uri",(function(){e._qrcodeModal&&e._qrcodeModal.open(e.uri,(function(){e._eventManager.trigger({event:"modal_closed",params:[]})}),e._qrcodeModalOptions)})),this.on("connect",(function(){e._qrcodeModal&&e._qrcodeModal.close()})),this.on("call_request_sent",(function(t,n){var r=n.params[0].request;if(E()&&e._signingMethods.includes(r.method)){var i=O(N);i&&(window.location.href=i.href)}})),this.on("wc_sessionRequest",(function(t,n){t&&e._eventManager.trigger({event:"error",params:[{code:"SESSION_REQUEST_ERROR",message:t.toString()}]}),e.handshakeId=n.id,e.peerId=n.params[0].peerId,e.peerMeta=n.params[0].peerMeta;var r=Object.assign(Object.assign({},n),{method:"session_request"});e._eventManager.trigger(r)})),this.on("wc_sessionUpdate",(function(t,n){t&&e._handleSessionResponse(t.message),e._handleSessionResponse("Session disconnected",n.params[0])}))}},{key:"_initTransport",value:function(){var e=this;this._transport.on("message",(function(t){return e._handleIncomingMessages(t)})),this._transport.on("open",(function(){return e._eventManager.trigger({event:"transport_open",params:[]})})),this._transport.on("close",(function(){return e._eventManager.trigger({event:"transport_close",params:[]})})),this._transport.on("error",(function(){return e._eventManager.trigger({event:"transport_error",params:["Websocket connection failed"]})})),this._transport.open()}},{key:"_formatUri",value:function(){var e=this.protocol,t=this.handshakeTopic,n=this.version,r=encodeURIComponent(this.bridge),i=this.key;return"".concat(e,":").concat(t,"@").concat(n,"?bridge=").concat(r,"&key=").concat(i)}},{key:"_parseUri",value:function(e){var t=function(e){var t=e.indexOf(":"),n=-1!==e.indexOf("?")?e.indexOf("?"):void 0,r=e.substring(0,t),i=function(e){var t=e.split("@");return{handshakeTopic:t[0],version:parseInt(t[1],10)}}(e.substring(t+1,n)),s=function(e){var t=Ze(e);return{key:t.key||"",bridge:t.bridge||""}}("undefined"!==typeof n?e.substr(n):"");return Object.assign(Object.assign({protocol:r},i),s)}(e);if(t.protocol===this.protocol){if(!t.handshakeTopic)throw Error("Invalid or missing handshakeTopic parameter value");var n=t.handshakeTopic;if(!t.bridge)throw Error("Invalid or missing bridge url parameter value");var r=decodeURIComponent(t.bridge);if(!t.key)throw Error("Invalid or missing key parameter value");return{handshakeTopic:n,bridge:r,key:t.key}}throw new Error("URI format is invalid")}},{key:"_generateKey",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(){var t;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._cryptoLib){e.next=5;break}return e.next=3,this._cryptoLib.generateKey();case 3:return t=e.sent,e.abrupt("return",t);case 5:return e.abrupt("return",null);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_encrypt",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t){var n,r;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._key,!this._cryptoLib||!n){e.next=6;break}return e.next=4,this._cryptoLib.encrypt(t,n);case 4:return r=e.sent,e.abrupt("return",r);case 6:return e.abrupt("return",null);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_decrypt",value:function(){var e=(0,i.Z)((0,g.Z)().mark((function e(t){var n,r;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._key,!this._cryptoLib||!n){e.next=6;break}return e.next=4,this._cryptoLib.decrypt(t,n);case 4:return r=e.sent,e.abrupt("return",r);case 6:return e.abrupt("return",null);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getStorageSession",value:function(){var e=null;return this._sessionStorage&&(e=this._sessionStorage.getSession()),e}},{key:"_setStorageSession",value:function(){this._sessionStorage&&this._sessionStorage.setSession(this.session)}},{key:"_removeStorageSession",value:function(){this._sessionStorage&&this._sessionStorage.removeSession()}},{key:"_manageStorageSession",value:function(){this._connected?this._setStorageSession():this._removeStorageSession()}},{key:"_registerPushServer",value:function(e){if(!e.url||"string"!==typeof e.url)throw Error("Invalid or missing pushServerOpts.url parameter value");if(!e.type||"string"!==typeof e.type)throw Error("Invalid or missing pushServerOpts.type parameter value");if(!e.token||"string"!==typeof e.token)throw Error("Invalid or missing pushServerOpts.token parameter value");var t={bridge:this.bridge,topic:this.clientId,type:e.type,token:e.token,peerName:"",language:e.language||""};this.on("connect",function(){var n=(0,i.Z)((0,g.Z)().mark((function n(r,i){var s,o;return(0,g.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!r){n.next=2;break}throw r;case 2:return e.peerMeta&&(s=i.params[0].peerMeta.name,t.peerName=s),n.prev=3,n.next=6,fetch("".concat(e.url,"/new"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)});case 6:return o=n.sent,n.next=9,o.json();case 9:if(n.sent.success){n.next=12;break}throw Error("Failed to register in Push Server");case 12:n.next=17;break;case 14:throw n.prev=14,n.t0=n.catch(3),Error("Failed to register in Push Server");case 17:case"end":return n.stop()}}),n,null,[[3,14]])})));return function(e,t){return n.apply(this,arguments)}}())}}]),e}(),He=Je,ze=n(16419);function Ye(e){return ze.getBrowerCrypto().getRandomValues(new Uint8Array(e))}var Fe="AES-CBC",Be="SHA-".concat(256),Qe="HMAC";"aes-".concat(256,"-cbc"),"sha".concat(256);function Ke(e){return e===Fe?{length:256,name:Fe}:{hash:{name:Be},name:Qe}}function Ge(e){return e===Fe?["encrypt","decrypt"]:["sign","verify"]}function $e(e){return Xe.apply(this,arguments)}function Xe(){return Xe=(0,i.Z)((0,g.Z)().mark((function e(t){var n,r=arguments;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:Fe,e.abrupt("return",ze.getSubtleCrypto().importKey("raw",t,Ke(n),!0,Ge(n)));case 2:case"end":return e.stop()}}),e)}))),Xe.apply(this,arguments)}function et(){return(et=(0,i.Z)((0,g.Z)().mark((function e(t,n,r){var i,s,o;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=ze.getSubtleCrypto(),e.next=3,$e(n,Fe);case 3:return s=e.sent,e.next=6,i.encrypt({iv:t,name:Fe},s,r);case 6:return o=e.sent,e.abrupt("return",new Uint8Array(o));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tt(){return(tt=(0,i.Z)((0,g.Z)().mark((function e(t,n,r){var i,s,o;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=ze.getSubtleCrypto(),e.next=3,$e(n,Fe);case 3:return s=e.sent,e.next=6,i.decrypt({iv:t,name:Fe},s,r);case 6:return o=e.sent,e.abrupt("return",new Uint8Array(o));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nt(e,t){return rt.apply(this,arguments)}function rt(){return(rt=(0,i.Z)((0,g.Z)().mark((function e(t,n){var r,i,s;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ze.getSubtleCrypto(),e.next=3,$e(t,Qe);case 3:return i=e.sent,e.next=6,r.sign({length:256,name:Qe},i,n);case 6:return s=e.sent,e.abrupt("return",new Uint8Array(s));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function it(e,t,n){return function(e,t,n){return et.apply(this,arguments)}(e,t,n)}function st(e,t,n){return function(e,t,n){return tt.apply(this,arguments)}(e,t,n)}function ot(e,t){return at.apply(this,arguments)}function at(){return(at=(0,i.Z)((0,g.Z)().mark((function e(t,n){var r;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt(t,n);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ct(e){return ut.apply(this,arguments)}function ut(){return(ut=(0,i.Z)((0,g.Z)().mark((function e(t){var n,r;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ye((t||256)/8),r=pe(B(n)),e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ht(e,t){return pt.apply(this,arguments)}function pt(){return(pt=(0,i.Z)((0,g.Z)().mark((function e(t,n){var r,i,s,o,a,c,u;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=$(t.data),i=$(t.iv),s=$(t.hmac),o=Q(s,!1),a=ne(r,i),e.next=7,ot(n,a);case 7:if(c=e.sent,u=Q(c,!1),oe(o)!==oe(u)){e.next=11;break}return e.abrupt("return",!0);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dt(e,t,n){return lt.apply(this,arguments)}function lt(){return(lt=(0,i.Z)((0,g.Z)().mark((function e(t,n,r){var i,s,o,a,c,u,h,p,d,l,f;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=z(he(n)),e.t0=r,e.t0){e.next=6;break}return e.next=5,ct(128);case 5:e.t0=e.sent;case 6:return s=e.t0,o=z(he(s)),a=Q(o,!1),c=JSON.stringify(t),u=ee(c),e.next=13,it(o,i,u);case 13:return h=e.sent,p=Q(h,!1),d=ne(h,o),e.next=18,ot(i,d);case 18:return l=e.sent,f=Q(l,!1),e.abrupt("return",{data:p,hmac:f,iv:a});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ft(e,t){return vt.apply(this,arguments)}function vt(){return(vt=(0,i.Z)((0,g.Z)().mark((function e(t,n){var r,i,s,o,a,c;return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=z(he(n))){e.next=3;break}throw new Error("Missing key: required for decryption");case 3:return e.next=5,ht(t,r);case 5:if(e.sent){e.next=8;break}return e.abrupt("return",null);case 8:return i=$(t.data),s=$(t.iv),e.next=12,st(s,r,i);case 12:o=e.sent,a=K(o),e.prev=14,c=JSON.parse(a),e.next=21;break;case 18:return e.prev=18,e.t0=e.catch(14),e.abrupt("return",null);case 21:return e.abrupt("return",c);case 22:case"end":return e.stop()}}),e,null,[[14,18]])})))).apply(this,arguments)}var gt=function(e){(0,u.Z)(n,e);var t=(0,v.Z)(n);function n(e,i){return(0,s.Z)(this,n),t.call(this,{cryptoLib:r,connectorOpts:e,pushServerOpts:i})}return(0,o.Z)(n)}(He),_t=n(46622),kt=n(96039),yt=n(2132),wt=[{name:"Rainbow",chains:[_t.CHAIN_NAMESPACES.EIP155],logo:"https://images.web3auth.io/login-rainbow.svg",mobile:{native:"rainbow:",universal:"https://rnbwapp.com"},desktop:{native:"",universal:""}},{name:"MetaMask",chains:[_t.CHAIN_NAMESPACES.EIP155],logo:"https://images.web3auth.io/login-metamask.svg",mobile:{native:"metamask:",universal:"https://metamask.app.link"},desktop:{native:"",universal:""}}];function mt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,p.Z)(e);if(t){var i=(0,p.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,h.Z)(this,n)}}var Et=function(e){(0,u.Z)(n,e);var t=bt(n);function n(e){var r;return(0,s.Z)(this,n),r=t.call(this,e),(0,d.Z)((0,a.Z)(r),"name",_t.WALLET_ADAPTERS.WALLET_CONNECT_V1),(0,d.Z)((0,a.Z)(r),"adapterNamespace",_t.ADAPTER_NAMESPACES.EIP155),(0,d.Z)((0,a.Z)(r),"currentChainNamespace",_t.CHAIN_NAMESPACES.EIP155),(0,d.Z)((0,a.Z)(r),"type",_t.ADAPTER_CATEGORY.EXTERNAL),(0,d.Z)((0,a.Z)(r),"adapterOptions",void 0),(0,d.Z)((0,a.Z)(r),"status",_t.ADAPTER_STATUS.NOT_READY),(0,d.Z)((0,a.Z)(r),"adapterData",{uri:"",extensionAdapters:wt}),(0,d.Z)((0,a.Z)(r),"connector",null),(0,d.Z)((0,a.Z)(r),"wcProvider",null),(0,d.Z)((0,a.Z)(r),"rehydrated",!1),r.adapterOptions=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mt(Object(n),!0).forEach((function(t){(0,d.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e),r.chainConfig=e.chainConfig||null,r.sessionTime=e.sessionTime||86400,r}return(0,o.Z)(n,[{key:"connected",get:function(){var e;return!(null===(e=this.connector)||void 0===e||!e.connected)}},{key:"provider",get:function(){var e;return(null===(e=this.wcProvider)||void 0===e?void 0:e.provider)||null},set:function(e){throw new Error("Not implemented")}},{key:"init",value:function(){var e=(0,i.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,c.Z)((0,p.Z)(n.prototype),"checkInitializationRequirements",this).call(this),this.chainConfig||(this.chainConfig=(0,_t.getChainConfig)(_t.CHAIN_NAMESPACES.EIP155,1)),this.connector=this.getWalletConnectInstance(),this.wcProvider=new yt.WalletConnectProvider({config:{chainConfig:this.chainConfig},connector:this.connector}),this.emit(_t.ADAPTER_EVENTS.READY,_t.WALLET_ADAPTERS.WALLET_CONNECT_V1),this.status=_t.ADAPTER_STATUS.READY,_t.log.debug("initializing wallet connect v1 adapter"),!this.connector.connected){e.next=11;break}return this.rehydrated=!0,e.next=11,this.onConnectHandler({accounts:this.connector.accounts,chainId:this.connector.chainId});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connect",value:function(){var e=(0,i.Z)(f().mark((function e(){var t,r,s=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,c.Z)((0,p.Z)(n.prototype),"checkConnectionRequirements",this).call(this),this.connector){e.next=3;break}throw _t.WalletInitializationError.notReady("Wallet adapter is not ready yet");case 3:if(!this.connected){e.next=7;break}return e.next=6,this.onConnectHandler({accounts:this.connector.accounts,chainId:this.connector.chainId});case 6:return e.abrupt("return",this.provider);case 7:if(this.status===_t.ADAPTER_STATUS.CONNECTING){e.next=13;break}return null!==(t=this.adapterOptions.adapterSettings)&&void 0!==t&&t.qrcodeModal&&(this.connector=this.getWalletConnectInstance(),this.wcProvider=new yt.WalletConnectProvider({config:{chainConfig:this.chainConfig,skipLookupNetwork:null===(r=this.adapterOptions.adapterSettings)||void 0===r?void 0:r.skipNetworkSwitching},connector:this.connector})),e.next=11,this.createNewSession();case 11:this.status=_t.ADAPTER_STATUS.CONNECTING,this.emit(_t.ADAPTER_EVENTS.CONNECTING,{adapter:_t.WALLET_ADAPTERS.WALLET_CONNECT_V1});case 13:return e.abrupt("return",new Promise((function(e,t){if(s.connector){s.connector.on("modal_closed",(0,i.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.status=_t.ADAPTER_STATUS.READY,s.emit(_t.ADAPTER_EVENTS.READY,_t.WALLET_ADAPTERS.WALLET_CONNECT_V1),e.abrupt("return",t(new Error("User closed modal")));case 3:case"end":return e.stop()}}),e)}))));try{s.connector.on("connect",function(){var t=(0,i.Z)(f().mark((function t(n,r){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n&&s.emit(_t.ADAPTER_EVENTS.ERRORED,n),_t.log.debug("connected event emitted by web3auth"),t.next=4,s.onConnectHandler(r.params[0]);case 4:return t.abrupt("return",e(s.provider));case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}catch(n){_t.log.error("Wallet connect v1 adapter error while connecting",n),s.status=_t.ADAPTER_STATUS.READY,s.rehydrated=!0,s.emit(_t.ADAPTER_EVENTS.ERRORED,n),t(n instanceof _t.Web3AuthError?n:_t.WalletLoginError.connectionError("Failed to login with wallet connect: ".concat((null===n||void 0===n?void 0:n.message)||"")))}}else t(_t.WalletInitializationError.notReady("Wallet adapter is not ready yet"))})));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setAdapterSettings",value:function(e){this.status!==_t.ADAPTER_STATUS.READY&&(null!==e&&void 0!==e&&e.sessionTime&&(this.sessionTime=e.sessionTime),null!==e&&void 0!==e&&e.clientId&&(this.clientId=e.clientId))}},{key:"getUserInfo",value:function(){var e=(0,i.Z)(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connected){e.next=2;break}throw _t.WalletLoginError.notConnectedError("Not connected with wallet, Please login/connect first");case 2:return e.abrupt("return",{});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e=(0,i.Z)(f().mark((function e(){var t,r,i=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{cleanup:!1},r=t.cleanup,this.connector&&this.connected){e.next=4;break}throw _t.WalletLoginError.notConnectedError("Not connected with wallet");case 4:return e.next=6,(0,c.Z)((0,p.Z)(n.prototype),"disconnect",this).call(this);case 6:return e.next=8,this.connector.killSession();case 8:this.rehydrated=!1,r?(this.connector=null,this.status=_t.ADAPTER_STATUS.NOT_READY,this.wcProvider=null):this.status=_t.ADAPTER_STATUS.READY,this.emit(_t.ADAPTER_EVENTS.DISCONNECTED);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addChain",value:function(){var e=(0,i.Z)(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.wcProvider){e.next=3;break}throw _t.WalletInitializationError.notReady("Wallet adapter is not ready yet");case 3:if(!(r=null===(n=this.adapterOptions.adapterSettings)||void 0===n?void 0:n.networkSwitchModal)){e.next=7;break}return e.next=7,r.addNetwork({chainConfig:t,appOrigin:window.location.hostname});case 7:return e.next=9,this.wcProvider.addChain(t);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),_t.log.error(e.t0);case 14:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(t){return e.apply(this,arguments)}}()},{key:"switchChain",value:function(){var e=(0,i.Z)(f().mark((function e(t,n){var r,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.wcProvider){e.next=2;break}throw _t.WalletInitializationError.notReady("Wallet adapter is not ready yet");case 2:if(!(i=null===(r=this.adapterOptions.adapterSettings)||void 0===r?void 0:r.networkSwitchModal)){e.next=6;break}return e.next=6,i.switchNetwork({currentChainConfig:n,newChainConfig:t,appOrigin:window.location.hostname});case 6:return e.next=8,this.wcProvider.switchChain({chainId:n.chainId,lookup:!1,addChain:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createNewSession",value:function(){var e=(0,i.Z)(f().mark((function e(){var t,n,r,s,o=this,a=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>0&&void 0!==a[0]?a[0]:{forceNewSession:!1},this.connector){e.next=3;break}throw _t.WalletInitializationError.notReady("Wallet adapter is not ready yet");case 3:if(!r.forceNewSession||!this.connector.pending){e.next=6;break}return e.next=6,this.connector.killSession();case 6:if(null===(t=this.adapterOptions)||void 0===t||null===(n=t.adapterSettings)||void 0===n||!n.qrcodeModal){e.next=10;break}return e.next=9,this.connector.createSession({chainId:parseInt((null===(s=this.chainConfig)||void 0===s?void 0:s.chainId)||"0x1",16)});case 9:return e.abrupt("return");case 10:return e.abrupt("return",new Promise((function(e,t){var n;o.connector?(_t.log.debug("creating new session for web3auth wallet connect"),o.connector.on("display_uri",function(){var n=(0,i.Z)(f().mark((function n(r,i){var s,a;return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!r){n.next=3;break}return o.emit(_t.ADAPTER_EVENTS.ERRORED,_t.WalletLoginError.connectionError("Failed to display wallet connect qr code")),n.abrupt("return",t(r));case 3:return a=i.params[0],o.updateAdapterData({uri:a,extensionAdapters:wt}),null===(s=o.connector)||void 0===s||s.off("display_uri"),n.abrupt("return",e());case 7:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()),o.connector.createSession({chainId:parseInt((null===(n=o.chainConfig)||void 0===n?void 0:n.chainId)||"0x1",16)}).catch((function(e){return _t.log.error("error while creating new wallet connect session",e),o.emit(_t.ADAPTER_EVENTS.ERRORED,e),t(e)}))):t(_t.WalletInitializationError.notReady("Wallet adapter is not ready yet"))})));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onConnectHandler",value:function(){var e=(0,i.Z)(f().mark((function e(t){var n,r,i,s,o,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connector&&this.wcProvider){e.next=2;break}throw _t.WalletInitializationError.notReady("Wallet adapter is not ready yet");case 2:if(this.chainConfig){e.next=4;break}throw _t.WalletInitializationError.invalidParams("Chain config is not set");case 4:if(n=t.chainId,_t.log.debug("connected chainId in hex"),n===parseInt(this.chainConfig.chainId,16)){e.next=27;break}if(o=(0,_t.getChainConfig)(_t.CHAIN_NAMESPACES.EIP155,n)||{chainId:"0x".concat(n.toString(16)),displayName:"Unknown Network"},(a=null===(r=this.adapterOptions.adapterSettings)||void 0===r?void 0:r.qrcodeModal)&&(!a||null!==(i=this.adapterOptions)&&void 0!==i&&null!==(s=i.adapterSettings)&&void 0!==s&&s.skipNetworkSwitching)){e.next=27;break}return e.prev=10,e.next=13,this.addChain(this.chainConfig);case 13:return e.next=15,this.switchChain(o,this.chainConfig);case 15:this.connector=this.getWalletConnectInstance(),e.next=27;break;case 18:return e.prev=18,e.t0=e.catch(10),_t.log.error("error while chain switching",e.t0),e.next=23,this.createNewSession({forceNewSession:!0});case 23:return this.emit(_t.ADAPTER_EVENTS.ERRORED,_t.WalletInitializationError.fromCode(5e3,"Not connected to correct network. Expected: ".concat(this.chainConfig.displayName,", Current: ").concat((null===o||void 0===o?void 0:o.displayName)||n,", Please switch to correct network from wallet"))),this.status=_t.ADAPTER_STATUS.READY,this.rehydrated=!0,e.abrupt("return");case 27:return e.next=29,this.wcProvider.setupProvider(this.connector);case 29:this.subscribeEvents(this.connector),this.status=_t.ADAPTER_STATUS.CONNECTED,this.emit(_t.ADAPTER_EVENTS.CONNECTED,{adapter:_t.WALLET_ADAPTERS.WALLET_CONNECT_V1,reconnected:this.rehydrated});case 32:case"end":return e.stop()}}),e,this,[[10,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"subscribeEvents",value:function(e){var t=this;e.on("session_update",function(){var e=(0,i.Z)(f().mark((function e(n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n&&t.emit(_t.ADAPTER_EVENTS.ERRORED,n);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"getWalletConnectInstance",value:function(){var e=this.adapterOptions.adapterSettings||{};return e.bridge=e.bridge||"https://bridge.walletconnect.org",new gt(e)}}]),n}(kt.d)},22607:function(e){e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}}]);
//# sourceMappingURL=6814.c246cf87.chunk.js.map