(self.webpackChunkonboard_notify_react=self.webpackChunkonboard_notify_react||[]).push([[7572],{67572:function(e,t,n){"use strict";n.r(t),n.d(t,{Wallet:function(){return Ss},getWallet:function(){return Os},initWallet:function(){return Ts},sequence:function(){return Hs}});var r={};n.r(r),n.d(r,{walletContracts:function(){return g}});var i={};n.r(i),n.d(i,{API:function(){return I},SequenceAPIClient:function(){return N},SmartRampOrderStatus:function(){return x},SmartRampTxnStatus:function(){return Z},SortOrder:function(){return C},WebRPCSchemaHash:function(){return S},WebRPCSchemaVersion:function(){return _},WebRPCVersion:function(){return E}});var a={};n.r(a),n.d(a,{Logger:function(){return st},base64Decode:function(){return ze},base64DecodeObject:function(){return Qe},base64Encode:function(){return $e},base64EncodeObject:function(){return Ye},checkProperties:function(){return xt},configureLogger:function(){return ut},deepCopy:function(){return Ct},defineReadOnly:function(){return mt},encodeMessageDigest:function(){return Xe},encodeTypedDataDigest:function(){return yt},encodeTypedDataHash:function(){return wt},getRandomInt:function(){return lt},getStatic:function(){return bt},isBigNumberish:function(){return _t},isBrowser:function(){return rt},isNode:function(){return nt},jwtDecodeClaims:function(){return it},logger:function(){return ot},packMessageData:function(){return et},promisify:function(){return ct},queryStringFromObject:function(){return ft},queryStringToObject:function(){return ht},resolveProperties:function(){return kt},sanitizeAlphanumeric:function(){return pt},sanitizeHost:function(){return vt},sanitizeNumberString:function(){return dt},shallowCopy:function(){return Zt},sleep:function(){return gt},subDigestOf:function(){return tt},urlClean:function(){return Et}});var s={};n.r(s),n.d(s,{AllowProvider:function(){return fn},CachedProvider:function(){return dn},ChainId:function(){return Rt},EagerProvider:function(){return pn},JsonRpcExternalProvider:function(){return ln},JsonRpcRouter:function(){return nn},JsonRpcSender:function(){return cn},JsonRpcVersion:function(){return tn},PublicProvider:function(){return bn},SigningProvider:function(){return mn},allowProviderMiddleware:function(){return hn},checkNetworkConfig:function(){return Gt},createJsonRpcMiddlewareStack:function(){return rn},ensureUniqueNetworks:function(){return Wt},ensureValidNetworks:function(){return qt},exceptionProviderMiddleware:function(){return vn},findNetworkConfig:function(){return jt},getAuthNetwork:function(){return Ut},getChainId:function(){return Mt},indexerURL:function(){return Jt},isJsonRpcHandler:function(){return sn},isJsonRpcProvider:function(){return an},isNetworkConfig:function(){return Pt},isValidNetworkConfig:function(){return Dt},loggingProviderMiddleware:function(){return gn},mainnetNetworks:function(){return Qt},maybeChainId:function(){return Lt},networkProviderMiddleware:function(){return wn},networks:function(){return zt},networksIndex:function(){return Ht},nodesURL:function(){return Yt},relayerURL:function(){return $t},sequenceContext:function(){return en},sortNetworks:function(){return Vt},stringTemplate:function(){return Kt},testnetNetworks:function(){return Xt},updateNetworkConfig:function(){return Bt},validateAndSortNetworks:function(){return Ft}});var o={};n.r(o),n.d(o,{Multicall:function(){return Sn},providers:function(){return An}});var u={};n.r(u),n.d(u,{ConfigFinder:function(){return $n},SequenceUtilsFinder:function(){return Qn},SignatureType:function(){return zn},WalletContractBytecode:function(){return Pn},addressOf:function(){return Fn},buildStubSignature:function(){return hr},compareAddr:function(){return Vn},createWalletConfig:function(){return qn},decodeSignature:function(){return ir},editConfig:function(){return Kn},encodeSignature:function(){return cr},genConfig:function(){return Jn},imageHash:function(){return jn},isConfigEqual:function(){return Hn},isDecodedAddress:function(){return Xn},isDecodedEOASigner:function(){return tr},isDecodedEOASplitSigner:function(){return nr},isDecodedFullSigner:function(){return rr},isDecodedSigner:function(){return er},isUsableConfig:function(){return Wn},isValidConfigSigners:function(){return Bn},joinSignatures:function(){return or},joinTwoSignatures:function(){return ur},mutateSignature:function(){return fr},recoverEOASigner:function(){return sr},signerOf:function(){return lr},sortConfig:function(){return Gn},splitDecodedEOASigner:function(){return ar}});var c={};n.r(c),n.d(c,{ContractType:function(){return vr},EventLogDataType:function(){return wr},EventLogType:function(){return gr},Indexer:function(){return Cr},SequenceIndexerClient:function(){return Sr},SequenceIndexerServices:function(){return Zr},SortOrder:function(){return mr},TxnTransferType:function(){return yr},WebRPCSchemaHash:function(){return xr},WebRPCSchemaVersion:function(){return kr},WebRPCVersion:function(){return br}});var l={};n.r(l),n.d(l,{ContractType:function(){return Tr},Metadata:function(){return Lr},PropertyType:function(){return Or},SequenceMetadataClient:function(){return qr},SortOrder:function(){return Ar},SwapType:function(){return Nr},WebRPCSchemaHash:function(){return Mr},WebRPCSchemaVersion:function(){return Rr},WebRPCVersion:function(){return Pr}});var f={};n.r(f),n.d(f,{MetaTransactionsType:function(){return Gr},appendNonce:function(){return si},computeMetaTxnHash:function(){return $r},decodeNonce:function(){return li},digestOfTransactions:function(){return Kr},digestOfTransactionsNonce:function(){return Jr},encodeNonce:function(){return ci},flattenAuxTransactions:function(){return Qr},fromTransactionish:function(){return hi},hasSequenceTransactions:function(){return ri},isAsyncSendable:function(){return ti},isSequenceTransaction:function(){return ni},isSignedTransactions:function(){return fi},makeAfterNonce:function(){return ui},makeExpirable:function(){return oi},packMetaTransactionsData:function(){return Hr},packMetaTransactionsNonceData:function(){return Vr},readSequenceNonce:function(){return ii},sequenceTxAbiEncode:function(){return ai},toSequenceTransaction:function(){return Xr},toSequenceTransactions:function(){return Yr}});var h={};n.r(h),n.d(h,{BaseRelayer:function(){return wi},BaseRelayerDefaults:function(){return gi},LocalRelayer:function(){return Si},ProviderRelayer:function(){return ki},ProviderRelayerDefaults:function(){return mi},RpcRelayer:function(){return Mi},RpcRelayerProto:function(){return Ni},isBaseRelayerOptions:function(){return vi},isLocalRelayerOptions:function(){return xi},isProviderRelayerOptions:function(){return bi},isRelayer:function(){return Ui},isRpcRelayerOptions:function(){return Ri},proto:function(){return Ni}});var d={};n.r(d),n.d(d,{AuthError:function(){return fa},DEFAULT_SESSION_EXPIRATION:function(){return aa},ErrAccountIsRequired:function(){return ha},LONG_SESSION_EXPIRATION:function(){return sa},Session:function(){return oa},ValidateSequenceDeployedWalletProof:function(){return da},ValidateSequenceUndeployedWalletProof:function(){return pa},signAuthorization:function(){return la}});var p={};n.r(p),n.d(p,{Guard:function(){return ma},WebRPCSchemaHash:function(){return ya},WebRPCSchemaVersion:function(){return wa},WebRPCVersion:function(){return ga}});var v={};n.r(v),n.d(v,{BaseInjectedTransport:function(){return bs},BaseProviderTransport:function(){return Ma},BaseWalletTransport:function(){return cs},CHANNEL_ID:function(){return ws},DefaultProviderConfig:function(){return Is},ErrSignedInRequired:function(){return Na},EventType:function(){return _a},ExtensionMessageHandler:function(){return ys},ExtensionMessageProvider:function(){return ms},InitState:function(){return Ia},LocalStorage:function(){return is},LocalStore:function(){return os},LocalWeb3Provider:function(){return Wa},MuxMessageProvider:function(){return ps},OpenState:function(){return Sa},PROVIDER_OPEN_TIMEOUT:function(){return Aa},ProviderError:function(){return Oa},ProxyMessageChannel:function(){return ls},ProxyMessageChannelPort:function(){return fs},ProxyMessageHandler:function(){return ds},ProxyMessageProvider:function(){return hs},UnrealMessageHandler:function(){return Es},UnrealMessageProvider:function(){return Cs},Wallet:function(){return Ss},WalletRequestHandler:function(){return La},Web3Provider:function(){return Da},Web3Signer:function(){return Ba},WindowMessageHandler:function(){return gs},WindowMessageProvider:function(){return vs},WindowSessionParams:function(){return Ta},getWallet:function(){return Os},initWallet:function(){return Ts},isBrowserExtension:function(){return ts},isSequenceProvider:function(){return qa},isUnityPlugin:function(){return ns},isValidMessageSignature:function(){return Qa},isValidSignature:function(){return za},isValidTypedDataSignature:function(){return Xa},isWalletUpToDate:function(){return rs},messageToBytes:function(){return $a},nextMessageIdx:function(){return Ra},prefixEIP191Message:function(){return Ya},recoverWalletConfig:function(){return es}});var g={erc1271:Object.freeze({__proto__:null,abi:[{type:"function",name:"isValidSignature",constant:!0,inputs:[{type:"bytes32"},{type:"bytes"}],outputs:[{type:"bytes4"}],payable:!1,stateMutability:"view"}],returns:{isValidSignatureBytes32:"0x1626ba7e"}}),factory:Object.freeze({__proto__:null,abi:[{type:"function",name:"deploy",constant:!1,inputs:[{type:"address"},{type:"bytes32"}],outputs:[],payable:!0,stateMutability:"payable"}]}),mainModule:Object.freeze({__proto__:null,abi:[{type:"function",name:"nonce",constant:!0,inputs:[],outputs:[{type:"uint256"}],payable:!1,stateMutability:"view"},{type:"function",name:"readNonce",constant:!0,inputs:[{type:"uint256"}],outputs:[{type:"uint256"}],payable:!1,stateMutability:"view"},{type:"function",name:"updateImplementation",constant:!1,inputs:[{type:"address"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"selfExecute",constant:!1,inputs:[{components:[{type:"bool",name:"delegateCall"},{type:"bool",name:"revertOnError"},{type:"uint256",name:"gasLimit"},{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}],type:"tuple[]"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"execute",constant:!1,inputs:[{components:[{type:"bool",name:"delegateCall"},{type:"bool",name:"revertOnError"},{type:"uint256",name:"gasLimit"},{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}],type:"tuple[]"},{type:"uint256"},{type:"bytes"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"createContract",inputs:[{type:"bytes"}],payable:!0,stateMutability:"payable"}]}),mainModuleUpgradable:Object.freeze({__proto__:null,abi:[{type:"function",name:"updateImageHash",constant:!0,inputs:[{type:"bytes32"}],outputs:[],payable:!1,stateMutability:"view"},{type:"function",name:"imageHash",constant:!0,inputs:[],outputs:[{type:"bytes32"}],payable:!1,stateMutability:"view"}]}),sequenceUtils:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"address",name:"_factory",type:"address"},{internalType:"address",name:"_mainModule",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_wallet",type:"address"},{indexed:!0,internalType:"bytes32",name:"_imageHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"_threshold",type:"uint256"},{indexed:!1,internalType:"bytes",name:"_signers",type:"bytes"}],name:"RequiredConfig",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_wallet",type:"address"},{indexed:!0,internalType:"address",name:"_signer",type:"address"}],name:"RequiredSigner",type:"event"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callBalanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callBlockNumber",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_i",type:"uint256"}],name:"callBlockhash",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"callChainId",outputs:[{internalType:"uint256",name:"id",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCode",outputs:[{internalType:"bytes",name:"code",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCodeHash",outputs:[{internalType:"bytes32",name:"codeHash",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCodeSize",outputs:[{internalType:"uint256",name:"size",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callCoinbase",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"callDifficulty",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasLeft",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasLimit",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasPrice",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callOrigin",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"callTimestamp",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"knownImageHashes",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"lastImageHashUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"lastSignerUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"lastWalletUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"bool",name:"delegateCall",type:"bool"},{internalType:"bool",name:"revertOnError",type:"bool"},{internalType:"uint256",name:"gasLimit",type:"uint256"},{internalType:"address",name:"target",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct IModuleCalls.Transaction[]",name:"_txs",type:"tuple[]"}],name:"multiCall",outputs:[{internalType:"bool[]",name:"_successes",type:"bool[]"},{internalType:"bytes[]",name:"_results",type:"bytes[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"uint256",name:"_threshold",type:"uint256"},{components:[{internalType:"uint256",name:"weight",type:"uint256"},{internalType:"address",name:"signer",type:"address"}],internalType:"struct RequireUtils.Member[]",name:"_members",type:"tuple[]"},{internalType:"bool",name:"_index",type:"bool"}],name:"publishConfig",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"uint256",name:"_sizeMembers",type:"uint256"},{internalType:"bytes",name:"_signature",type:"bytes"},{internalType:"bool",name:"_index",type:"bool"}],name:"publishInitialSigners",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"uint256",name:"_nonce",type:"uint256"}],name:"requireMinNonce",outputs:[],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_expiration",type:"uint256"}],name:"requireNonExpired",outputs:[],stateMutability:"view",type:"function"}]}),requireFreshSigner:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"address",name:"",type:"address"}],name:"requireFreshSigner",outputs:[],stateMutability:"nonpayable",type:"function"}]})},w=n(24269),y=n(38114),m=n(47061),b=n(59900);function k(){return k=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},k.apply(this,arguments)}var x,Z,C,E="v1",_="v0.4.0",S="8e34a4b927a5faab07d6558c21251a5218b82ac4";!function(e){e.UNKNOWN="UNKNOWN",e.RUNNING_CHECKS="RUNNING_CHECKS",e.PROCESSING="PROCESSING",e.FAILED="FAILED",e.COMPLETE="COMPLETE"}(x||(x={})),function(e){e.UNKNOWN="UNKNOWN",e.SUCCESSFUL="SUCCESSFUL",e.FAILED="FAILED"}(Z||(Z={})),function(e){e.DESC="DESC",e.ASC="ASC"}(C||(C={}));var I=function(){function e(t,n){var r=this;(0,m.Z)(this,e),this.hostname=void 0,this.fetch=void 0,this.path="/rpc/API/",this.ping=function(e){return r.fetch(r.url("Ping"),T({},e)).then((function(e){return O(e).then((function(e){return{status:e.status}}))}))},this.version=function(e){return r.fetch(r.url("Version"),T({},e)).then((function(e){return O(e).then((function(e){return{version:e.version}}))}))},this.runtimeStatus=function(e){return r.fetch(r.url("RuntimeStatus"),T({},e)).then((function(e){return O(e).then((function(e){return{status:e.status}}))}))},this.getSequenceContext=function(e){return r.fetch(r.url("GetSequenceContext"),T({},e)).then((function(e){return O(e).then((function(e){return{data:e.data}}))}))},this.getAuthToken=function(e,t){return r.fetch(r.url("GetAuthToken"),T(e,t)).then((function(e){return O(e).then((function(e){return{status:e.status,jwtToken:e.jwtToken,address:e.address,user:e.user}}))}))},this.sendPasswordlessLink=function(e,t){return r.fetch(r.url("SendPasswordlessLink"),T(e,t)).then((function(e){return O(e).then((function(e){return{status:e.status}}))}))},this.friendList=function(e,t){return r.fetch(r.url("FriendList"),T(e,t)).then((function(e){return O(e).then((function(e){return{page:e.page,friends:e.friends}}))}))},this.getFriendByAddress=function(e,t){return r.fetch(r.url("GetFriendByAddress"),T(e,t)).then((function(e){return O(e).then((function(e){return{status:e.status,friend:e.friend}}))}))},this.searchFriends=function(e,t){return r.fetch(r.url("SearchFriends"),T(e,t)).then((function(e){return O(e).then((function(e){return{friends:e.friends}}))}))},this.addFriend=function(e,t){return r.fetch(r.url("AddFriend"),T(e,t)).then((function(e){return O(e).then((function(e){return{status:e.status,friend:e.friend}}))}))},this.updateFriendNickname=function(e,t){return r.fetch(r.url("UpdateFriendNickname"),T(e,t)).then((function(e){return O(e).then((function(e){return{status:e.status,friend:e.friend}}))}))},this.removeFriend=function(e,t){return r.fetch(r.url("RemoveFriend"),T(e,t)).then((function(e){return O(e).then((function(e){return{status:e.status}}))}))},this.contractCall=function(e,t){return r.fetch(r.url("ContractCall"),T(e,t)).then((function(e){return O(e).then((function(e){return{returns:e.returns}}))}))},this.decodeContractCall=function(e,t){return r.fetch(r.url("DecodeContractCall"),T(e,t)).then((function(e){return O(e).then((function(e){return{call:e.call}}))}))},this.lookupContractCallSelectors=function(e,t){return r.fetch(r.url("LookupContractCallSelectors"),T(e,t)).then((function(e){return O(e).then((function(e){return{signatures:e.signatures}}))}))},this.userStorageFetch=function(e,t){return r.fetch(r.url("UserStorageFetch"),T(e,t)).then((function(e){return O(e).then((function(e){return{object:e.object}}))}))},this.userStorageSave=function(e,t){return r.fetch(r.url("UserStorageSave"),T(e,t)).then((function(e){return O(e).then((function(e){return{ok:e.ok}}))}))},this.userStorageDelete=function(e,t){return r.fetch(r.url("UserStorageDelete"),T(e,t)).then((function(e){return O(e).then((function(e){return{ok:e.ok}}))}))},this.userStorageFetchAll=function(e,t){return r.fetch(r.url("UserStorageFetchAll"),T(e,t)).then((function(e){return O(e).then((function(e){return{objects:e.objects}}))}))},this.getMoonpayLink=function(e,t){return r.fetch(r.url("GetMoonpayLink"),T(e,t)).then((function(e){return O(e).then((function(e){return{signedUrl:e.signedUrl}}))}))},this.getSardineClientToken=function(e){return r.fetch(r.url("GetSardineClientToken"),T({},e)).then((function(e){return O(e).then((function(e){return{token:e.token}}))}))},this.isUsingGoogleMail=function(e,t){return r.fetch(r.url("IsUsingGoogleMail"),T(e,t)).then((function(e){return O(e).then((function(e){return{yes:e.yes}}))}))},this.isValidSignature=function(e,t){return r.fetch(r.url("IsValidSignature"),T(e,t)).then((function(e){return O(e).then((function(e){return{isValid:e.isValid}}))}))},this.isValidMessageSignature=function(e,t){return r.fetch(r.url("IsValidMessageSignature"),T(e,t)).then((function(e){return O(e).then((function(e){return{isValid:e.isValid}}))}))},this.isValidTypedDataSignature=function(e,t){return r.fetch(r.url("IsValidTypedDataSignature"),T(e,t)).then((function(e){return O(e).then((function(e){return{isValid:e.isValid}}))}))},this.isValidETHAuthProof=function(e,t){return r.fetch(r.url("IsValidETHAuthProof"),T(e,t)).then((function(e){return O(e).then((function(e){return{isValid:e.isValid}}))}))},this.getCoinPrices=function(e,t){return r.fetch(r.url("GetCoinPrices"),T(e,t)).then((function(e){return O(e).then((function(e){return{tokenPrices:e.tokenPrices}}))}))},this.getCollectiblePrices=function(e,t){return r.fetch(r.url("GetCollectiblePrices"),T(e,t)).then((function(e){return O(e).then((function(e){return{tokenPrices:e.tokenPrices}}))}))},this.getExchangeRate=function(e,t){return r.fetch(r.url("GetExchangeRate"),T(e,t)).then((function(e){return O(e).then((function(e){return{exchangeRate:e.exchangeRate}}))}))},this.listPayCardsOnFile=function(e){return r.fetch(r.url("ListPayCardsOnFile"),T({},e)).then((function(e){return O(e).then((function(e){return{payCards:e.payCards}}))}))},this.savePayCard=function(e,t){return r.fetch(r.url("SavePayCard"),T(e,t)).then((function(e){return O(e).then((function(e){return{ok:e.ok,payCard:e.payCard}}))}))},this.updatePayCardCVC=function(e,t){return r.fetch(r.url("UpdatePayCardCVC"),T(e,t)).then((function(e){return O(e).then((function(e){return{ok:e.ok}}))}))},this.deletePayCard=function(e,t){return r.fetch(r.url("DeletePayCard"),T(e,t)).then((function(e){return O(e).then((function(e){return{ok:e.ok}}))}))},this.smartRampQuote=function(e,t){return r.fetch(r.url("SmartRampQuote"),T(e,t)).then((function(e){return O(e).then((function(e){return{status:e.status,quoteDetails:e.quoteDetails}}))}))},this.smartRampPurchase=function(e,t){return r.fetch(r.url("SmartRampPurchase"),T(e,t)).then((function(e){return O(e).then((function(e){return{processing:e.processing,receipt:e.receipt}}))}))},this.smartRampWaitOrderConfirmation=function(e,t){return r.fetch(r.url("SmartRampWaitOrderConfirmation"),T(e,t)).then((function(e){return O(e).then((function(e){return{done:e.done,receipt:e.receipt}}))}))},this.smartRampGetOrder=function(e,t){return r.fetch(r.url("SmartRampGetOrder"),T(e,t)).then((function(e){return O(e).then((function(e){return{order:e.order}}))}))},this.smartRampCheckCardAuthorization=function(e,t){return r.fetch(r.url("SmartRampCheckCardAuthorization"),T(e,t)).then((function(e){return O(e).then((function(e){return{cardAuth:e.cardAuth}}))}))},this.smartRampOrdersList=function(e,t){return r.fetch(r.url("SmartRampOrdersList"),T(e,t)).then((function(e){return O(e).then((function(e){return{page:e.page,orders:e.orders}}))}))},this.smartRampGetOrderTxnHash=function(e,t){return r.fetch(r.url("SmartRampGetOrderTxnHash"),T(e,t)).then((function(e){return O(e).then((function(e){return{txnHash:e.txnHash,txnSuccessful:e.txnSuccessful}}))}))},this.smartRampSubmitCardAuthorization=function(e,t){return r.fetch(r.url("SmartRampSubmitCardAuthorization"),T(e,t)).then((function(e){return O(e).then((function(e){return{status:e.status}}))}))},this.adminSmartRampGetOrder=function(e,t){return r.fetch(r.url("AdminSmartRampGetOrder"),T(e,t)).then((function(e){return O(e).then((function(e){return{order:e.order}}))}))},this.adminSmartRampListCompletedOrders=function(e,t){return r.fetch(r.url("AdminSmartRampListCompletedOrders"),T(e,t)).then((function(e){return O(e).then((function(e){return{orders:e.orders}}))}))},this.adminSmartRampListPendingOrders=function(e,t){return r.fetch(r.url("AdminSmartRampListPendingOrders"),T(e,t)).then((function(e){return O(e).then((function(e){return{pendingOrders:e.pendingOrders}}))}))},this.getInviteInfo=function(e){return r.fetch(r.url("GetInviteInfo"),T({},e)).then((function(e){return O(e).then((function(e){return{inviteInfo:e.inviteInfo}}))}))},this.isValidAccessCode=function(e,t){return r.fetch(r.url("IsValidAccessCode"),T(e,t)).then((function(e){return O(e).then((function(e){return{status:e.status}}))}))},this.internalClaimAccessCode=function(e,t){return r.fetch(r.url("InternalClaimAccessCode"),T(e,t)).then((function(e){return O(e).then((function(e){return{status:e.status}}))}))},this.walletRecover=function(e,t){return r.fetch(r.url("WalletRecover"),T(e,t)).then((function(e){return O(e).then((function(e){return{encryptedWallet:e.encryptedWallet}}))}))},this.blockNumberAtTime=function(e,t){return r.fetch(r.url("BlockNumberAtTime"),T(e,t)).then((function(e){return O(e).then((function(e){return{blocks:e.blocks}}))}))},this.hostname=t,this.fetch=function(e,t){return n(e,t)}}return(0,b.Z)(e,[{key:"url",value:function(e){return this.hostname+this.path+e}}]),e}(),T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{method:"POST",headers:k({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}},O=function(e){return e.text().then((function(t){var n;try{n=JSON.parse(t)}catch(r){throw{code:"unknown",msg:"expecting JSON, got: ".concat(t),status:e.status}}if(!e.ok)throw n;return n}))},N=function(e){(0,w.Z)(r,e);var t=(0,y.Z)(r);function r(e,i){var a;return(0,m.Z)(this,r),(a=t.call(this,e.endsWith("/")?e.slice(0,-1):e,n.g.fetch)).jwtAuth=i,a._fetch=function(e,t){var r={};return a.jwtAuth&&a.jwtAuth.length>0&&(r.Authorization="BEARER ".concat(a.jwtAuth)),t.headers=k({},t.headers,r),n.g.fetch(e,t)},a.fetch=a._fetch,a}return(0,b.Z)(r)}(I),A=n(73133),P=n(23680),R=n(92533),M=n(19961),L=n(24611),U=n(53755),D=n(26336),q=n(24694),W=n(50515),B=n(83641),F=n(70008),j=n(67120),G=n(60930),H=n(30261).Buffer,V="function"===typeof atob,K="function"===typeof btoa,J="function"===typeof H,$="function"===typeof TextDecoder?new TextDecoder:void 0,Y="function"===typeof TextEncoder?new TextEncoder:void 0,z=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),Q=function(e){var t={};return e.forEach((function(e,n){return t[e]=n})),t}(z),X=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,ee=String.fromCharCode.bind(String),te="function"===typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};return new Uint8Array(Array.prototype.slice.call(e,0).map(t))},ne=function(e){return e.replace(/=/g,"").replace(/[+\/]/g,(function(e){return"+"==e?"-":"_"}))},re=function(e){return e.replace(/[^A-Za-z0-9\+\/]/g,"")},ie=function(e){for(var t,n,r,i,a="",s=e.length%3,o=0;o<e.length;){if((n=e.charCodeAt(o++))>255||(r=e.charCodeAt(o++))>255||(i=e.charCodeAt(o++))>255)throw new TypeError("invalid character found");a+=z[(t=n<<16|r<<8|i)>>18&63]+z[t>>12&63]+z[t>>6&63]+z[63&t]}return s?a.slice(0,s-3)+"===".substring(s):a},ae=K?function(e){return btoa(e)}:J?function(e){return H.from(e,"binary").toString("base64")}:ie,se=J?function(e){return H.from(e).toString("base64")}:function(e){for(var t=[],n=0,r=e.length;n<r;n+=4096)t.push(ee.apply(null,e.subarray(n,n+4096)));return ae(t.join(""))},oe=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?ee(192|t>>>6)+ee(128|63&t):ee(224|t>>>12&15)+ee(128|t>>>6&63)+ee(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return ee(240|t>>>18&7)+ee(128|t>>>12&63)+ee(128|t>>>6&63)+ee(128|63&t)},ue=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,ce=function(e){return e.replace(ue,oe)},le=J?function(e){return H.from(e,"utf8").toString("base64")}:Y?function(e){return se(Y.encode(e))}:function(e){return ae(ce(e))},fe=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?ne(le(e)):le(e)},he=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,de=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return ee(55296+(t>>>10))+ee(56320+(1023&t));case 3:return ee((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return ee((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},pe=function(e){return e.replace(he,de)},ve=function(e){if(e=e.replace(/\s+/g,""),!X.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));for(var t,n,r,i="",a=0;a<e.length;)t=Q[e.charAt(a++)]<<18|Q[e.charAt(a++)]<<12|(n=Q[e.charAt(a++)])<<6|(r=Q[e.charAt(a++)]),i+=64===n?ee(t>>16&255):64===r?ee(t>>16&255,t>>8&255):ee(t>>16&255,t>>8&255,255&t);return i},ge=V?function(e){return atob(re(e))}:J?function(e){return H.from(e,"base64").toString("binary")}:ve,we=J?function(e){return te(H.from(e,"base64"))}:function(e){return te(ge(e),(function(e){return e.charCodeAt(0)}))},ye=J?function(e){return H.from(e,"base64").toString("utf8")}:$?function(e){return $.decode(we(e))}:function(e){return pe(ge(e))},me=function(e){return re(e.replace(/[-_]/g,(function(e){return"-"==e?"+":"/"})))},be=function(e){return ye(me(e))},ke=fe,xe=be,Ze=function(){return Ze=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ze.apply(this,arguments)};function Ce(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{u(r.next(e))}catch(t){a(t)}}function o(e){try{u(r.throw(e))}catch(t){a(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}u((r=r.apply(e,t||[])).next())}))}function Ee(e,t){var n,r,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(u){o=[6,u],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}var _e,Se=function(e){return j.E.hash(e.domain,e.types,e.message)},Ie=function(){function e(e){this.prefix=Re,this.address=(null===e||void 0===e?void 0:e.address)?e.address.toLowerCase():"",this.claims=(null===e||void 0===e?void 0:e.claims)?e.claims:{app:"",iat:0,exp:0,v:Pe},this.signature=(null===e||void 0===e?void 0:e.signature)?e.signature:"",this.extra=(null===e||void 0===e?void 0:e.extra)?e.extra:""}return e.prototype.setIssuedAtNow=function(){this.claims.iat=Math.round((new Date).getTime()/1e3)},e.prototype.setExpiryIn=function(e){this.claims.exp=Math.round((new Date).getTime()/1e3)+e},e.prototype.validateClaims=function(){return Te(this.claims)},e.prototype.messageDigest=function(){var e=this.validateClaims();if(e.err)throw e.err;return B.lE(Se(this.messageTypedData()))},e.prototype.messageTypedData=function(){var e={domain:Ze({},Me),types:{Claims:[]},message:{}};return this.claims.app&&this.claims.app.length>0&&(e.types.Claims.push({name:"app",type:"string"}),e.message.app=this.claims.app),this.claims.iat&&this.claims.iat>0&&(e.types.Claims.push({name:"iat",type:"int64"}),e.message.iat=this.claims.iat),this.claims.exp&&this.claims.exp>0&&(e.types.Claims.push({name:"exp",type:"int64"}),e.message.exp=this.claims.exp),this.claims.n&&this.claims.n>0&&(e.types.Claims.push({name:"n",type:"uint64"}),e.message.n=this.claims.n),this.claims.typ&&this.claims.typ.length>0&&(e.types.Claims.push({name:"typ",type:"string"}),e.message.typ=this.claims.typ),this.claims.ogn&&this.claims.ogn.length>0&&(e.types.Claims.push({name:"ogn",type:"string"}),e.message.ogn=this.claims.ogn),this.claims.v&&this.claims.v.length>0&&(e.types.Claims.push({name:"v",type:"string"}),e.message.v=this.claims.v),e},e}(),Te=function(e){if(""===e.app)return{ok:!1,err:new Error("claims: app is empty")};var t=Math.round((new Date).getTime()/1e3),n=31536300;return""===e.v?{ok:!1,err:new Error("claims: ethauth version is empty")}:e.iat&&0!==e.iat&&(e.iat>t+300||e.iat<t-n)?{ok:!1,err:new Error("claims: iat is invalid")}:e.exp<t-300||e.exp>t+n?{ok:!1,err:new Error("claims: token has expired")}:{ok:!0}},Oe=function(e,t,n){return Ce(void 0,void 0,void 0,(function(){var e,t;return Ee(this,(function(r){return e=n.messageDigest(),"0x"===(t=G.n5(e,n.signature)).slice(0,2)&&42===t.length&&t.toLowerCase()===n.address.toLowerCase()?[2,{isValid:!0,address:n.address}]:[2,{isValid:!1}]}))}))},Ne=function(e,t,n){return Ce(void 0,void 0,void 0,(function(){var t,r,i;return Ee(this,(function(a){switch(a.label){case 0:return e&&void 0!==e?(t=n.messageDigest(),[4,e.getCode(n.address)]):[2,{isValid:!1}];case 1:if("0x"===(r=a.sent())||r.length<=2)throw new Error("ValidateContractAccountProof failed. unable to fetch wallet contract code");return i=["function isValidSignature(bytes32, bytes) public view returns (bytes4)"],[4,new W.CH(n.address,i,e).isValidSignature(t,B.lE(n.signature))];case 2:return a.sent()===Ae?[2,{isValid:!0,address:n.address}]:[2,{isValid:!1}]}}))}))},Ae="0x1626ba7e",Pe="1",Re="eth",Me={name:"ETHAuth",version:Pe},Le=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;this.configJsonRpcProvider=function(e){return Ce(n,void 0,void 0,(function(){var t;return Ee(this,(function(n){switch(n.label){case 0:return this.provider=new D.r(e),[4,this.provider.send("net_version",[])];case 1:if(t=n.sent(),this.chainId=parseInt(t),!this.chainId||0===this.chainId||NaN===this.chainId)throw new Error("ethauth: unable to get chainId");return this.ethereumJsonRpcURL=e,[2]}}))}))},this.configValidators=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0==e.length)throw new Error("validators list is empty");n.validators=e},this.encodeProof=function(e,t){return void 0===t&&(t=!1),Ce(n,void 0,void 0,(function(){var n,r;return Ee(this,(function(i){switch(i.label){case 0:if(42!==e.address.length||"0x"!==e.address.slice(0,2))throw new Error("ethauth: invalid address");if(""===e.signature||"0x"!==e.signature.slice(0,2))throw new Error("ethauth: invalid signature");if(e.extra&&"0x"!==e.extra.slice(0,2))throw new Error("ethauth: invalid extra encoding, expecting hex data");return[4,this.validateProof(e,t)];case 1:if(!i.sent())throw new Error("ethauth: proof is invalid");return n=JSON.stringify(e.claims),r=Re+"."+e.address.toLowerCase()+"."+ke(n,!0)+"."+e.signature,e.extra&&e.extra.length>0&&(r+="."+e.extra),[2,r]}}))}))},this.decodeProof=function(e,t){return void 0===t&&(t=!1),Ce(n,void 0,void 0,(function(){var n,r,i,a,s,o,u,c,l;return Ee(this,(function(f){switch(f.label){case 0:if((n=e.split(".")).length<4||n.length>5)throw new Error("ethauth: invalid proof string");if(r=n[0],i=n[1],a=n[2],s=n[3],o=n[4],r!==Re)throw new Error("ethauth: not an ethauth proof");return u=xe(a),c=JSON.parse(u),l=new Ie({address:i,claims:c,signature:s,extra:o}),[4,this.validateProof(l,t)];case 1:if(!f.sent())throw new Error("ethauth: proof is invalid");return[2,l]}}))}))},this.validateProof=function(e,t){return void 0===t&&(t=!1),Ce(n,void 0,void 0,(function(){var n;return Ee(this,(function(r){switch(r.label){case 0:if((n=this.validateProofClaims(e)).err)throw new Error("ethauth: proof claims are invalid ".concat(n.err));return!0===t?[3,2]:[4,this.validateProofSignature(e)];case 1:if(!0!==r.sent())throw new Error("ethauth: proof signature is invalid");r.label=2;case 2:return[2,!0]}}))}))},this.validateProofSignature=function(e){return Ce(n,void 0,void 0,(function(){var t,n,r;return Ee(this,(function(i){switch(i.label){case 0:t=[],r=0,i.label=1;case 1:if(!(r<this.validators.length))return[3,6];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,(0,this.validators[r])(this.provider,this.chainId,e)];case 3:return!0===(n=i.sent().isValid)?[2,!0]:(t.push(n),[3,5]);case 4:return i.sent(),t.push(!1),[3,5];case 5:return r++,[3,1];case 6:for(r=0;r<t.length;r++)if(t[r])return[2,!0];return[2,!1]}}))}))},this.validateProofClaims=function(e){return e.validateClaims()},0==e.length?this.validators=[Oe,Ne]:this.validators=e},Ue=n(96519),De=n(17129),qe=n(84288),We=n(27690),Be=n(68264),Fe=n(12845),je=n(16675),Ge=n(31201),He=n(745),Ve=n(52384),Ke=n(85177),Je=n(54501),$e=function(e){return ke(e,!0)},Ye=function(e){return ke(JSON.stringify(e),!0)},ze=function(e){if(null!==e&&void 0!==e)return xe(e)},Qe=function(e){if(null!==e&&void 0!==e)return JSON.parse(xe(e))},Xe=function(e){return"string"===typeof e?B.lE(F.w(Ve.Y0(e))):B.lE(F.w(e))},et=function(e,t,n){return Be.P2(["string","uint256","address","bytes32"],["\x19\x01",t,e,n])},tt=function(e,t,n){return F.w(et(e,t,n))},nt=function(){return"undefined"===typeof window&&"object"===typeof Je},rt=function(){return!nt()},it=function(e){var t=e.split(".");if(3!==t.length)throw new Error("invalid jwt");return JSON.parse(xe(t[1]))};function at(){return at=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},at.apply(this,arguments)}!function(e){e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.DISABLED=5]="DISABLED"}(_e||(_e={}));var st=function(){function e(t){(0,m.Z)(this,e),this.config=t,this.logLevel=void 0,this.configure(t)}return(0,b.Z)(e,[{key:"configure",value:function(e){switch(this.config=at({},this.config,e),this.config.logLevel){case"DEBUG":this.logLevel=_e.DEBUG;break;case"INFO":default:this.logLevel=_e.INFO;break;case"WARN":this.logLevel=_e.WARN;break;case"ERROR":this.logLevel=_e.ERROR;break;case"DISABLED":this.logLevel=_e.DISABLED}void 0===this.config.silence&&(this.config.silence=!1)}},{key:"debug",value:function(e){if(!0!==this.config.silence&&this.logLevel===_e.DEBUG){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=console).log.apply(t,[e].concat(r))}}},{key:"info",value:function(e){if(!0!==this.config.silence&&this.logLevel<=_e.INFO){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=console).log.apply(t,[e].concat(r))}}},{key:"warn",value:function(e){if(!0!==this.config.silence&&this.logLevel<=_e.WARN){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=console).warn.apply(t,[e].concat(r)),this.config.onwarn&&this.config.onwarn(e,r)}}},{key:"error",value:function(e){if(!0!==this.config.silence&&this.logLevel<=_e.ERROR){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=console).error.apply(t,[e].concat(r)),this.config.onerror&&this.config.onerror(e,r)}}}]),e}(),ot=new st({logLevel:"INFO",silence:!0}),ut=function(e){return ot.configure(e)};function ct(e,t){return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];var a=Array.prototype.slice.call(r);return new Promise(function(){var n=(0,U.Z)((0,L.Z)().mark((function n(r,i){return(0,L.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,a.push((function(e,t){return e?i(e):r(t)})),n.next=4,e.apply(t,a);case 4:n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),i(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})));return function(e,t){return n.apply(this,arguments)}}())}}var lt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_SAFE_INTEGER;return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e};function ft(e,t){var n=encodeURIComponent(e),r=encodeURIComponent(JSON.stringify(t));return"".concat(n,"=").concat(r)}function ht(e){var t,n=e.split("&"),r={},i=(0,He.Z)(n);try{for(i.s();!(t=i.n()).done;){var a=t.value.split("=");r[decodeURIComponent(a[0])]=JSON.parse(decodeURIComponent(a[1]))}}catch(s){i.e(s)}finally{i.f()}return r}var dt=function(e){if(!e||"string"!==typeof e)return"";var t=e.match(/[\d.]+/);return t&&t.length>0?t[0].trim():""},pt=function(e){if(!e||"string"!==typeof e)return"";var t=e.match(/[\w\s\d]+/);return t&&t.length>0?t[0].trim():""},vt=function(e){if(!e||"string"!==typeof e)return"";var t=e.match(/[\w\d.\-:\/]+/);return t&&t.length>0?t[0].trim():""},gt=function(e){return new Promise((function(t){var n=setTimeout((function(){clearTimeout(n),t()}),e)}))},wt=function(e){var t=at({},e.types);return delete t.EIP712Domain,j.E.hash(e.domain,t,e.message)},yt=function(e){return B.lE(wt(e))},mt=Ke.zG,bt=Ke.tu,kt=Ke.mE,xt=Ke.uj,Zt=Ke.DC,Ct=Ke.p$,Et=function(e){return e.replace(/([^:]\/)\/+/g,"$1")};function _t(e){return null!=e&&(De.O$.isBigNumber(e)||"number"===typeof e&&e%1===0||"string"===typeof e&&!!e.match(/^-?[0-9]+$/)||B.A7(e)||"bigint"===typeof e||B._t(e))}var St,It=n(14771),Tt=n(87442),Ot=n(19033),Nt=n(20240);function At(){return At=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},At.apply(this,arguments)}function Pt(e){return e&&void 0!==e.chainId&&void 0!==e.name&&void 0!==e.rpcUrl&&void 0!==e.relayer}var Rt,Mt=function(e){return"number"===typeof e?e:e.chainId?e.chainId:De.O$.from(e).toNumber()},Lt=function(e){if(e)return Mt(e)},Ut=function(e){return e.find((function(e){return e.isAuthChain}))},Dt=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)throw new Error("invalid network config: empty config");var r=[];if(Array.isArray(e)?r.push.apply(r,(0,M.Z)(e)):r.push(e),0===r.length){if(t)throw new Error("invalid network config: empty config");return!1}var i=r.map((function(e){return e.chainId})).sort(),a=i.filter((function(e,t){return i.indexOf(e)!==t}));if(a.length>0){if(t)throw new Error("invalid network config: duplicate chainIds ".concat(a));return!1}r.forEach((function(e){return e.name=e.name.toLowerCase()}));var s=r.map((function(e){return e.name})).sort(),o=s.filter((function(e,t){return s.indexOf(e)!==t}));if(o.length>0){if(t)throw new Error("invalid network config: duplicate network names ".concat(o));return!1}for(var u=!1,c=!1,l=0;l<r.length;l++){var f=r[l];if((!f.rpcUrl||""===f.rpcUrl)&&!f.provider){if(t)throw new Error("invalid network config for chainId ".concat(f.chainId,": rpcUrl or provider must be provided"));return!1}if(!n&&!f.relayer){if(t)throw new Error("invalid network config for chainId ".concat(f.chainId,": relayer must be provided"));return!1}if(f.isDefaultChain){if(u){if(t)throw new Error("invalid network config for chainId ".concat(f.chainId,": DefaultChain is already set by another config"));return!1}u=!0}if(f.isAuthChain){if(c&&t)throw new Error("invalid network config for chainId ".concat(f.chainId,": AuthChain is already set by another config"));c=!0}}if(!u){if(t)throw new Error("invalid network config: DefaultChain must be set");return!1}if(!c){if(t)throw new Error("invalid network config: AuthChain must be set");return!1}return!0},qt=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Dt(e,!0,t),e},Wt=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.map((function(e){return e.chainId})).sort(),r=n.filter((function(e,t){return n.indexOf(e)!==t}));if(r.length>0){if(t)throw new Error("invalid network config: duplicate chainIds ".concat(r));return!1}return!0},Bt=function(e,t){if(e&&t){if(!e.chainId&&!e.name)throw new Error("failed to update network config: source config is missing chainId or name");if(e.chainId!==t.chainId&&e.name!==t.name)throw new Error("failed to update network config: one of chainId or name must match");e.rpcUrl&&(t.rpcUrl=e.rpcUrl,t.provider=void 0),e.provider&&(t.provider=e.provider),e.relayer&&(t.relayer=e.relayer)}},Ft=function(e){return qt(Vt(e))},jt=function(e,t){if("string"===typeof t){if(t.startsWith("0x")){var n=De.O$.from(t).toNumber();return e.find((function(e){return e.chainId===n}))}return e.find((function(e){return e.name===t}))}return"number"===typeof t?e.find((function(e){return e.chainId===t})):t.chainId?e.find((function(e){return e.chainId===t.chainId})):void 0},Gt=function(e,t){return!!e&&(e.name===t||e.chainId===t)},Ht=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].name]=e[n];return t},Vt=function(e){if(!e)return[];var t=e.sort((function(e,t){return e.chainId===t.chainId?0:e.chainId<t.chainId?-1:1})),n=t.findIndex((function(e){return e.isDefaultChain}));n>0&&t.splice(0,0,t.splice(n,1)[0]);var r=t.findIndex((function(e){return e.isAuthChain&&!0!==e.isDefaultChain}));return r>0&&t.splice(1,0,t.splice(r,1)[0]),t},Kt=function(e,t){return"string"===typeof e?(t=t||{},e.replace(/\$\{\s*([$#@\-\d\w]+)\s*\}/gim,(function(e,n){var r=t[n];return r="function"===typeof r?r():null===r||void 0===r?"":"object"===typeof r||"symbol"===typeof r?r.toString():r.valueOf()}))):""};!function(e){e[e.MAINNET=1]="MAINNET",e[e.ROPSTEN=3]="ROPSTEN",e[e.RINKEBY=4]="RINKEBY",e[e.GOERLI=5]="GOERLI",e[e.KOVAN=42]="KOVAN",e[e.POLYGON=137]="POLYGON",e[e.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",e[e.BSC=56]="BSC",e[e.BSC_TESTNET=97]="BSC_TESTNET",e[e.OPTIMISM=10]="OPTIMISM",e[e.OPTIMISM_TESTNET=69]="OPTIMISM_TESTNET",e[e.ARBITRUM=42161]="ARBITRUM",e[e.ARBITRUM_TESTNET=421611]="ARBITRUM_TESTNET",e[e.ARBITRUM_NOVA=42170]="ARBITRUM_NOVA",e[e.AVALANCHE=43114]="AVALANCHE",e[e.AVALANCHE_TESTNET=43113]="AVALANCHE_TESTNET",e[e.FANTOM=250]="FANTOM",e[e.FANTOM_TESTNET=4002]="FANTOM_TESTNET",e[e.GNOSIS=100]="GNOSIS",e[e.AURORA=1313161554]="AURORA",e[e.AURORA_TESTNET=1313161556]="AURORA_TESTNET"}(Rt||(Rt={}));var Jt=function(e){return Kt("https://${network}-indexer.sequence.app",{network:e})},$t=function(e){return Kt("https://${network}-relayer.sequence.app",{network:e})},Yt=function(e){return Kt("https://nodes.sequence.app/${network}",{network:e})},zt=(St={},(0,Nt.Z)(St,Rt.MAINNET,{chainId:Rt.MAINNET,name:"mainnet",title:"Ethereum",blockExplorer:{name:"Etherscan",rootUrl:"https://etherscan.io/"}}),(0,Nt.Z)(St,Rt.ROPSTEN,{chainId:Rt.ROPSTEN,name:"ropsten",title:"Ropsten",testnet:!0,blockExplorer:{name:"Etherscan (Ropsten)",rootUrl:"https://ropsten.etherscan.io/"}}),(0,Nt.Z)(St,Rt.RINKEBY,{chainId:Rt.RINKEBY,name:"rinkeby",title:"Rinkeby",testnet:!0,blockExplorer:{name:"Etherscan (Rinkeby)",rootUrl:"https://rinkeby.etherscan.io/"},disabled:!0}),(0,Nt.Z)(St,Rt.GOERLI,{chainId:Rt.GOERLI,name:"goerli",title:"Goerli",testnet:!0,blockExplorer:{name:"Etherscan (Goerli)",rootUrl:"https://goerli.etherscan.io/"}}),(0,Nt.Z)(St,Rt.KOVAN,{chainId:Rt.KOVAN,name:"kovan",title:"Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Kovan)",rootUrl:"https://kovan.etherscan.io/"}}),(0,Nt.Z)(St,Rt.POLYGON,{chainId:Rt.POLYGON,name:"polygon",title:"Polygon",blockExplorer:{name:"Polygonscan",rootUrl:"https://polygonscan.com/"}}),(0,Nt.Z)(St,Rt.POLYGON_MUMBAI,{chainId:Rt.POLYGON_MUMBAI,name:"mumbai",title:"Polygon Mumbai",testnet:!0,blockExplorer:{name:"Polygonscan (Mumbai)",rootUrl:"https://mumbai.polygonscan.com/"}}),(0,Nt.Z)(St,Rt.BSC,{chainId:Rt.BSC,name:"bsc",title:"BNB Smart Chain",blockExplorer:{name:"BSCScan",rootUrl:"https://bscscan.com/"}}),(0,Nt.Z)(St,Rt.BSC_TESTNET,{chainId:Rt.BSC_TESTNET,name:"bsc-testnet",title:"BNB Smart Chain Testnet",testnet:!0,blockExplorer:{name:"BSCScan (Testnet)",rootUrl:"https://testnet.bscscan.com/"}}),(0,Nt.Z)(St,Rt.OPTIMISM,{chainId:Rt.OPTIMISM,name:"optimism",title:"Optimism",blockExplorer:{name:"Etherscan (Optimism)",rootUrl:"https://optimistic.etherscan.io/"}}),(0,Nt.Z)(St,Rt.OPTIMISM_TESTNET,{chainId:Rt.OPTIMISM_TESTNET,name:"optimism-testnet",title:"Optimistic Kovan",testnet:!0,blockExplorer:{name:"Etherscan (Optimism Testnet)",rootUrl:"https://kovan-optimistic.etherscan.io/"}}),(0,Nt.Z)(St,Rt.ARBITRUM,{chainId:Rt.ARBITRUM,name:"arbitrum",title:"Arbitrum One",blockExplorer:{name:"Arbiscan",rootUrl:"https://arbiscan.io/"}}),(0,Nt.Z)(St,Rt.ARBITRUM_TESTNET,{chainId:Rt.ARBITRUM_TESTNET,name:"arbitrum-testnet",title:"Arbitrum Testnet",testnet:!0,blockExplorer:{name:"Arbiscan (Testnet)",rootUrl:"https://testnet.arbiscan.io/"}}),(0,Nt.Z)(St,Rt.ARBITRUM_NOVA,{chainId:Rt.ARBITRUM_NOVA,name:"arbitrum-nova",title:"Arbitrum Nova",blockExplorer:{name:"Nova Explorer",rootUrl:"https://nova-explorer.arbitrum.io/"}}),(0,Nt.Z)(St,Rt.AVALANCHE,{chainId:Rt.AVALANCHE,name:"avalanche",title:"Avalanche",blockExplorer:{name:"Snowtrace",rootUrl:"https://snowtrace.io/"}}),(0,Nt.Z)(St,Rt.AVALANCHE_TESTNET,{chainId:Rt.AVALANCHE_TESTNET,name:"avalanche-testnet",title:"Avalanche Testnet",testnet:!0,blockExplorer:{name:"Snowtrace (Testnet)",rootUrl:"https://testnet.snowtrace.io/"}}),(0,Nt.Z)(St,Rt.FANTOM,{chainId:Rt.FANTOM,name:"fantom",title:"Fantom",blockExplorer:{name:"FTMScan",rootUrl:"https://ftmscan.com/"}}),(0,Nt.Z)(St,Rt.FANTOM_TESTNET,{chainId:Rt.FANTOM_TESTNET,name:"fantom-testnet",title:"Fantom Testnet",testnet:!0,blockExplorer:{name:"FTMScan (Testnet)",rootUrl:"https://testnet.ftmscan.com/"}}),(0,Nt.Z)(St,Rt.GNOSIS,{chainId:Rt.GNOSIS,name:"gnosis",title:"Gnosis Chain",blockExplorer:{name:"Gnosis Chain Explorer",rootUrl:"https://blockscout.com/xdai/mainnet/"}}),(0,Nt.Z)(St,Rt.AURORA,{chainId:Rt.AURORA,name:"aurora",title:"Aurora",blockExplorer:{name:"Aurora Explorer",rootUrl:"https://aurorascan.dev/"}}),(0,Nt.Z)(St,Rt.AURORA_TESTNET,{chainId:Rt.AURORA_TESTNET,name:"aurora-testnet",title:"Aurora Testnet",blockExplorer:{name:"Aurora Explorer (Testnet)",rootUrl:"https://testnet.aurorascan.dev/"}}),St),Qt=Ft([At({},zt[Rt.MAINNET],{rpcUrl:Yt("mainnet"),relayer:{url:$t("mainnet")},indexerUrl:Jt("mainnet")}),At({},zt[Rt.POLYGON],{rpcUrl:Yt("polygon"),relayer:{url:$t("polygon")},indexerUrl:Jt("polygon"),isDefaultChain:!0,isAuthChain:!0}),At({},zt[Rt.BSC],{rpcUrl:Yt("bsc"),indexerUrl:Jt("bsc"),relayer:{url:$t("bsc")}}),At({},zt[Rt.AVALANCHE],{rpcUrl:Yt("avalanche"),indexerUrl:Jt("avalanche"),relayer:{url:$t("avalanche")}}),At({},zt[Rt.ARBITRUM],{rpcUrl:Yt("arbitrum"),indexerUrl:Jt("arbitrum"),relayer:{url:$t("arbitrum")}}),At({},zt[Rt.ARBITRUM_NOVA],{rpcUrl:Yt("arbitrum-nova"),indexerUrl:Jt("arbitrum-nova"),relayer:{url:$t("arbitrum-nova")}}),At({},zt[Rt.OPTIMISM],{rpcUrl:Yt("optimism"),indexerUrl:Jt("optimism"),relayer:{url:$t("optimism")}})]),Xt=Ft([At({},zt[Rt.RINKEBY],{rpcUrl:Yt("rinkeby"),relayer:{url:$t("rinkeby")},indexerUrl:Jt("rinkeby")}),At({},zt[Rt.GOERLI],{rpcUrl:Yt("goerli"),relayer:{url:$t("goerli")},indexerUrl:Jt("goerli")}),At({},zt[Rt.POLYGON_MUMBAI],{rpcUrl:Yt("mumbai"),relayer:{url:$t("mumbai")},indexerUrl:Jt("mumbai"),isDefaultChain:!0,isAuthChain:!0}),At({},zt[Rt.BSC_TESTNET],{rpcUrl:Yt("bsc-testnet"),relayer:{url:$t("bsc-testnet")},indexerUrl:Jt("bsc-testnet")})]),en={factory:"0xf9D09D634Fb818b05149329C1dcCFAeA53639d96",mainModule:"0xd01F11855bCcb95f88D7A48492F66410d4637313",mainModuleUpgradable:"0x7EFE6cE415956c5f80C6530cC6cc81b4808F6118",guestModule:"0x02390F3E6E5FD1C6786CB78FD3027C117a9955A7",sequenceUtils:"0xd130B43062D875a4B7aF3f8fc036Bc6e9D3E1B3E",libs:{requireFreshSigner:"0xE6B9B21C077F382333220a072e4c44280b873907"}},tn="2.0",nn=function(){function e(t,n){(0,m.Z)(this,e),this.sender=void 0,this.handler=void 0,this.sender=n,t&&this.setMiddleware(t)}return(0,b.Z)(e,[{key:"setMiddleware",value:function(e){this.handler=rn(e,this.sender.sendAsync)}},{key:"sendAsync",value:function(e,t,n){try{this.handler(e,t,n)}catch(r){t(r,void 0)}}}]),e}(),rn=function(e,t){if(0===e.length)return t;var n,r=function(e){return e.sendAsyncMiddleware?e.sendAsyncMiddleware:e};n=r(e[e.length-1])(t);for(var i=e.length-2;i>=0;i--)n=r(e[i])(n);return n};function an(e){return void 0!==e&&void 0!==e.send&&void 0!==e.constructor.defaultUrl&&void 0!==e.detectNetwork&&void 0!==e.getSigner&&void 0!==e.perform}function sn(e){return void 0!==e&&void 0!==e.sendAsync}var on,un=0,cn=(0,b.Z)((function e(t,n){var r=this;(0,m.Z)(this,e),this.send=void 0,this.request=void 0,this.defaultChainId=void 0,this.sendAsync=function(e,t,n){r.send(e.method,e.params,n||r.defaultChainId).then((function(n){t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((function(e){t(e,void 0)}))},this.defaultChainId=n,an(t)?this.send=t.send.bind(t):sn(t)?this.send=function(e,n,i){return new Promise((function(a,s){t.sendAsync({jsonrpc:tn,id:++un,method:e,params:n},(function(e,t){e?s(e):a(t?t.result:void 0)}),i||r.defaultChainId)}))}:this.send=t,this.request=function(e,t){return r.send(e.method,e.params,t)}})),ln=(0,b.Z)((function e(t){var n=this;(0,m.Z)(this,e),this.provider=t,this.sendAsync=function(e,t){n.provider.send(e.method,e.params).then((function(n){t(void 0,{jsonrpc:"2.0",id:e.id,result:n})})).catch((function(e){t(e,void 0)}))},this.send=this.sendAsync})),fn=function(){function e(t){(0,m.Z)(this,e),this.sendAsyncMiddleware=void 0,this.isAllowedFunc=void 0,this.isAllowedFunc=t||function(e){return!0},this.sendAsyncMiddleware=hn(this.isAllowedFunc)}return(0,b.Z)(e,[{key:"setIsAllowedFunc",value:function(e){this.isAllowedFunc=e,this.sendAsyncMiddleware=hn(this.isAllowedFunc)}}]),e}(),hn=function(e){return function(t){return function(n,r,i){if(!e(n))throw new Error("allowProvider middleware precondition is unmet.");t(n,r,i)}}},dn=function(){function e(t){var n=this;(0,m.Z)(this,e),this.cachableJsonRpcMethods=["net_version","eth_chainId","eth_accounts","sequence_getWalletContext","sequence_getNetworks"],this.cache=void 0,this.onUpdateCallback=void 0,this.defaultChainId=void 0,this.sendAsyncMiddleware=function(e){return function(t,r,i){if(n.cachableJsonRpcMethods.includes(t.method)){var a=n.cacheKey(t.method,t.params,i||n.defaultChainId),s=n.getCacheValue(a);if(s&&""!==s)return void r(void 0,{jsonrpc:"2.0",id:t.id,result:s})}e(t,(function(e,i,a){if(n.cachableJsonRpcMethods.includes(t.method)&&i&&i.result){var s=n.cacheKey(t.method,t.params,a||n.defaultChainId);n.setCacheValue(s,i.result)}r(e,i)}),i||n.defaultChainId)}},this.cacheKey=function(e,t,n){var r="";return r=n?"".concat(n,":").concat(e,":"):":".concat(e,":"),t&&0!==t.length?r+JSON.stringify(t):r+"[]"},this.getCache=function(){return n.cache},this.setCache=function(e){n.cache=e,n.onUpdateCallback&&n.onUpdateCallback()},this.getCacheValue=function(e){return n.cache[e]},this.setCacheValue=function(e,t){n.cache[e]=t,n.onUpdateCallback&&n.onUpdateCallback(e,t)},this.clearCache=function(){n.cache={}},this.cache={},this.defaultChainId=t}return(0,b.Z)(e,[{key:"onUpdate",value:function(e){this.onUpdateCallback=e}}]),e}(),pn=(0,b.Z)((function e(t){var n=this;(0,m.Z)(this,e),this.props=void 0,this.sendAsyncMiddleware=function(e){return function(t,r,i){var a=t.id;switch(t.method){case"net_version":if(n.props.chainId)return void r(void 0,{jsonrpc:"2.0",id:a,result:"".concat(n.props.chainId)});break;case"eth_chainId":if(n.props.chainId)return void r(void 0,{jsonrpc:"2.0",id:a,result:B.Dv(n.props.chainId)});break;case"eth_accounts":if(n.props.accountAddress)return void r(void 0,{jsonrpc:"2.0",id:a,result:[We.Kn(n.props.accountAddress)]});break;case"sequence_getWalletContext":if(n.props.walletContext)return void r(void 0,{jsonrpc:"2.0",id:a,result:n.props.walletContext})}e(t,r,i)}},this.props=t})),vn=function(e){return function(t,n,r){e(t,(function(e,t){if(!e&&t&&t.error)throw"string"===typeof t.error?new Error(t.error):new Error(t.error.message);n(e,t)}),r)}},gn=function(e){return function(t,n,r){var i=r?" chainId:".concat(r):"";ot.info("[provider request]".concat(i," id:").concat(t.id," method:").concat(t.method," params:"),t.params),e(t,(function(e,r){e?ot.warn("[provider response]".concat(i," id:").concat(t.id," method:").concat(t.method," params:"),t.params,"error:",e):ot.info("[provider response]".concat(i," id:").concat(t.id," method:").concat(t.method," params:"),t.params,"response:",r),n(e,r)}),r)}},wn=function(e){return function(t){return function(n,r,i){var a=e(n),s=n.id;switch(n.method){case"net_version":return void r(void 0,{jsonrpc:"2.0",id:s,result:"".concat(a)});case"eth_chainId":return void r(void 0,{jsonrpc:"2.0",id:s,result:B.Dv(a)})}t(n,r,i)}}},yn=["personal_sign","eth_sign","eth_signTypedData","eth_signTypedData_v4","eth_sendTransaction","eth_sendRawTransaction","sequence_getWalletContext","sequence_getWalletConfig","sequence_getWalletState","sequence_getNetworks","sequence_updateConfig","sequence_publishConfig","sequence_gasRefundOptions","sequence_getNonce","sequence_relay","eth_decrypt","eth_getEncryptionPublicKey","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],mn=(0,b.Z)((function e(t){var n=this;(0,m.Z)(this,e),this.provider=void 0,this.sendAsyncMiddleware=function(e){return function(t,r,i){yn.includes(t.method)?n.provider.sendAsync(t,r,i):e(t,r,i)}},this.provider=t})),bn=function(){function e(t){var n=this;(0,m.Z)(this,e),this.privateJsonRpcMethods=["net_version","eth_chainId","eth_accounts"].concat(yn),this.provider=void 0,this.rpcUrl=void 0,this.sendAsyncMiddleware=function(e){return function(t,r){!n.provider||n.privateJsonRpcMethods.includes(t.method)?(ot.debug("[public-provider] sending request to signer window",t.method),e(t,r)):n.provider.send(t.method,t.params).then((function(e){r(void 0,{jsonrpc:"2.0",id:t.id,result:e})})).catch((function(e){return r(e)}))}},t&&this.setRpcUrl(t)}return(0,b.Z)(e,[{key:"getRpcUrl",value:function(){return this.rpcUrl}},{key:"setRpcUrl",value:function(e){e&&""!==e?(this.rpcUrl=e,this.provider=new D.r(e)):(this.rpcUrl=void 0,this.provider=void 0)}}]),e}();function kn(){return kn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},kn.apply(this,arguments)}function xn(e,t){return Zn.apply(this,arguments)}function Zn(){return(Zn=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t;case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),r=n instanceof Function?n(e.t0):n,e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function Cn(e,t){return e.reduce((function(e,n,r){return t(n,r)?e[0].push(n):e[1].push(n),e}),[[],[]])}function En(e){if(void 0===e)return"latest";switch(e){case"earliest":case"latest":case"pending":return e}return De.O$.from(e)}!function(e){e.ethCall="eth_call",e.ethGetBalance="eth_getBalance",e.ethGetCode="eth_getCode"}(on||(on={}));var _n={batchSize:50,timeWindow:50,contract:en.sequenceUtils,verbose:!1},Sn=function(){function e(t){var n=this;(0,m.Z)(this,e);var r=this;if(this.batchableJsonRpcMethods=[on.ethCall,on.ethGetCode,on.ethGetBalance],this.multicallInterface=new Tt.vU(g.sequenceUtils.abi),this.options=void 0,this.timeout=void 0,this.queue=[],this.scheduleExecution=function(){n.queue.length>0&&(n.timeout&&clearTimeout(n.timeout),n.timeout=setTimeout(n.run,n.options.timeWindow))},this.handle=function(e,t,r){return n.batchableJsonRpcMethods.find((function(e){return e===t.method}))?(n.queue.push({request:t,callback:r,next:e}),n.options.verbose&&console.log("Scheduling call",t.method),void n.scheduleExecution()):(n.options.verbose&&console.log("Forwarded call",t.method),e(t,r))},this.run=(0,U.Z)((0,L.Z)().mark((function e(){var t,n,i,a,s,o,u,c,l,f,h,d,p,v;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.options.verbose&&console.log("Processing multicall"),0!==(t=Math.min(r.options.batchSize,r.queue.length))){e.next=4;break}return e.abrupt("return");case 4:if(1!==t){e.next=9;break}return r.forward(r.queue[0]),r.queue=[],r.options.verbose&&console.log("Skip multicall, single item"),e.abrupt("return");case 9:if(r.options.verbose&&console.log("Resolving",t),n=r.queue.slice(0,t),r.queue=t===r.queue.length?[]:r.queue.slice(t),r.options.verbose&&console.log("Updated queue",r.queue.length),0!==r.queue.length&&r.scheduleExecution(),i=n[0].next,s=Cn(n,(function(e){try{if(e.next!==i)return!1;switch(e.request.method){case on.ethCall:if(e.request.params[0].from||e.request.params[0].gasPrice||e.request.params[0].value)return!1;case on.ethGetBalance:case on.ethGetCode:var t=En(e.request.params[1]);if(void 0===a&&(a=t),(n=t)!==(r=a)&&!(De.O$.isBigNumber(n)?De.O$.isBigNumber(r)&&n.eq(r):!De.O$.isBigNumber(r)&&n===r))return!1}return!0}catch(s){return!1}var n,r})),o=(0,P.Z)(s,2),n=o[0],0===(u=o[1]).length){e.next=21;break}if(r.options.verbose&&console.log("Forwarding incompatible calls",u.length),r.forward(u),0!==n.length){e.next=21;break}return e.abrupt("return");case 21:if(c=n.map((function(e){try{switch(e.request.method){case on.ethCall:return{delegateCall:!1,revertOnError:!1,target:e.request.params[0].to,data:e.request.params[0].data,gasLimit:e.request.params[0].gas?e.request.params[0].gas:0,value:0};case on.ethGetCode:return{delegateCall:!1,revertOnError:!1,target:r.options.contract,gasLimit:0,value:0,data:r.multicallInterface.encodeFunctionData(r.multicallInterface.getFunction("callCode"),[e.request.params[0]])};case on.ethGetBalance:return{delegateCall:!1,revertOnError:!1,target:r.options.contract,gasLimit:0,value:0,data:r.multicallInterface.encodeFunctionData(r.multicallInterface.getFunction("callBalanceOf"),[e.request.params[0]])};default:return null}}catch(t){return null}})),l=Cn(n,(function(e,t){return void 0!==c[t]})),f=(0,P.Z)(l,2),n=f[0],u=f[1],c=c.filter((function(e){return e})),0===u.length){e.next=29;break}if(r.options.verbose&&console.log("Forwarding calls on error",u.length),r.forward(u),0!==n.length){e.next=29;break}return e.abrupt("return");case 29:e.prev=29,h=r.multicallInterface.encodeFunctionData(r.multicallInterface.getFunction("multiCall"),[c]),e.next=37;break;case 33:return e.prev=33,e.t0=e.catch(29),r.forward(n),e.abrupt("return");case 37:return d=lt(),e.next=40,xn(ct(i)({id:d,jsonrpc:tn,method:on.ethCall,params:[{to:r.options.contract,value:0,data:h},De.O$.isBigNumber(a)?a.toNumber():a]}),(function(e){return{jsonrpc:tn,id:d,result:void 0,error:e}}));case 40:if(!(p=e.sent).error){e.next=43;break}return e.abrupt("return",r.forward(n));case 43:e.prev=43,v=r.multicallInterface.decodeFunctionResult(r.multicallInterface.getFunction("multiCall"),p.result),e.next=51;break;case 47:return e.prev=47,e.t1=e.catch(43),r.forward(n),e.abrupt("return");case 51:r.options.verbose&&console.log("Got response for",n.length),n.forEach((function(e,t){if(v[0][t])switch(e.request.method){case on.ethCall:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:v[1][t]});break;case on.ethGetCode:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:Fe.$.decode(["bytes"],v[1][t])[0]});break;case on.ethGetBalance:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:Fe.$.decode(["uint256"],v[1][t])[0]})}else r.forward(e)}));case 53:case"end":return e.stop()}}),e,null,[[29,33],[43,47]])}))),this.options=t?kn({},e.DefaultOptions,t):e.DefaultOptions,this.options.batchSize<=0)throw new Error("Invalid batch size of ".concat(this.options.batchSize))}return(0,b.Z)(e,[{key:"forward",value:function(e){Array.isArray(e)?e.forEach((function(e){return e.next(e.request,e.callback)})):e.next(e.request,e.callback)}}],[{key:"isMulticall",value:function(t){return t&&void 0!==t.handle&&void 0!==t.conf&&e.isMulticallOptions(t.options)}},{key:"isMulticallOptions",value:function(e){return void 0!==e&&void 0!==e.batchSize&&void 0!==e.timeWindow&&void 0!==e.contract}}]),e}();Sn.DefaultOptions=kn({},_n);var In,Tn=["getNetwork","getBlockNumber","getGasPrice","getTransactionCount","getStorageAt","sendTransaction","estimateGas","getBlock","getTransaction","getTransactionReceipt","getLogs","emit","litenerCount","addListener","removeListener","waitForTransaction","detectNetwork","getBlockWithTransactions"],On=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i,a;return(0,m.Z)(this,n),i=t.call(this,e.getNetwork()),a=(0,It.Z)(i),i.provider=e,i.multicall=void 0,i.listenerCount=i.provider.listenerCount,i.getResolver=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=a.provider).getResolver){e.next=12;break}return e.t0=n,e.next=5,t;case 5:return e.t1=e.sent,e.next=8,e.t0.getResolver.call(e.t0,e.t1);case 8:if(r=e.sent){e.next=11;break}return e.abrupt("return",null);case 11:return e.abrupt("return",new Ot.H2(a,r.address,r.name));case 12:return e.t2=n,e.next=15,t;case 15:return e.t3=e.sent,e.abrupt("return",e.t2.getResolver.call(e.t2,e.t3));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.next=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,e.t0=t.method,e.next=e.t0===on.ethCall?4:e.t0===on.ethGetCode?12:e.t0===on.ethGetBalance?20:28;break;case 4:return e.t1=a,e.t2=t,e.t3=n,e.next=9,a.provider.call(t.params[0],t.params[1]);case 9:return e.t4=e.sent,e.t1.callback.call(e.t1,e.t2,e.t3,e.t4),e.abrupt("break",28);case 12:return e.t5=a,e.t6=t,e.t7=n,e.next=17,a.provider.getCode(t.params[0],t.params[1]);case 17:return e.t8=e.sent,e.t5.callback.call(e.t5,e.t6,e.t7,e.t8),e.abrupt("break",28);case 20:return e.t9=a,e.t10=t,e.t11=n,e.next=25,a.provider.getBalance(t.params[0],t.params[1]);case 25:return e.t12=e.sent,e.t9.callback.call(e.t9,e.t10,e.t11,e.t12),e.abrupt("break",28);case 28:e.next=33;break;case 30:e.prev=30,e.t13=e.catch(0),a.callback(t,n,void 0,e.t13);case 33:case"end":return e.stop()}}),e,null,[[0,30]])})));return function(t,n){return e.apply(this,arguments)}}(),i.multicall=Sn.isMulticall(r)?r:new Sn(r),Tn.forEach((function(t){void 0!==e[t]&&(i[t]=function(){return e[t].apply(e,arguments)})})),i}return(0,b.Z)(n,[{key:"callback",value:function(e,t,n,r){t(r,{jsonrpc:tn,id:e.id,result:n,error:r})}},{key:"call",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rpcCall(on.ethCall,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCode",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rpcCall(on.ethGetCode,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getBalance",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rpcCall(on.ethGetBalance,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"rpcCall",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a,s,o=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=lt(),r=o.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=o[a];return e.next=4,ct(this.multicall.handle)(this.next,{jsonrpc:tn,id:n,method:t,params:i});case 4:return s=e.sent,e.abrupt("return",s.result);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Ot.Zk),Nn=function(){function e(t,n){var r=this;if((0,m.Z)(this,e),this.provider=t,this.multicall=void 0,this.multicall=Sn.isMulticall(n)?n:new Sn(n),t.send){var i=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(n,r){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.send(n,r);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();this.send=function(e,t){r.multicall.handle(i,e,t)}}if(t.sendAsync){var a=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(n,r){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.sendAsync(n,r);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();this.sendAsync=function(e,t){r.multicall.handle(a,e,t)}}}return(0,b.Z)(e,[{key:"isMetaMask",get:function(){return this.provider.isMetaMask}},{key:"isStatus",get:function(){return this.provider.isStatus}}]),e}(),An=Object.freeze({__proto__:null,ProxyMethods:Tn,MulticallProvider:On,MulticallExternalProvider:Nn,multicallMiddleware:function(e){return function(t){var n=Sn.isMulticall(e)?e:new Sn(e);return function(e,r){return n.handle(t,e,r)}}}}),Pn="0x603a600e3d39601a805130553df3363d3d373d3d3d363d30545af43d82803e903d91601857fd5bf3",Rn="@sequence.config.imageHashes",Mn=function(e){return"@sequence.config.".concat(e)};try{In=localStorage}catch(Vs){var Ln=new Map;In={getItem:function(e){var t;return null!=(t=Ln.get(e))?t:null},setItem:function(e,t){return Ln.set(e,t)},removeItem:function(e){return Ln.delete(e)}}}function Un(e){var t,n=JSON.parse(null!=(t=In.getItem(Mn(e)))?t:"null");return n?(Dn(e),n):void 0}function Dn(e){var t,n=JSON.parse(null!=(t=In.getItem(Rn))?t:"[]");for((n=n.filter((function(t){return t!==e}))).push(e);n.length>10;)In.removeItem(Mn(n.shift()));In.setItem(Rn,JSON.stringify(n))}var qn=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={threshold:t,signers:[]},n.forEach(function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=r.signers,e.t1=t.weight,!Ue.E.isSigner(t.signer)){e.next=8;break}return e.next=5,t.signer.getAddress();case 5:e.t2=e.sent,e.next=9;break;case 8:e.t2=t.signer;case 9:e.t3=e.t2,e.t4={weight:e.t1,address:e.t3},e.t0.push.call(e.t0,e.t4);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Wn(r)){e.next=4;break}throw new Error("wallet config is not usable");case 4:return e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Wn=function(e){return e.signers.reduce((function(e,t){return De.O$.from(t.weight).add(e)}),qe._Y).gte(De.O$.from(e.threshold))},Bn=function(e,t){if(0===t.length)return!0;var n=e.signers.map((function(e){return We.Kn(e.address)})),r=t.map((function(e){return We.Kn(e)})),i=!0;return r.forEach((function(e){n.includes(e)||(i=!1)})),i},Fn=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("string"===typeof t){var i=F.w(Be.P2(["bytes","bytes32"],[Pn,B.$m(n.mainModule,32)])),a=F.w(Be.P2(["bytes1","address","bytes32","bytes32"],["0xff",n.factory,t,i]));return We.Kn(B.p3(a,12))}return t.address&&!r?t.address:e(jn(t),n)},jn=function(e){var t=(e=Gn(e)).signers.reduce((function(e,t){return F.w(Fe.$.encode(["bytes32","uint8","address"],[e,t.weight,t.address]))}),Be.P2(["uint256"],[e.threshold]));return function(e,t){In.setItem(Mn(e),JSON.stringify(t)),Dn(e)}(t,e),t},Gn=function(e){e.signers.sort((function(e,t){return Vn(e.address,t.address)})),e.signers.forEach((function(e){return e.address=We.Kn(e.address)})),e.address&&(e.address=We.Kn(e.address));var t=e.signers.map((function(e){return e.address}));if(t.filter((function(e,n){return t.indexOf(e)!==n})).length>0)throw new Error("invalid wallet config: duplicate signer addresses detected in the config, ${signerDupes}");return e},Hn=function(e,t){return jn(e)===jn(t)},Vn=function(e,t){var n=De.O$.from(e),r=De.O$.from(t);return n.lt(r)?-1:n.eq(r)?0:1};function Kn(e,t){var n,r=function(e){return{weight:De.O$.from(e.weight).toNumber(),address:We.Kn(e.address)}},i=e.signers.map(r),a=t.set?t.set.map(r):[],s=t.del?t.del.map((function(e){return We.Kn(e.address)})):[],o=a.map((function(e){return e.address})),u=(n=i.filter((function(e){return-1===s.indexOf(e.address)&&-1===o.indexOf(e.address)}))).concat.apply(n,(0,M.Z)(a));return Gn({address:e.address,threshold:t.threshold?De.O$.from(t.threshold).toNumber():e.threshold,signers:u})}function Jn(e,t){return Gn({threshold:De.O$.from(e).toNumber(),signers:t.map((function(e){return{weight:De.O$.from(e.weight).toNumber(),address:We.Kn(e.address)}}))})}var $n=(0,b.Z)((function e(){(0,m.Z)(this,e),this.findCurrentConfig=void 0,this.findLastWalletOfInitialSigner=void 0}));function Yn(){return Yn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Yn.apply(this,arguments)}var zn,Qn=(0,b.Z)((function e(t){(0,m.Z)(this,e);var n=this;this.authProvider=t,this.findCurrentConfig=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var r,i,a,s,o,u,c,l,f,h,d,p,v;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.provider,i=t.context,a=t.ignoreIndex,s=t.requireIndex,o=t.skipCache,u=We.Kn(t.address),ot.info("[findCurrentConfig] address:".concat(u,", ignoreIndex:").concat(a,", requireIndex:").concat(s)),!s||!a){e.next=5;break}throw Error("findCurrentConfig: can't ignore index and require index");case 5:return c=r.getNetwork(),l=t.knownConfigs?t.knownConfigs:[],e.next=9,n.findCurrentImageHash(i,r,u,l,o);case 9:if(f=e.sent,h=f.imageHash,d=f.config,void 0!==h){e.next=14;break}return e.abrupt("return",{config:void 0});case 14:return e.next=16,n.findConfigForImageHash(i,h,d?[d].concat((0,M.Z)(l)):l,o);case 16:return p=e.sent,e.next=19,c;case 19:return v=e.sent.chainId,e.abrupt("return",{config:p?Yn({},p,{chainId:v,address:u}):void 0});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.findLastWalletOfInitialSigner=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var r,i,a,s,o,u,c,l,f;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.signer,i=t.context,a=t.ignoreIndex,s=t.requireIndex,ot.info("[findLastWalletOfInitialSigner] signer:".concat(r)),!s||!a){e.next=4;break}throw Error("findCurrentConfig: can't ignore index and require index");case 4:if(o=new W.CH(i.sequenceUtils,g.sequenceUtils.abi,n.authProvider),!a){e.next=9;break}e.t0=0,e.next=12;break;case 9:return e.next=11,o.lastSignerUpdate(r);case 11:e.t0=e.sent.toNumber();case 12:if(u=e.t0,!s||0!==u){e.next=15;break}return e.abrupt("return",{wallet:void 0});case 15:return c=o.filters.RequiredSigner(null,r),e.next=18,n.findLatestLog(n.authProvider,Yn({},c,{fromBlock:u,toBlock:0!==u?u:"latest"}));case 18:if(void 0!==(l=e.sent)){e.next=22;break}return ot.warn("publishConfig: wallet config last log not found"),e.abrupt("return",{wallet:void 0});case 22:return f=o.interface.decodeEventLog("RequiredSigner",l.data,l.topics),e.abrupt("return",{wallet:f._wallet});case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.findConfigForImageHash=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,r){var i,a,s,o,u,c,l,f,h,d,p,v=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=v.length>2&&void 0!==v[2]?v[2]:[],a=v.length>3&&void 0!==v[3]&&v[3],!(s=i.find((function(e){return jn(e)===r})))){e.next=5;break}return e.abrupt("return",s);case 5:if(a){e.next=9;break}if(!(o=Un(r))){e.next=9;break}return e.abrupt("return",o);case 9:return ot.info("[findConfigForImageHash] image:".concat(r)),u=new W.CH(t.sequenceUtils,g.sequenceUtils.abi,n.authProvider),e.next=13,u.lastImageHashUpdate(r);case 13:return c=e.sent.toNumber(),l=u.filters.RequiredConfig(void 0,r),e.next=17,n.findLatestLog(n.authProvider,Yn({},l,{fromBlock:c,toBlock:0!==c?c:"latest"}));case 17:if(void 0!==(f=e.sent)){e.next=20;break}return e.abrupt("return",void 0);case 20:return h=u.interface.decodeEventLog("RequiredConfig",f.data,f.topics),d=Fe.$.decode(["tuple(\n        uint256 weight,\n        address signer\n      )[]"],h._signers)[0],p={threshold:De.O$.from(h._threshold).toNumber(),signers:d.map((function(e){return{address:e.signer,weight:De.O$.from(e.weight).toNumber()}}))},jn(p),e.abrupt("return",p);case 25:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.findCurrentImageHash=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,r,i){var a,s,o,u,c,l,f,h,d,p,v,w,y,m,b=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=b.length>3&&void 0!==b[3]?b[3]:[],s=b.length>4?b[4]:void 0,ot.info("[findCurrentImageHash] address:".concat(i)),o=new W.CH(i,g.mainModuleUpgradable.abi,r),e.next=6,o.functions.imageHash.call([]).catch((function(){return[]}));case 6:if(void 0===(u=e.sent)[0]){e.next=9;break}return e.abrupt("return",{imageHash:u[0],config:s?void 0:Un(u[0])});case 9:if(c=We.Kn(i),!(l=a.find((function(e){return Fn(e,t,!0)===c})))){e.next=13;break}return e.abrupt("return",{imageHash:jn(l),config:l});case 13:return f=new W.CH(t.sequenceUtils,g.sequenceUtils.abi,n.authProvider),e.next=16,f.knownImageHashes(i);case 16:if((h=e.sent)===je.R){e.next=21;break}if(Fn(h,t)===i){e.next=20;break}throw Error("findCurrentImageHash: inconsistent RequireUtils results");case 20:return e.abrupt("return",{imageHash:h});case 21:return d=f.filters.RequiredConfig(i),e.next=24,n.findFirstLog(n.authProvider,d);case 24:if(void 0===(p=e.sent)){e.next=32;break}if(v=f.interface.decodeEventLog("RequiredConfig",p.data,p.topics),w=Fe.$.decode(["tuple(\n          uint256 weight,\n          address signer\n        )[]"],v._signers)[0],y={threshold:De.O$.from(v._threshold).toNumber(),signers:w.map((function(e){return{address:e.signer,weight:De.O$.from(e.weight).toNumber()}}))},m=jn(y),Fn(m,t)!==i){e.next=32;break}return e.abrupt("return",{imageHash:m,config:y});case 32:return e.abrupt("return",{});case 33:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.findLatestLog=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,r){var i,a,s,o,u;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("latest"!==r.toBlock){e.next=6;break}return e.next=3,t.getBlockNumber();case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=r.toBlock;case 7:return i=e.t0,0===(a=r.fromBlock)&&ot.warn("findLatestLog: expensive getLogs query fromBlock 0 toBlock ".concat(i)),e.prev=10,e.next=13,t.getLogs(Yn({},r,{toBlock:i}));case 13:return s=e.sent,e.abrupt("return",0===s.length?void 0:s[s.length-1]);case 17:return e.prev=17,e.t1=e.catch(10),o=Math.floor((i-a)/2+a),e.next=22,n.findLatestLog(t,Yn({},r,{fromBlock:o,toBlock:i}));case 22:if(void 0===(u=e.sent)){e.next=25;break}return e.abrupt("return",u);case 25:return e.abrupt("return",n.findLatestLog(t,Yn({},r,{fromBlock:a,toBlock:o})));case 26:case"end":return e.stop()}}),e,null,[[10,17]])})));return function(t,n){return e.apply(this,arguments)}}(),this.findFirstLog=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,r){var i,a,s,o,u;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("latest"!==r.toBlock&&r.toBlock){e.next=6;break}return e.next=3,t.getBlockNumber();case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=r.toBlock;case 7:return i=e.t0,0===(a=r.fromBlock?r.fromBlock:0)&&ot.warn("findFirstLog: expensive getLogs query fromBlock 0 toBlock ".concat(i)),e.prev=10,e.next=13,t.getLogs(Yn({},r,{fromBlock:a,toBlock:i}));case 13:return s=e.sent,e.abrupt("return",0===s.length?void 0:s[0]);case 17:return e.prev=17,e.t1=e.catch(10),o=Math.floor((i-a)/2+a),e.next=22,n.findFirstLog(t,Yn({},r,{fromBlock:a,toBlock:o}));case 22:if(void 0===(u=e.sent)){e.next=25;break}return e.abrupt("return",u);case 25:return e.abrupt("return",n.findFirstLog(t,Yn({},r,{fromBlock:o,toBlock:i})));case 26:case"end":return e.stop()}}),e,null,[[10,17]])})));return function(t,n){return e.apply(this,arguments)}}()}));function Xn(e){return void 0!==e.address&&!er(e)}function er(e){return tr(e)||nr(e)||rr(e)}function tr(e){var t=e;return void 0!==t.signature&&void 0===t.address}function nr(e){var t=e;return void 0!==t.r&&void 0!==t.s&&void 0!==t.v&&void 0!==t.t}function rr(e){var t=e;return void 0!==t.address&&void 0!==t.signature}!function(e){e[e.EOA=0]="EOA",e[e.Address=1]="Address",e[e.Full=2]="Full"}(zn||(zn={}));var ir=function(e){if("string"!==typeof e)return e;for(var t=e.replace("0x",""),n=De.O$.from("0x".concat(t.slice(0,4))).toNumber(),r=[],i=4;i<t.length;){var a=De.O$.from(t.slice(i,i+2)).toNumber();i+=2;var s=De.O$.from("0x".concat(t.slice(i,i+2))).toNumber();switch(i+=2,a){case zn.Address:var o=We.Kn(t.slice(i,i+40));i+=40,r.push({weight:s,address:o});break;case zn.EOA:var u=B.lE("0x".concat(t.slice(i,i+132)));i+=132;var c=B.N(u.slice(0,65)),l=c.r,f=c.s,h=c.v,d=De.O$.from(u[u.length-1]).toNumber();r.push({weight:s,signature:u,r:l,s:f,v:h,t:d});break;case zn.Full:var p=We.Kn(t.slice(i,i+40));i+=40;var v=De.O$.from("0x".concat(t.slice(i,i+4))).mul(2).toNumber();i+=4;var g=B.lE("0x".concat(t.slice(i,i+v)));i+=v,r.push({weight:s,address:p,signature:g});break;default:throw Error("Signature type not supported")}}return{threshold:n,signers:r}},ar=function(e){var t=B.lE(e.signature);return Yn({},e,B.N(t.slice(0,65)),{t:De.O$.from(t[t.length-1]).toNumber()})},sr=function(e,t){var n=nr(t)?t:ar(t);switch(n.t){case 1:return Ge.RJ(e,{r:n.r,s:n.s,v:n.v});case 2:var r=F.w(Be.P2(["string","bytes32"],["\x19Ethereum Signed Message:\n32",e]));return Ge.RJ(r,{r:n.r,s:n.s,v:n.v});default:throw new Error("Unknown signature")}},or=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.map((function(e){return"string"===typeof e?ir(e):e}));return r.reduce((function(e,t){return ur(e,t)}))},ur=function(e,t){return{threshold:e.threshold,signers:e.signers.map((function(e,n){return Xn(e)?t.signers[n]:e}))}},cr=function e(t){if("string"===typeof t)return e(ir(t));var n=t.signers.map((function(e){if(Xn(e))return Be.P2(["uint8","uint8","address"],[zn.Address,e.weight,e.address]);if(nr(e))return Be.P2(["uint8","uint8","bytes32","bytes32","uint8","uint8"],[zn.EOA,e.weight,e.r,e.s,e.v,e.t]);if(rr(e)){var t=B.lE(e.signature).length;return Be.P2(["uint8","uint8","address","uint16","bytes"],[zn.Full,e.weight,e.address,t,e.signature])}if(tr(e))return Be.P2(["uint8","uint8","bytes"],[zn.EOA,e.weight,e.signature]);throw Error("Unkwnown signature part type")}));return Be.P2(["uint16"].concat((0,M.Z)(Array(n.length).fill("bytes"))),[t.threshold].concat((0,M.Z)(n)))};function lr(e,t){if(Xn(e))return e.address;if(rr(e))return e.address;if(nr(e)||tr(e))return sr(t,e);throw Error("Unkwnown signature part type")}function fr(e,t,n){var r=e.signers.map((function(e){return lr(e,n)}));return{threshold:t.threshold,signers:t.signers.map((function(t){var n=r.indexOf(t.address);return-1!==n?Yn({},e.signers[n],{weight:t.weight}):{weight:t.weight,address:t.address}}))}}function hr(e,t){return dr.apply(this,arguments)}function dr(){return dr=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new An.MulticallProvider(t),e.next=3,Promise.all(n.signers.map(function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Yn,e.t1={},e.t2=t,e.t3=n,e.t4=q,e.next=7,r.getCode(t.address);case 7:return e.t5=e.sent,e.t6=e.t4.arrayify.call(e.t4,e.t5).length,e.t7=0===e.t6,e.t8={index:e.t3,isEOA:e.t7},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t8));case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 3:return i=e.sent,a=i.sort((function(e,t){return e.weight-t.weight})),s=0,a=a.map((function(e){return s>=n.threshold||e.isEOA?e:(s+=e.weight,Yn({},e,{willSign:!0}))})),s<n.threshold&&(a=a.map((function(e){return e.willSign||s>=n.threshold?e:(s+=e.weight,Yn({},e,{willSign:!0}))}))),o=B.lE("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a01b02"),u=a.sort((function(e,t){return e.index-t.index})),e.abrupt("return",{threshold:n.threshold,signers:u.map((function(e){return e.willSign?e.isEOA?{weight:e.weight,signature:o}:{weight:e.weight,address:e.address,signature:cr({threshold:1,signers:[{address:G.w5.createRandom().address,weight:1},{weight:1,signature:o}]})+B.Dv(3).substring(2)}:{address:e.address,weight:e.weight}}))});case 11:case"end":return e.stop()}}),e)}))),dr.apply(this,arguments)}function pr(){return pr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},pr.apply(this,arguments)}var vr,gr,wr,yr,mr,br="v1",kr="v0.4.0",xr="7cdd11a44d6d1c5371dca8be8a603b1c67d53e22";!function(e){e.UNKNOWN="UNKNOWN",e.ERC20="ERC20",e.ERC721="ERC721",e.ERC1155="ERC1155",e.SEQUENCE_WALLET="SEQUENCE_WALLET",e.ERC20_BRIDGE="ERC20_BRIDGE",e.ERC721_BRIDGE="ERC721_BRIDGE",e.ERC1155_BRIDGE="ERC1155_BRIDGE"}(vr||(vr={})),function(e){e.UNKNOWN="UNKNOWN",e.BLOCK_ADDED="BLOCK_ADDED",e.BLOCK_REMOVED="BLOCK_REMOVED"}(gr||(gr={})),function(e){e.UNKNOWN="UNKNOWN",e.TOKEN_TRANSFER="TOKEN_TRANSFER",e.SEQUENCE_TXN="SEQUENCE_TXN"}(wr||(wr={})),function(e){e.UNKNOWN="UNKNOWN",e.SEND="SEND",e.RECEIVE="RECEIVE"}(yr||(yr={})),function(e){e.DESC="DESC",e.ASC="ASC"}(mr||(mr={}));var Zr,Cr=function(){function e(t,n){var r=this;(0,m.Z)(this,e),this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Indexer/",this.ping=function(e){return r.fetch(r.url("Ping"),Er({},e)).then((function(e){return _r(e).then((function(e){return{status:e.status}}))}))},this.version=function(e){return r.fetch(r.url("Version"),Er({},e)).then((function(e){return _r(e).then((function(e){return{version:e.version}}))}))},this.runtimeStatus=function(e){return r.fetch(r.url("RuntimeStatus"),Er({},e)).then((function(e){return _r(e).then((function(e){return{status:e.status}}))}))},this.getChainID=function(e){return r.fetch(r.url("GetChainID"),Er({},e)).then((function(e){return _r(e).then((function(e){return{chainID:e.chainID}}))}))},this.getEtherBalance=function(e,t){return r.fetch(r.url("GetEtherBalance"),Er(e,t)).then((function(e){return _r(e).then((function(e){return{balance:e.balance}}))}))},this.getTokenBalances=function(e,t){return r.fetch(r.url("GetTokenBalances"),Er(e,t)).then((function(e){return _r(e).then((function(e){return{page:e.page,balances:e.balances}}))}))},this.getTokenSupplies=function(e,t){return r.fetch(r.url("GetTokenSupplies"),Er(e,t)).then((function(e){return _r(e).then((function(e){return{page:e.page,contractType:e.contractType,tokenIDs:e.tokenIDs}}))}))},this.getTokenSuppliesMap=function(e,t){return r.fetch(r.url("GetTokenSuppliesMap"),Er(e,t)).then((function(e){return _r(e).then((function(e){return{supplies:e.supplies}}))}))},this.getBalanceUpdates=function(e,t){return r.fetch(r.url("GetBalanceUpdates"),Er(e,t)).then((function(e){return _r(e).then((function(e){return{page:e.page,balances:e.balances}}))}))},this.getTransactionHistory=function(e,t){return r.fetch(r.url("GetTransactionHistory"),Er(e,t)).then((function(e){return _r(e).then((function(e){return{page:e.page,transactions:e.transactions}}))}))},this.syncBalance=function(e,t){return r.fetch(r.url("SyncBalance"),Er(e,t)).then((function(e){return _r(e).then((function(e){return{}}))}))},this.hostname=t,this.fetch=function(e,t){return n(e,t)}}return(0,b.Z)(e,[{key:"url",value:function(e){return this.hostname+this.path+e}}]),e}(),Er=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{method:"POST",headers:pr({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}},_r=function(e){return e.text().then((function(t){var n;try{n=JSON.parse(t)}catch(r){throw{code:"unknown",msg:"expecting JSON, got: ".concat(t),status:e.status}}if(!e.ok)throw n;return n}))};!function(e){e.MAINNET="https://mainnet-indexer.sequence.app",e.POLYGON="https://polygon-indexer.sequence.app",e.POLYGON_MUMBAI="https://mumbai-indexer.sequence.app",e.ARBITRUM="https://arbitrum-indexer.sequence.app",e.ARBITRUM_NOVA="https://arbitrum-nova-indexer.sequence.app",e.OPTIMISM="https://optimism-indexer.sequence.app",e.AVALANCHE="https://avalanche-indexer.sequence.app",e.GNOSIS="https://gnosis-indexer.sequence.app",e.BSC="https://bsc-indexer.sequence.app",e.BSC_TESTNET="https://bsc-testnet-indexer.sequence.app",e.GOERLI="https://goerli-indexer.sequence.app"}(Zr||(Zr={}));var Sr=function(e){(0,w.Z)(r,e);var t=(0,y.Z)(r);function r(e,i){var a;return(0,m.Z)(this,r),(a=t.call(this,e.endsWith("/")?e.slice(0,-1):e,n.g.fetch)).jwtAuth=i,a._fetch=function(e,t){var r={};return a.jwtAuth&&a.jwtAuth.length>0&&(r.Authorization="BEARER ".concat(a.jwtAuth)),t.headers=pr({},t.headers,r),n.g.fetch(e,t)},a.fetch=a._fetch,a}return(0,b.Z)(r)}(Cr);function Ir(){return Ir=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ir.apply(this,arguments)}var Tr,Or,Nr,Ar,Pr="v1",Rr="v0.4.0",Mr="bc959039469c0907365b18237ae62c00bdd626e5";!function(e){e.UNKNOWN="UNKNOWN",e.ERC20="ERC20",e.ERC721="ERC721",e.ERC1155="ERC1155"}(Tr||(Tr={})),function(e){e.INT="INT",e.STRING="STRING",e.ARRAY="ARRAY"}(Or||(Or={})),function(e){e.UNKNOWN="UNKNOWN",e.BUY="BUY",e.SELL="SELL"}(Nr||(Nr={})),function(e){e.DESC="DESC",e.ASC="ASC"}(Ar||(Ar={}));var Lr=function(){function e(t,n){var r=this;(0,m.Z)(this,e),this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Metadata/",this.ping=function(e){return r.fetch(r.url("Ping"),Ur({},e)).then((function(e){return Dr(e).then((function(e){return{status:e.status}}))}))},this.version=function(e){return r.fetch(r.url("Version"),Ur({},e)).then((function(e){return Dr(e).then((function(e){return{version:e.version}}))}))},this.runtimeStatus=function(e){return r.fetch(r.url("RuntimeStatus"),Ur({},e)).then((function(e){return Dr(e).then((function(e){return{status:e.status}}))}))},this.getTokenMetadata=function(e,t){return r.fetch(r.url("GetTokenMetadata"),Ur(e,t)).then((function(e){return Dr(e).then((function(e){return{tokenMetadata:e.tokenMetadata}}))}))},this.refreshTokenMetadata=function(e,t){return r.fetch(r.url("RefreshTokenMetadata"),Ur(e,t)).then((function(e){return Dr(e).then((function(e){return{status:e.status}}))}))},this.getTokenMetadataBatch=function(e,t){return r.fetch(r.url("GetTokenMetadataBatch"),Ur(e,t)).then((function(e){return Dr(e).then((function(e){return{contractTokenMetadata:e.contractTokenMetadata}}))}))},this.searchTokenMetadata=function(e,t){return r.fetch(r.url("SearchTokenMetadata"),Ur(e,t)).then((function(e){return Dr(e).then((function(e){return{page:e.page,tokenMetadata:e.tokenMetadata}}))}))},this.searchTokenIDs=function(e,t){return r.fetch(r.url("SearchTokenIDs"),Ur(e,t)).then((function(e){return Dr(e).then((function(e){return{page:e.page,tokenIds:e.tokenIds}}))}))},this.tokenCollectionFilters=function(e,t){return r.fetch(r.url("TokenCollectionFilters"),Ur(e,t)).then((function(e){return Dr(e).then((function(e){return{filters:e.filters}}))}))},this.getContractInfo=function(e,t){return r.fetch(r.url("GetContractInfo"),Ur(e,t)).then((function(e){return Dr(e).then((function(e){return{contractInfo:e.contractInfo}}))}))},this.getContractInfoBatch=function(e,t){return r.fetch(r.url("GetContractInfoBatch"),Ur(e,t)).then((function(e){return Dr(e).then((function(e){return{contractInfoMap:e.contractInfoMap}}))}))},this.searchContractInfo=function(e,t){return r.fetch(r.url("SearchContractInfo"),Ur(e,t)).then((function(e){return Dr(e).then((function(e){return{contractInfoList:e.contractInfoList}}))}))},this.searchContractInfoBatch=function(e,t){return r.fetch(r.url("SearchContractInfoBatch"),Ur(e,t)).then((function(e){return Dr(e).then((function(e){return{contractInfoByChain:e.contractInfoByChain}}))}))},this.getNiftyswapTokenQuantity=function(e,t){return r.fetch(r.url("GetNiftyswapTokenQuantity"),Ur(e,t)).then((function(e){return Dr(e).then((function(e){return{quantity:e.quantity}}))}))},this.getNiftyswapUnitPrices=function(e,t){return r.fetch(r.url("GetNiftyswapUnitPrices"),Ur(e,t)).then((function(e){return Dr(e).then((function(e){return{prices:e.prices}}))}))},this.hostname=t,this.fetch=function(e,t){return n(e,t)}}return(0,b.Z)(e,[{key:"url",value:function(e){return this.hostname+this.path+e}}]),e}(),Ur=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{method:"POST",headers:Ir({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}},Dr=function(e){return e.text().then((function(t){var n;try{n=JSON.parse(t)}catch(r){throw{code:"unknown",msg:"expecting JSON, got: ".concat(t),status:e.status}}if(!e.ok)throw n;return n}))},qr=function(e){(0,w.Z)(r,e);var t=(0,y.Z)(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://metadata.sequence.app";return(0,m.Z)(this,r),t.call(this,e.endsWith("/")?e.slice(0,-1):e,n.g.fetch)}return(0,b.Z)(r)}(Lr),Wr=n(11120),Br=n(31981),Fr=n(83070);function jr(){return jr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},jr.apply(this,arguments)}var Gr="tuple(\n  bool delegateCall,\n  bool revertOnError,\n  uint256 gasLimit,\n  address target,\n  uint256 value,\n  bytes data\n)[]";function Hr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=ii.apply(void 0,t);if(void 0===r)throw new Error("Encoding transactions without defined nonce");return Vr.apply(void 0,[r].concat(t))}function Vr(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Fe.$.encode(["uint256",Gr],[e,ai(n)])}function Kr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=ii.apply(void 0,t);if(void 0===r)throw new Error("Computing hash for transactions without defined nonce");return Jr.apply(void 0,[r].concat(t))}function Jr(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return F.w(Vr.apply(void 0,[e].concat(n)))}function $r(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return tt(e,t,Kr.apply(void 0,r)).replace(/^0x/,"")}function Yr(e,t){return zr.apply(this,arguments)}function zr(){return zr=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]&&u[2],i=u.length>3?u[3]:void 0,a=Qr(n),e.next=5,Promise.all(n.map((function(e){return e.nonce})));case 5:return s=e.sent.filter((function(e){return void 0!==e})).map((function(e){return De.O$.from(e)})),o=0!==s.length?s.reduce((function(e,t){return e.lt(t)?e:t})):void 0,e.abrupt("return",Promise.all(a.map((function(e){return Xr(t,e,r,i,o)}))));case 8:case"end":return e.stop()}}),e)}))),zr.apply(this,arguments)}function Qr(e){if(!Array.isArray(e)){if("auxiliary"in e){var t=e.auxiliary,n=jr({},e);return delete n.auxiliary,t?[n].concat((0,M.Z)(Qr(t))):[n]}return[e]}return e.flatMap(Qr)}function Xr(e,t){return ei.apply(this,arguments)}function ei(){return ei=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u,c,l=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>2&&void 0!==l[2]&&l[2],i=l.length>3?l[3]:void 0,a=l.length>4?l[4]:void 0,!ni(n)){e.next=5;break}return e.abrupt("return",n);case 5:if(s=void 0===n.gasLimit?n.gas:n.gasLimit,!n.to){e.next=41;break}if(e.t0=r,!s){e.next=14;break}return e.next=11,s;case 11:e.t1=e.sent,e.next=15;break;case 14:e.t1=i;case 15:return e.t2=e.t1,e.next=18,n.to;case 18:if(e.t3=e.sent,!n.value){e.next=25;break}return e.next=22,n.value;case 22:e.t4=e.sent,e.next=26;break;case 25:e.t4=0;case 26:return e.t5=e.t4,e.next=29,n.data;case 29:if(e.t6=e.sent,!a){e.next=34;break}e.t7=a,e.next=37;break;case 34:return e.next=36,n.nonce;case 36:e.t7=e.sent;case 37:return e.t8=e.t7,e.abrupt("return",{delegateCall:!1,revertOnError:e.t0,gasLimit:e.t2,to:e.t3,value:e.t5,data:e.t6,nonce:e.t8});case 41:if(o=new Tt.vU(g.mainModule.abi),u=o.encodeFunctionData(o.getFunction("createContract"),[n.data]),c="string"===typeof t?t:t.getAddress(),e.t9=r,!s){e.next=51;break}return e.next=48,s;case 48:e.t10=e.sent,e.next=52;break;case 51:e.t10=i;case 52:return e.t11=e.t10,e.next=55,c;case 55:if(e.t12=e.sent,!n.value){e.next=62;break}return e.next=59,n.value;case 59:e.t13=e.sent,e.next=63;break;case 62:e.t13=0;case 63:if(e.t14=e.t13,e.t15=u,!a){e.next=69;break}e.t16=a,e.next=72;break;case 69:return e.next=71,n.nonce;case 71:e.t16=e.sent;case 72:return e.t17=e.t16,e.abrupt("return",{delegateCall:!1,revertOnError:e.t9,gasLimit:e.t11,to:e.t12,value:e.t14,data:e.t15,nonce:e.t17});case 74:case"end":return e.stop()}}),e)}))),ei.apply(this,arguments)}function ti(e){return e.send||e.sendAsync}function ni(e){return void 0!==e.delegateCall||void 0!==e.revertOnError}function ri(e){return void 0!==e.find((function(e){return ni(e)}))}function ii(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.find((function(e){return void 0!==e.nonce}));if(r){var i=De.O$.from(r.nonce);if(t.find((function(e){return void 0!==e.nonce&&!De.O$.from(e.nonce).eq(i)})))throw new Error("Mixed nonces on Sequence transactions");return r?r.nonce:void 0}}function ai(e){return e.map((function(e){var t;return{delegateCall:!0===e.delegateCall,revertOnError:!0===e.revertOnError,gasLimit:void 0!==e.gasLimit?e.gasLimit:qe._Y,target:null!=(t=e.to)?t:Fr.d,value:void 0!==e.value?e.value:qe._Y,data:void 0!==e.data?e.data:[]}}))}function si(e,t){return e.map((function(e){return jr({},e,{nonce:t})}))}function oi(e,t,n){var r=new Tt.vU(g.sequenceUtils.abi);if(!e||!e.sequenceUtils)throw new Error("Undefined sequenceUtils");return[{delegateCall:!1,revertOnError:!0,gasLimit:0,to:e.sequenceUtils,value:0,data:r.encodeFunctionData(r.getFunction("requireNonExpired"),[n])}].concat((0,M.Z)(t))}function ui(e,t,n){var r=new Tt.vU(g.sequenceUtils.abi);if(!e||!e.sequenceUtils)throw new Error("Undefined sequenceUtils");return[{delegateCall:!1,revertOnError:!0,gasLimit:0,to:e.sequenceUtils,value:0,data:r.encodeFunctionData(r.getFunction("requireMinNonce"),[n.address,n.space?ci(n.space,n.nonce):n.nonce])}].concat((0,M.Z)(t))}function ci(e,t){var n=De.O$.from(e),r=De.O$.from(t),i=qe.Py.pow(De.O$.from(96));if(!r.div(i).eq(qe._Y))throw new Error("Space already encoded");return r.add(n.mul(i))}function li(e){var t=De.O$.from(e),n=qe.Py.pow(De.O$.from(96));return[t.div(n),t.mod(n)]}function fi(e){return void 0!==e&&void 0!==e.chainId&&void 0!==e.config&&void 0!==e.context&&void 0!==e.signature&&void 0!==e.transactions&&Array.isArray(e.transactions)&&e.transactions.reduce((function(e,t){return e&&ni(t)}),!0)}function hi(e,t,n){return di.apply(this,arguments)}function di(){return(di=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){var i,a;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],!Array.isArray(r)){e.next=11;break}if(!ri(r)){e.next=6;break}i=Qr(r),e.next=9;break;case 6:return e.next=8,Yr(n,r);case 8:i=e.sent;case 9:e.next=18;break;case 11:if(!ni(r)){e.next=15;break}i=Qr([r]),e.next=18;break;case 15:return e.next=17,Yr(n,[r]);case 17:i=e.sent;case 18:return r.expiration&&(i=oi(t,i,r.expiration)),r.afterNonce&&(a=r.afterNonce,i=ui(t,i,a.address?{address:a.address,nonce:a.nonce,space:a.space}:{address:n,nonce:a})),e.abrupt("return",i);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pi(){return pi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},pi.apply(this,arguments)}function vi(e){return void 0!==e.bundleCreation&&"boolean"===typeof e.bundleCreation||void 0!==e.creationGasLimit&&_t(e.creationGasLimit)||void 0!==e.provider&&(Wr.zt.isProvider(e.provider)||"string"===typeof e.provider)}var gi={bundleCreation:!0,creationGasLimit:qe.Py.pow(17)},wi=function(){function e(t){(0,m.Z)(this,e),this.provider=void 0,this.bundleCreation=void 0,this.creationGasLimit=void 0;var n=pi({},gi,t);this.bundleCreation=n.bundleCreation,this.provider=n.provider,this.creationGasLimit=De.O$.from(n.creationGasLimit)}return(0,b.Z)(e,[{key:"isWalletDeployed",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.provider){e.next=2;break}throw new Error("Bundled creation provider not found");case 2:return e.next=4,this.provider.getCode(t);case 4:return e.t0=e.sent,e.abrupt("return","0x"!==e.t0);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"prepareWalletDeploy",value:function(e,t){var n=new Tt.vU(g.factory.abi);return{to:t.factory,data:n.encodeFunctionData(n.getFunction("deploy"),[t.mainModule,jn(e)])}}},{key:"prependWalletDeploy",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a,s,o,u,c;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.config,r=t.context,i=t.transactions,a=t.nonce,s=t.signature,o=Fn(n,r),u=new Tt.vU(g.mainModule.abi),c=(0,U.Z)((0,L.Z)().mark((function e(){var t;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s;case 2:if("string"!==typeof(t=e.sent)){e.next=5;break}return e.abrupt("return",t);case 5:return e.abrupt("return",cr(t));case 6:case"end":return e.stop()}}),e)})))(),e.t0=this.bundleCreation,!e.t0){e.next=9;break}return e.next=8,this.isWalletDeployed(o);case 8:e.t0=!e.sent;case 9:if(!e.t0){e.next=31;break}return e.t1=r.guestModule,e.t2=pi({},this.prepareWalletDeploy(n,r),{delegateCall:!1,revertOnError:!1,gasLimit:this.creationGasLimit,value:qe._Y}),e.t3=qe._Y,e.t4=o,e.t5=qe._Y,e.t6=u,e.t7=u.getFunction("execute"),e.t8=ai(i),e.t9=a,e.next=21,c;case 21:return e.t10=e.sent,e.t11=[e.t8,e.t9,e.t10],e.t12=e.t6.encodeFunctionData.call(e.t6,e.t7,e.t11),e.t13={delegateCall:!1,revertOnError:!0,gasLimit:e.t3,to:e.t4,value:e.t5,data:e.t12},e.t14=[e.t2,e.t13],e.t15=qe._Y,e.t16={transactions:e.t14,nonce:e.t15,signature:"0x"},e.abrupt("return",{to:e.t1,execute:e.t16});case 31:return e.t17=o,e.t18=i,e.t19=De.O$.from(a),e.next=36,c;case 36:return e.t20=e.sent,e.t21={transactions:e.t18,nonce:e.t19,signature:e.t20},e.abrupt("return",{to:e.t17,execute:e.t21});case 39:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"prepareTransactions",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){var i,a,s,o,u,c,l,f,h=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=h.length,a=new Array(i>3?i-3:0),s=3;s<i;s++)a[s-3]=h[s];if(o=ii.apply(void 0,a)){e.next=4;break}throw new Error("Unable to prepare transactions without a defined nonce");case 4:return e.next=6,this.prependWalletDeploy({config:t,context:n,transactions:a,nonce:o,signature:r});case 6:return u=e.sent,c=u.to,l=u.execute,f=new Tt.vU(g.mainModule.abi),e.abrupt("return",{to:c,data:f.encodeFunctionData(f.getFunction("execute"),[ai(l.transactions),l.nonce,l.signature])});case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}(),yi=De.O$.from(8e5),mi={waitPollRate:1e3,deltaBlocksLog:12,fromBlockLog:-1024};function bi(e){return void 0!==e.provider&&Wr.zt.isProvider(e.provider)}var ki=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;(0,m.Z)(this,n),(r=t.call(this,e)).provider=void 0,r.waitPollRate=void 0,r.deltaBlocksLog=void 0,r.fromBlockLog=void 0;var i=pi({},mi,e);return r.provider=i.provider,r.waitPollRate=i.waitPollRate,r.deltaBlocksLog=i.deltaBlocksLog,r.fromBlockLog=i.fromBlockLog,r}return(0,b.Z)(n,[{key:"simulate",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a,s=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=this,r=s.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=s[a];return e.next=4,Promise.all(i.map(function(){var e=(0,U.Z)((0,L.Z)().mark((function e(r){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.gasLimit||De.O$.from(r.gasLimit||0).eq(qe._Y)){e.next=2;break}return e.abrupt("return",r.gasLimit);case 2:if(!r.delegateCall){e.next=4;break}return e.abrupt("return",yi);case 4:if(e.t0=r.to===t,!e.t0){e.next=9;break}return e.next=8,n.isWalletDeployed(t);case 8:e.t0=!e.sent;case 9:if(!e.t0){e.next=11;break}return e.abrupt("return",yi);case 11:if(n.provider){e.next=13;break}throw new Error("signer.provider is not set, but is required");case 13:return e.abrupt("return",n.provider.estimateGas({from:t,to:r.to,data:r.data,value:r.value}));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return e.abrupt("return",e.sent.map((function(e){return{executed:!0,succeeded:!0,gasUsed:De.O$.from(e).toNumber(),gasLimit:De.O$.from(e).toNumber()}})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNonce",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i){var a,s,o;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.provider){e.next=2;break}throw new Error("provider is not set");case 2:return a=Fn(t,n),e.next=5,this.provider.getCode(a);case 5:if(e.t0=e.sent,"0x"!==e.t0){e.next=8;break}return e.abrupt("return",0);case 8:return void 0===r&&(r=0),s=new W.CH(a,g.mainModule.abi,this.provider),e.next=12,s.readNonce(r,{blockTag:i});case 12:return o=e.sent,e.abrupt("return",ci(r,o));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"wait",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u,c=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>2&&void 0!==c[2]?c[2]:this.waitPollRate,i=c.length>3&&void 0!==c[3]?c[3]:5,a=this,"string"!==typeof t&&(ot.info.apply(ot,["computing id",t.config,t.context,t.chainId].concat((0,M.Z)(t.transactions))),t=$r.apply(void 0,[Fn(t.config,t.context),t.chainId].concat((0,M.Z)(t.transactions)))),s=!1,o=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var a;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0;case 1:if(s){e.next=22;break}return e.prev=2,e.next=5,t();case 5:return e.abrupt("return",e.sent);case 8:if(e.prev=8,e.t0=e.catch(2),a++,!(void 0!==i&&a>=i)){e.next=16;break}throw ot.error("giving up after ".concat(a," failed attempts").concat(n?": ".concat(n):""),e.t0),e.t0;case 16:ot.warn("attempt #".concat(a," failed").concat(n?": ".concat(n):""),e.t0);case 17:if(!(r>0)){e.next=20;break}return e.next=20,new Promise((function(e){return setTimeout(e,r)}));case 20:e.next=1;break;case 22:throw new Error("timed out after ".concat(a," failed attempts").concat(n?": ".concat(n):""));case 23:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,n){return e.apply(this,arguments)}}(),u=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){var n,i,u,c,l;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=a.fromBlockLog)<0)){e.next=6;break}return e.next=4,o((function(){return a.provider.getBlockNumber()}),"unable to get latest block number");case 4:i=e.sent,n=i+n;case 6:if("string"===typeof t){e.next=8;break}throw new Error("impossible");case 8:u=t.replace("0x",""),c=(0,L.Z)().mark((function e(){var t,i,c,l;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o((function(){return a.provider.getBlockNumber()}),"unable to get latest block number");case 2:return t=e.sent,e.next=5,o((function(){return a.provider.getLogs({fromBlock:Math.max(0,n-a.deltaBlocksLog),toBlock:t,topics:["0x1f180c27086c7a39ea2a7b25239d1ab92348f07ca7bb59d1438fcf527568f881"]})}),"unable to get NonceChange logs for blocks ".concat(Math.max(0,n-a.deltaBlocksLog)," to ").concat(t));case 5:return i=e.sent,n=t,e.next=9,Promise.all(i.map((function(e){return o((function(){return a.provider.getTransactionReceipt(e.transactionHash)}),"unable to get receipt for transaction ".concat(e.transactionHash))})));case 9:if(c=e.sent,!(l=c.find((function(e){return e.logs.find((function(e){return 0===e.topics.length&&e.data.replace("0x","")===u||1===e.topics.length&&"0x3dbd1590ea96dd3253a91f24e64e3a502e1225d602a5731357bc12643070ccd7"===e.topics[0]&&e.data.length>=64&&e.data.replace("0x","").startsWith(u)}))})))){e.next=19;break}return e.t0=pi,e.t1={receipt:l},e.next=16,o((function(){return a.provider.getTransaction(l.transactionHash)}),"unable to get transaction ".concat(l.transactionHash));case 16:return e.t2=e.sent,e.t3=(0,e.t0)(e.t1,e.t2),e.abrupt("return",{v:e.t3});case 19:if(s){e.next=22;break}return e.next=22,new Promise((function(e){return setTimeout(e,r)}));case 22:case"end":return e.stop()}}),e)}));case 10:if(s){e.next=17;break}return e.delegateYield(c(),"t0",12);case 12:if("object"!==typeof(l=e.t0)){e.next=15;break}return e.abrupt("return",l.v);case 15:e.next=10;break;case 17:throw new Error("Timeout waiting for transaction receipt ".concat(t));case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),void 0===n){e.next=11;break}return e.abrupt("return",Promise.race([u(),new Promise((function(e,r){return setTimeout((function(){s=!0,r("Timeout waiting for transaction receipt ".concat(t))}),n)}))]));case 11:return e.abrupt("return",u());case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(wi);function xi(e){return void 0!==e.signer&&Ue.E.isSigner(e.signer)}var Zi,Ci,Ei,_i,Si=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;if((0,m.Z)(this,n),(r=t.call(this,Ue.E.isSigner(e)?{provider:e.provider}:pi({},e,{provider:e.signer.provider}))).signer=void 0,r.txnOptions=void 0,r.signer=Ue.E.isSigner(e)?e:e.signer,!r.signer.provider)throw new Error("Signer must have a provider");return r}return(0,b.Z)(n,[{key:"deployWallet",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.prepareWalletDeploy(t,n),e.abrupt("return",this.signer.sendTransaction(pi({},r,{gasLimit:qe.Py.pow(17)})));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getFeeOptions",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{options:[]});case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"gasRefundOptions",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=u.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=u[a];return e.next=3,this.getFeeOptions.apply(this,[t,n].concat(i));case 3:return s=e.sent,o=s.options,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setTransactionOptions",value:function(e){this.txnOptions=e}},{key:"relay",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u,c,l,f=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(f.length>2&&void 0!==f[2])||f[2],void 0!==n&&ot.warn("LocalRelayer doesn't accept fee quotes"),t.context.guestModule&&42===t.context.guestModule.length){e.next=4;break}throw new Error("LocalRelayer requires the context.guestModule address");case 4:return e.next=6,this.prependWalletDeploy(t);case 6:if(i=e.sent,a=i.to,s=i.execute,o=new Tt.vU(g.mainModule.abi),u=o.encodeFunctionData(o.getFunction("execute"),[ai(s.transactions),s.nonce,s.signature]),c=this.signer.sendTransaction(pi({to:a,data:u},this.txnOptions)),!r){e.next=22;break}return e.next=15,c;case 15:return l=e.sent,e.next=18,l.wait();case 18:return l.receipt=e.sent,e.abrupt("return",l);case 22:return e.abrupt("return",c);case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(ki);!function(e){e.UNKNOWN="UNKNOWN",e.DROPPED="DROPPED",e.QUEUED="QUEUED",e.SENT="SENT",e.SUCCEEDED="SUCCEEDED",e.PARTIALLY_FAILED="PARTIALLY_FAILED",e.FAILED="FAILED"}(Zi||(Zi={})),function(e){e.SEND="SEND",e.RECEIVE="RECEIVE",e.BRIDGE_DEPOSIT="BRIDGE_DEPOSIT",e.BRIDGE_WITHDRAW="BRIDGE_WITHDRAW",e.BURN="BURN",e.UNKNOWN="UNKNOWN"}(Ci||(Ci={})),function(e){e.UNKNOWN="UNKNOWN",e.ERC20_TOKEN="ERC20_TOKEN",e.ERC1155_TOKEN="ERC1155_TOKEN"}(Ei||(Ei={})),function(e){e.DESC="DESC",e.ASC="ASC"}(_i||(_i={}));var Ii=function(){function e(t,n){var r=this;(0,m.Z)(this,e),this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Relayer/",this.ping=function(e){return r.fetch(r.url("Ping"),Ti({},e)).then((function(e){return Oi(e).then((function(e){return{status:e.status}}))}))},this.version=function(e){return r.fetch(r.url("Version"),Ti({},e)).then((function(e){return Oi(e).then((function(e){return{version:e.version}}))}))},this.runtimeStatus=function(e){return r.fetch(r.url("RuntimeStatus"),Ti({},e)).then((function(e){return Oi(e).then((function(e){return{status:e.status}}))}))},this.getSequenceContext=function(e){return r.fetch(r.url("GetSequenceContext"),Ti({},e)).then((function(e){return Oi(e).then((function(e){return{data:e.data}}))}))},this.getChainID=function(e){return r.fetch(r.url("GetChainID"),Ti({},e)).then((function(e){return Oi(e).then((function(e){return{chainID:e.chainID}}))}))},this.sendMetaTxn=function(e,t){return r.fetch(r.url("SendMetaTxn"),Ti(e,t)).then((function(e){return Oi(e).then((function(e){return{status:e.status,txnHash:e.txnHash}}))}))},this.getMetaTxnNonce=function(e,t){return r.fetch(r.url("GetMetaTxnNonce"),Ti(e,t)).then((function(e){return Oi(e).then((function(e){return{nonce:e.nonce}}))}))},this.getMetaTxnReceipt=function(e,t){return r.fetch(r.url("GetMetaTxnReceipt"),Ti(e,t)).then((function(e){return Oi(e).then((function(e){return{receipt:e.receipt}}))}))},this.simulate=function(e,t){return r.fetch(r.url("Simulate"),Ti(e,t)).then((function(e){return Oi(e).then((function(e){return{results:e.results}}))}))},this.updateMetaTxnGasLimits=function(e,t){return r.fetch(r.url("UpdateMetaTxnGasLimits"),Ti(e,t)).then((function(e){return Oi(e).then((function(e){return{payload:e.payload}}))}))},this.feeTokens=function(e){return r.fetch(r.url("FeeTokens"),Ti({},e)).then((function(e){return Oi(e).then((function(e){return{isFeeRequired:e.isFeeRequired,tokens:e.tokens}}))}))},this.feeOptions=function(e,t){return r.fetch(r.url("FeeOptions"),Ti(e,t)).then((function(e){return Oi(e).then((function(e){return{options:e.options,quote:e.quote}}))}))},this.getMetaTxnNetworkFeeOptions=function(e,t){return r.fetch(r.url("GetMetaTxnNetworkFeeOptions"),Ti(e,t)).then((function(e){return Oi(e).then((function(e){return{options:e.options}}))}))},this.sentTransactions=function(e,t){return r.fetch(r.url("SentTransactions"),Ti(e,t)).then((function(e){return Oi(e).then((function(e){return{page:e.page,transactions:e.transactions}}))}))},this.pendingTransactions=function(e,t){return r.fetch(r.url("PendingTransactions"),Ti(e,t)).then((function(e){return Oi(e).then((function(e){return{page:e.page,transactions:e.transactions}}))}))},this.listGasSponsors=function(e,t){return r.fetch(r.url("ListGasSponsors"),Ti(e,t)).then((function(e){return Oi(e).then((function(e){return{page:e.page,gasSponsors:e.gasSponsors}}))}))},this.addGasSponsor=function(e,t){return r.fetch(r.url("AddGasSponsor"),Ti(e,t)).then((function(e){return Oi(e).then((function(e){return{status:e.status,gasSponsor:e.gasSponsor}}))}))},this.updateGasSponsor=function(e,t){return r.fetch(r.url("UpdateGasSponsor"),Ti(e,t)).then((function(e){return Oi(e).then((function(e){return{status:e.status,gasSponsor:e.gasSponsor}}))}))},this.reportGasSponsorUsage=function(e,t){return r.fetch(r.url("ReportGasSponsorUsage"),Ti(e,t)).then((function(e){return Oi(e).then((function(e){return{gasSponsorUsage:e.gasSponsorUsage}}))}))},this.hostname=t,this.fetch=function(e,t){return n(e,t)}}return(0,b.Z)(e,[{key:"url",value:function(e){return this.hostname+this.path+e}}]),e}(),Ti=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{method:"POST",headers:pi({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}},Oi=function(e){return e.text().then((function(t){var n;try{n=JSON.parse(t)}catch(r){throw{code:"unknown",msg:"expecting JSON, got: ".concat(t),status:e.status}}if(!e.ok)throw n;return n}))},Ni=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"dd44f90f38fc726a1f1430cfece544c3316f6b4f",get ETHTxnStatus(){return Zi},get TransferType(){return Ci},get FeeTokenType(){return Ei},get SortOrder(){return _i},Relayer:Ii}),Ai=[Zi.DROPPED,Zi.SUCCEEDED,Zi.PARTIALLY_FAILED,Zi.FAILED],Pi=[Zi.DROPPED,Zi.PARTIALLY_FAILED,Zi.FAILED];function Ri(e){return void 0!==e.url&&"string"===typeof e.url}var Mi=function(e){(0,w.Z)(r,e);var t=(0,y.Z)(r);function r(e){var i;return(0,m.Z)(this,r),(i=t.call(this,e)).service=void 0,i.service=new Ii(e.url,n.g.fetch),i}return(0,b.Z)(r,[{key:"waitReceipt",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a,s,o,u=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=u.length>1&&void 0!==u[1]?u[1]:1e3,r=u.length>2&&void 0!==u[2]?u[2]:5,i=u.length>3?u[3]:void 0,"string"!==typeof t&&(ot.info.apply(ot,["computing id",t.config,t.context,t.chainId].concat((0,M.Z)(t.transactions))),t=$r.apply(void 0,[Fn(t.config,t.context),t.chainId].concat((0,M.Z)(t.transactions)))),ot.info("[rpc-relayer/waitReceipt] waiting for ".concat(t)),a=0;case 6:if(void 0!==i&&i()){e.next=26;break}return e.prev=7,e.next=10,this.service.getMetaTxnReceipt({metaTxID:t});case 10:if(s=e.sent,!((o=s.receipt)&&o.txnReceipt&&"null"!==o.txnReceipt&&Ai.includes(o.status))){e.next=14;break}return e.abrupt("return",{receipt:o});case 14:e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(7),++a!==r){e.next=21;break}throw e.t0;case 21:if(void 0!==i&&i()){e.next=24;break}return e.next=24,new Promise((function(e){return setTimeout(e,n)}));case 24:e.next=6;break;case 26:throw new Error("Cancelled waiting for transaction receipt ".concat(t));case 27:case"end":return e.stop()}}),e,this,[[7,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"simulate",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a,s,o=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=Fe.$,r=o.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=o[a];return s=n.encode([Gr],[ai(i)]),e.next=5,this.service.simulate({wallet:t,transactions:s});case 5:return e.abrupt("return",e.sent.results);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeeOptions",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u,c,l,f,h,d,p,v,w,y,m=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.service.feeTokens();case 2:if(!(r=e.sent).isFeeRequired){e.next=32;break}for(i=r.tokens.map((function(e){return e.symbol})).join(", "),ot.info("[rpc-relayer/getFeeOptions] relayer fees are required, accepted tokens are ".concat(i)),a=Fn(t,n),s=m.length,o=new Array(s>2?s-2:0),u=2;u<s;u++)o[u-2]=m[u];if(void 0!==(c=ii.apply(void 0,o))){e.next=13;break}return e.next=12,this.getNonce(t,n);case 12:c=e.sent;case 13:if(this.provider){e.next=16;break}throw ot.warn("[rpc-relayer/getFeeOptions] provider not set, needed for stub signature"),new Error("provider is not set");case 16:return e.next=18,this.prependWalletDeploy({config:t,context:n,transactions:o,nonce:c,signature:hr(this.provider,t)});case 18:return l=e.sent,f=l.to,h=l.execute,d=new Tt.vU(g.mainModule.abi),p=d.encodeFunctionData(d.getFunction("execute"),[ai(h.transactions),h.nonce,h.signature]),e.next=25,this.service.feeOptions({wallet:a,to:f,data:p});case 25:return v=e.sent,w=v.options,y=v.quote,ot.info("[rpc-relayer/getFeeOptions] got refund options ".concat(JSON.stringify(w))),e.abrupt("return",{options:w,quote:{_tag:"FeeQuote",_quote:y}});case 32:return ot.info("[rpc-relayer/getFeeOptions] relayer fees are not required"),e.abrupt("return",{options:[]});case 34:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"gasRefundOptions",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=u.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=u[a];return e.next=3,this.getFeeOptions.apply(this,[t,n].concat(i));case 3:return s=e.sent,o=s.options,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNonce",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){var i,a,s,o,u,c,l,f;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Fn(t,n),ot.info("[rpc-relayer/getNonce] get nonce for wallet ".concat(i," space: ").concat(r)),a=void 0!==r?De.O$.from(r).toHexString():void 0,e.next=5,this.service.getMetaTxnNonce({walletContractAddress:i,space:a});case 5:return s=e.sent,o=De.O$.from(s.nonce),u=li(o),c=(0,P.Z)(u,2),l=c[0],f=c[1],ot.info("[rpc-relayer/getNonce] got next nonce for wallet ".concat(i," ").concat(f," space: ").concat(l)),e.abrupt("return",o);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"relay",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u,c,l,f,h,d,p,v=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(v.length>2&&void 0!==v[2])||v[2],i=this,ot.info("[rpc-relayer/relay] relaying signed meta-transactions ".concat(JSON.stringify(t)," with quote ").concat(JSON.stringify(n))),void 0!==n&&("string"===typeof n._quote?a=n._quote:ot.warn("[rpc-relayer/relay] ignoring invalid fee quote")),this.provider){e.next=7;break}throw ot.warn("[rpc-relayer/relay] provider not set, failed relay"),new Error("provider is not set");case 7:return e.next=9,this.prependWalletDeploy(t);case 9:return s=e.sent,o=s.to,u=s.execute,c=Fn(t.config,t.context),l=new Tt.vU(g.mainModule.abi),f=l.encodeFunctionData(l.getFunction("execute"),[ai(u.transactions),u.nonce,u.signature]),e.next=17,this.service.sendMetaTxn({call:{walletAddress:c,contract:o,input:f},quote:a});case 17:if(h=e.sent,ot.info("[rpc-relayer/relay] got relay result ".concat(JSON.stringify(h))),!r){e.next=23;break}return e.abrupt("return",this.wait(h.txnHash));case 23:return d={hash:h.txnHash,confirmations:0,from:c,wait:function(e){return Promise.reject(new Error("impossible"))}},p=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,a;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.provider){e.next=2;break}throw new Error("cannot wait for receipt, relayer has no provider set");case 2:return e.next=4,i.wait(h.txnHash);case 4:if(r=e.sent,a=null==(n=r.receipt)?void 0:n.transactionHash){e.next=8;break}throw new Error("cannot wait for receipt, unknown native transaction hash");case 8:return Object.assign(d,r),e.abrupt("return",i.provider.waitForTransaction(a,t));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d.wait=p,e.abrupt("return",d);case 27:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"wait",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u,c,l=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>2&&void 0!==l[2]?l[2]:1e3,i=l.length>3&&void 0!==l[3]?l[3]:5,a=this,s=!1,e.next=6,void 0!==n?Promise.race([this.waitReceipt(t,r,i,(function(){return s})),new Promise((function(e,r){return setTimeout((function(){s=!0,r("Timeout waiting for transaction receipt ".concat(t))}),n)}))]):this.waitReceipt(t,r,i);case 6:if(o=e.sent,(u=o.receipt).txnReceipt&&!Pi.includes(u.status)){e.next=10;break}throw new Li(u);case 10:return c=JSON.parse(u.txnReceipt),e.abrupt("return",{blockHash:c.blockHash,blockNumber:De.O$.from(c.blockNumber).toNumber(),confirmations:1,from:"string"===typeof t?void 0:Fn(t.config,t.context),hash:c.transactionHash,raw:u.txnReceipt,receipt:c,wait:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.provider.waitForTransaction(c.transactionHash,t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),r}(wi),Li=(0,b.Z)((function e(t){(0,m.Z)(this,e),this.receipt=t}));function Ui(e){return"object"===typeof e&&"function"===typeof e.simulate&&"function"===typeof e.getFeeOptions&&"function"===typeof e.gasRefundOptions&&"function"===typeof e.getNonce&&"function"===typeof e.relay&&"function"===typeof e.wait}function Di(){return Di=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Di.apply(this,arguments)}var qi=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,null,[{key:"isSequenceSigner",value:function(e){return Wi(e)}}]),n}(Ue.E);function Wi(e){var t=e;return t&&void 0!==t.updateConfig&&void 0!==t.publishConfig&&void 0!==t.getWalletContext&&void 0!==t.getWalletConfig}Error;var Bi=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n)}((0,A.Z)(Error)),Fi=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"signMessage",value:function(e,t){return this.signMessageWithData(e)}},{key:"sendTransaction",value:function(e){throw new Error("sendTransaction method is not supported in RemoteSigner")}},{key:"signTransaction",value:function(e){throw new Error("signTransaction method is not supported in RemoteSigner")}},{key:"connect",value:function(e){throw new Error("connect method is not supported in RemoteSigner")}}],[{key:"signMessageWithData",value:function(e,t,n,r){return this.isRemoteSigner(e)?e.signMessageWithData(t,n,r):e.signMessage(t)}},{key:"isRemoteSigner",value:function(e){return void 0!==e.signMessageWithData}}]),n}(Ue.E);function ji(e){return Gi.apply(this,arguments)}function Gi(){return(Gi=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t)){e.next=2;break}return e.abrupt("return",Promise.all(t.map((function(e){return Ke.mE(e)}))));case 2:return e.abrupt("return",Ke.mE(t));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Hi=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;(0,m.Z)(this,n),(r=t.call(this)).context=void 0,r.config=void 0,r._signers=void 0,r.provider=void 0,r.sender=void 0,r.relayer=void 0,r.chainId=void 0;var i=e.config,a=e.context,s=e.strict;if(r.context=Di({},a||en),!0===s?r.context.nonStrict=void 0:!1===s&&(r.context.nonStrict=!0),!r.context.nonStrict&&!Wn(i))throw new Error("wallet config is not usable (strict mode)");r.config=Gn(i);for(var o=arguments.length,u=new Array(o>1?o-1:0),c=1;c<o;c++)u[c-1]=arguments[c];return r._signers=u.map((function(e){return Ue.E.isSigner(e)?e:new G.w5(e)})),r.imageHash,r}return(0,b.Z)(n,[{key:"useConfig",value:function(e,t){return(0,R.Z)(n,[{config:e,context:this.context,strict:t}].concat((0,M.Z)(this._signers))).setProvider(this.provider).setRelayer(this.relayer)}},{key:"useSigners",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,R.Z)(n,[{config:this.config,context:this.context}].concat(t)).setProvider(this.provider).setRelayer(this.relayer)}},{key:"connect",value:function(e,t){if(an(e))return(0,R.Z)(n,[{config:this.config,context:this.context}].concat((0,M.Z)(this._signers))).setProvider(e).setRelayer(t);throw new Error("Wallet provider argument is expected to be a JsonRpcProvider")}},{key:"setProvider",value:function(e){if(void 0===e)return this;if(Wr.zt.isProvider(e))this.provider=e,this.sender=new cn(e);else{var t=new D.r(e);this.provider=t,this.sender=new cn(t)}return this.chainId=void 0,this}},{key:"setRelayer",value:function(e){return void 0===e||(this.relayer=e),this}},{key:"getProvider",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,this.getChainIdNumber(t);case 3:return e.abrupt("return",this.provider);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRelayer",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,this.getChainIdNumber(t);case 3:return e.abrupt("return",this.relayer);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getWalletContext",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.context);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWalletConfig",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChainIdNumber(t);case 2:return t=e.sent,n=Di({},this.config,{chainId:t}),e.abrupt("return",[n]);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getWalletState",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a,s,o;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.getAddress(),this.getChainId(),this.isDeployed()]);case 2:if(n=e.sent,r=(0,P.Z)(n,3),i=r[0],a=r[1],s=r[2],e.t0=this.context,e.t1=this.config,e.t2=i,e.t3=a,e.t4=s,e.t5=this.imageHash,!s){e.next=19;break}return e.next=16,ta(this);case 16:e.t6=e.sent,e.next=20;break;case 19:e.t6=void 0;case 20:return e.t7=e.t6,o={context:e.t0,config:e.t1,address:e.t2,chainId:e.t3,deployed:e.t4,imageHash:e.t5,lastImageHash:e.t7},e.abrupt("return",[o]);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"connected",get:function(){return void 0!==this.sender}},{key:"address",get:function(){return Fn(this.config,this.context)}},{key:"imageHash",get:function(){return jn(this.config)}},{key:"getAddress",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.address);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSigners",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._signers&&0!==this._signers.length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.abrupt("return",Promise.all(this._signers.map((function(e){return e.getAddress().then((function(e){return We.Kn(e)}))}))));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChainId",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.chainId){e.next=2;break}return e.abrupt("return",this.chainId);case 2:if(this.provider){e.next=4;break}throw new Error("provider is not set, first connect a provider");case 4:return e.next=6,this.provider.getNetwork();case 6:return this.chainId=e.sent.chainId,e.abrupt("return",this.chainId);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getNetworks",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){var t;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChainId();case 2:return t=e.sent,e.abrupt("return",[{chainId:t,name:"",rpcUrl:""}]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getNonce",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.relayer.getNonce(this.config,this.context,n,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTransactionCount",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getNonce(t,0);case 2:return n=e.sent,r=li(n),i=(0,P.Z)(r,2),i[0],a=i[1],e.abrupt("return",De.O$.from(a).toNumber());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendTransaction",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i,a,s){var o,u,c;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signTransactions(t,n,r);case 2:return o=e.sent,a&&(u=Fn(o.config,o.context),c=$r.apply(void 0,[u,o.chainId].concat((0,M.Z)(o.transactions))),a(o,c)),e.abrupt("return",this.relayer.relay(o,i,s));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a,s){return e.apply(this,arguments)}}()},{key:"sendTransactionBatch",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(o.length>2&&void 0!==o[2])||o[2],i=o.length>3?o[3]:void 0,a=o.length>4?o[4]:void 0,s=o.length>5?o[5]:void 0,e.abrupt("return",this.sendTransaction(t,n,r,i,a,s));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"signTransactions",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){var i,a,s,o,u,c,l,f,h;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChainIdNumber(n);case 2:return i=e.sent,e.next=5,ji(t);case 5:if(a=e.sent,this.provider){e.next=8;break}throw new Error("missing provider");case 8:if(this.relayer){e.next=10;break}throw new Error("missing relayer");case 10:return e.next=12,hi(this.context,this.address,a);case 12:if(!(s=e.sent).some((function(e){return void 0===e.gasLimit}))){e.next=18;break}return e.next=16,(o=this.relayer).simulate.apply(o,[this.address].concat((0,M.Z)(s)));case 16:for(c in u=e.sent,s)void 0===s[c].gasLimit&&(s[c].gasLimit=u[c].gasLimit);case 18:if(!(l=ii.apply(void 0,(0,M.Z)(s)))){e.next=23;break}e.t0=l,e.next=26;break;case 23:return e.next=25,this.getNonce();case 25:e.t0=e.sent;case 26:return f=e.t0,s=si(s,f),h=Jr.apply(void 0,[f].concat((0,M.Z)(s))),e.t1=h,e.t2=i,e.t3=this.context,e.t4=this.config,e.t5=s,e.t6=f,e.next=37,this.sign(h,!0,n,r);case 37:return e.t7=e.sent,e.abrupt("return",{digest:e.t1,chainId:e.t2,context:e.t3,config:e.t4,transactions:e.t5,nonce:e.t6,signature:e.t7});case 39:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendSignedTransactions",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.relayer){e.next=2;break}throw new Error("relayer is not set, first connect a relayer");case 2:return e.next=4,this.getChainIdNumber(n);case 4:return e.abrupt("return",this.relayer.relay(t,r));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"signMessage",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){var i,a,s=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=s.length>3&&void 0!==s[3]&&s[3],a="string"!==typeof t||t.startsWith("0x")?t:Ve.Y0(t),e.abrupt("return",this.sign(a,i,n,r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"signTypedData",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i,a){var s,o,u;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChainIdNumber(i);case 2:if(s=e.sent,!(o=t.chainId?De.O$.from(t.chainId).toNumber():void 0)||o===s){e.next=6;break}throw new Error("signTypedData: domain.chainId (".concat(t.chainId,") is expected to be ").concat(s));case 6:return u=yt({domain:t,types:n,message:r}),e.abrupt("return",this.sign(u,!0,s,a));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"_signTypedData",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i,a){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.signTypedData(t,n,r,i,a));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"subDigest",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChainIdNumber(n);case 2:return r=e.sent,e.abrupt("return",B.lE(tt(this.address,r,t)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sign",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a,s,o,u,c,l,f,h,d,p=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(p.length>1&&void 0!==p[1])||p[1],r=p.length>2?p[2]:void 0,i=p.length>3?p[3]:void 0,a=this,e.next=6,this.getChainIdNumber(r);case 6:return s=e.sent,o=n?t:F.w(t),e.next=10,this.subDigest(o,r);case 10:return u=e.sent,c=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,o;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return e.getAddress()})));case 2:return r=e.sent,e.next=5,Promise.all(a.config.signers.map(function(){var e=(0,U.Z)((0,L.Z)().mark((function e(o){var c,l,f;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,c=t[r.indexOf(o.address)]){e.next=4;break}return e.abrupt("return",o);case 4:if(!Wi(c)){e.next=12;break}if(c!==a){e.next=7;break}throw Error("Can't sign transactions for self");case 7:return e.next=9,c.signMessage(u,s,i,!0);case 9:return e.t0=e.sent,l=e.t0+"03",e.abrupt("return",Di({},o,{signature:l}));case 12:if(!Fi.isRemoteSigner(c)){e.next=25;break}return e.next=15,c.signMessageWithData(u,n,s);case 15:if(f=e.sent,e.prev=16,!(sr(u,{weight:o.weight,signature:f})===o.address)){e.next=20;break}return e.abrupt("return",{weight:o.weight,signature:f});case 20:e.next=24;break;case 22:e.prev=22,e.t1=e.catch(16);case 24:return e.abrupt("return",Di({},o,{signature:f}));case 25:return e.t2=o.weight,e.next=28,c.signMessage(u);case 28:return e.t3=e.sent,e.t4=e.t3+"02",e.abrupt("return",{weight:e.t2,signature:e.t4});case 33:if(e.prev=33,e.t5=e.catch(0),!i){e.next=39;break}throw e.t5;case 39:return console.warn("Skipped signer ".concat(o.address)),e.abrupt("return",o);case 41:case"end":return e.stop()}}),e,null,[[0,33],[16,22]])})));return function(t){return e.apply(this,arguments)}}()));case 5:return o=e.sent,e.abrupt("return",{threshold:a.config.threshold,signers:o});case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),l=this._signers.filter((function(e){return!Fi.isRemoteSigner(e)})),e.next=15,c(l,this.packMsgAndSig(o,[],s));case 15:if(f=e.sent,!(f.signers.filter(er).reduce((function(e,t){return e+t.weight}),0)>=this.config.threshold)){e.next=19;break}return e.abrupt("return",cr(f));case 19:return h=this._signers.filter((function(e){return Fi.isRemoteSigner(e)})),e.next=22,c(h,this.packMsgAndSig(o,cr(f),s));case 22:return d=e.sent,e.abrupt("return",cr(or(f,d)));case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signWeight",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){var t,n=this;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSigners();case 2:return t=e.sent,e.abrupt("return",t.reduce((function(e,t){var r=n.config.signers.find((function(e){return e.address===t}));return r?e.add(r.weight):e}),qe._Y));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isDeployed",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChainIdNumber(t);case 2:return e.next=4,this.provider.getCode(this.address);case 4:return n=e.sent,e.abrupt("return",!!n&&"0x"!==n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateConfig",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u,c,l,f,h=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=h.length>2&&void 0!==h[2]&&h[2],i=h.length>3?h[3]:void 0,a=h.length>4?h[4]:void 0,s=h.length>5?h[5]:void 0,o=h.length>6?h[6]:void 0,t||(t=this.config),e.next=8,Promise.all([this.buildUpdateConfigTransaction(t,r,i),null!=n?n:this.getNonce()]);case 8:return u=e.sent,c=(0,P.Z)(u,2),l=c[0],f=c[1],e.t0=Di({address:this.address},t),e.next=15,this.sendTransaction(si(l,f),void 0,void 0,a,s,o);case 15:return e.t1=e.sent,e.abrupt("return",[e.t0,e.t1]);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"publishConfig",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>2&&void 0!==o[2]?o[2]:[],i=o.length>3?o[3]:void 0,a=o.length>4?o[4]:void 0,s=o.length>5?o[5]:void 0,e.t0=this,!this.config.address){e.next=9;break}e.t1=this.buildPublishConfigTransaction(this.config,t,n),e.next=12;break;case 9:return e.next=11,this.buildPublishSignersTransaction(t,n,r);case 11:e.t1=e.sent;case 12:return e.t2=e.t1,e.t3=void 0,e.t4=void 0,e.t5=i,e.t6=a,e.t7=s,e.abrupt("return",e.t0.sendTransaction.call(e.t0,e.t2,e.t3,e.t4,e.t5,e.t6,e.t7));case 19:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"buildUpdateConfigTransaction",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a,s,o,u,c,l,f,h,d=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d.length>1&&void 0!==d[1]&&d[1],r=d.length>2?d[2]:void 0,i=this,this.context.nonStrict||Wn(t)){e.next=5;break}throw new Error("wallet config is not usable (strict mode)");case 5:return e.next=7,(0,U.Z)((0,L.Z)().mark((function e(){var t;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.provider.getStorageAt(i.address,Fe.$.encode(["address"],[i.address]));case 3:return t=e.sent,e.abrupt("return",0===Vn(t,i.context.mainModuleUpgradable));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))();case 7:if(a=e.sent,s=new Tt.vU(g.mainModule.abi),o=2*(1e5+1800*t.signers.length),u=a?[]:[{delegateCall:!1,revertOnError:!0,gasLimit:qe._Y,to:this.address,value:qe._Y,data:s.encodeFunctionData(s.getFunction("updateImplementation"),[this.context.mainModuleUpgradable])}],c=new Tt.vU(g.mainModuleUpgradable.abi),l={delegateCall:!1,revertOnError:!0,gasLimit:qe._Y,to:this.address,value:qe._Y,data:c.encodeFunctionData(c.getFunction("updateImageHash"),[jn(t)])},!n){e.next=19;break}return e.next=16,this.buildPublishConfigTransaction(t,r);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:if(f=e.t0,1!==(h=[].concat(u,[l],(0,M.Z)(f))).length){e.next=24;break}return e.abrupt("return",h);case 24:return e.abrupt("return",[{delegateCall:!1,revertOnError:!1,gasLimit:o,to:this.address,value:qe._Y,data:s.encodeFunctionData(s.getFunction("selfExecute"),[ai(h)])}]);case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"buildPublishConfigTransaction",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=new Tt.vU(g.sequenceUtils.abi);return[{delegateCall:!1,revertOnError:!0,gasLimit:qe._Y,to:this.context.sequenceUtils,value:qe._Y,nonce:n,data:r.encodeFunctionData(r.getFunction("publishConfig"),[this.address,e.threshold,Gn(e).signers.map((function(e){return{weight:e.weight,signer:e.address}})),t])}]}},{key:"buildPublishSignersTransaction",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){var t,n,r,i,a,s,o,u,c,l,f,h=this,d=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(d.length>0&&void 0!==d[0])||d[0],n=d.length>1?d[1]:void 0,r=d.length>2&&void 0!==d[2]?d[2]:[],a=new Tt.vU(g.sequenceUtils.abi),s=new Tt.vU(g.requireFreshSigner.abi),o=Br.O(32),e.next=8,this.signMessage(o,this.chainId,!1);case 8:if(u=e.sent,c=ir(u),l=cr({threshold:c.threshold,signers:c.signers.map((function(e,t){if(rr(e)){var n=h.config.signers[t];return{weight:n.weight,address:n.address}}return e}))}),f=null==(i=this.context.libs)?void 0:i.requireFreshSigner,!(r.length>0&&void 0===f)){e.next=14;break}throw Error("requireFreshSigners missing library");case 14:return e.abrupt("return",[].concat((0,M.Z)(r.map((function(e){return{delegateCall:!1,revertOnError:!0,gasLimit:qe._Y,to:f,value:qe._Y,nonce:n,data:s.encodeFunctionData(s.getFunction("requireFreshSigner"),[e])}}))),[{delegateCall:!1,revertOnError:!0,gasLimit:qe._Y,to:this.context.sequenceUtils,value:qe._Y,nonce:n,data:a.encodeFunctionData(a.getFunction("publishInitialSigners"),[this.address,F.w(o),this.config.signers.length,l,t])}]));case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChainIdNumber",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return e.next=3,this.getChainId();case 3:return e.abrupt("return",e.sent);case 4:if(n=Mt(t),!this.context.nonStrict){e.next=7;break}return e.abrupt("return",n);case 7:return e.next=9,this.getChainId();case 9:if((r=e.sent)===n){e.next=12;break}throw new Error("the specified chainId ".concat(n," does not match the wallet's connected chainId ").concat(r));case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"packMsgAndSig",value:function(e,t,n){return Fe.$.encode(["address","uint256","bytes","bytes"],[this.address,n,e,t])}},{key:"signTransaction",value:function(e){throw new Error("signTransaction method is not supported in Wallet, please use signTransactions(...)")}},{key:"hasEnoughSigners",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,this.getChainIdNumber(t);case 3:return e.next=5,this.signWeight();case 5:return e.abrupt("return",e.sent.gte(this.config.threshold));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"singleOwner",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,r){var i,a;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Ue.E.isSigner(t)?t:new G.w5(t),e.t0=q,e.next=4,i.getAddress();case 4:return e.t1=e.sent,e.t2=e.t0.getAddress.call(e.t0,e.t1),e.t3={weight:1,address:e.t2},e.t4=[e.t3],a={threshold:1,signers:e.t4},e.abrupt("return",new n({config:a,context:r},i));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(qi),Vi=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;(0,m.Z)(this,n),(r=t.call(this)).options=void 0,r._wallets=void 0,r._signers=void 0,r.provider=void 0,r._chainId=void 0,r.options=e;for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];return r._signers=a,e.context||(r.options.context=Di({},en)),r.options.networks?r.setNetworks(r.options.networks):r.setNetworks((0,M.Z)(Qt)),r}return(0,b.Z)(n,[{key:"useSigners",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this._signers=t,this._wallets.forEach((function(e){var n;e.wallet=(n=e.wallet).useSigners.apply(n,t)})),this}},{key:"getWalletContext",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.options.context);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getConfigFinder",value:function(){return this.options.configFinder?this.options.configFinder:new Qn(this.authWallet().wallet.provider)}},{key:"getWalletConfig",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],t?(r=this.getWalletByNetwork(t))&&n.push(r):n=this._wallets,e.next=4,Promise.all(n.map((function(e){return e.wallet.getWalletConfig()})));case 4:return e.abrupt("return",e.sent.flat());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getWalletState",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a,s,o,u=this;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],t?(r=this.getWalletByNetwork(t))&&n.push(r):n=this._wallets,i=Promise.all(n.map((function(e){return u.getConfigFinder().findCurrentConfig({address:e.wallet.address,provider:e.wallet.provider,context:e.wallet.context,knownConfigs:[e.wallet.config]})}))),e.next=5,Promise.all(n.map((function(e){return e.wallet.getWalletState()})));case 5:if(a=e.sent.flat(),!((s=a.findIndex((function(e){return e.chainId===u.getAuthChainId()})))>=0)){e.next=11;break}return e.next=10,this.currentConfig(n[s].wallet);case 10:a[s].config=e.sent;case 11:return e.next=13,i;case 13:return o=e.sent,e.abrupt("return",a.map((function(e,t){var n;return Di({},e,{config:null==(n=o[t])?void 0:n.config})})));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"address",get:function(){return this._wallets[0].wallet.address}},{key:"getAddress",value:function(){return this._wallets[0].wallet.getAddress()}},{key:"getSigners",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._wallets[0].wallet.getSigners());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getProvider",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null==(n=this.mainWallet())?void 0:n.wallet.getProvider());case 2:return e.abrupt("return",null==(r=this._wallets.find((function(e){return e.network.chainId===t})))?void 0:r.wallet.getProvider());case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRelayer",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null==(n=this.mainWallet())?void 0:n.wallet.getRelayer());case 2:return e.abrupt("return",null==(r=this._wallets.find((function(e){return e.network.chainId===t})))?void 0:r.wallet.getRelayer());case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNetworks",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.options.networks);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChainId",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){var t;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._chainId){e.next=2;break}return e.abrupt("return",this._chainId);case 2:return e.next=4,this.provider.getNetwork();case 4:return t=e.sent,this._chainId=t.chainId,e.abrupt("return",this._chainId);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAuthChainId",value:function(){try{return this.options.networks.find((function(e){return e.isAuthChain})).chainId}catch(Vs){throw new Error("no auth network")}}},{key:"signMessage",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u,c,l=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(l.length>2&&void 0!==l[2])||l[2],i=l.length>3&&void 0!==l[3]&&l[3],a=this,e.next=5,(0,U.Z)((0,L.Z)().mark((function e(){var t;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",a.mainWallet());case 2:if(!n.address){e.next=7;break}return e.next=5,n.getChainId();case 5:return t=e.sent,e.abrupt("return",a.getWalletByNetwork(t));case 7:return e.abrupt("return",a.getWalletByNetwork(n));case 8:case"end":return e.stop()}}),e)})))();case 5:return s=e.sent,o=s.wallet,e.next=9,this.currentConfig(o);case 9:return u=(u=e.sent)||this._wallets[0].wallet.config,o=o.useConfig(u),e.next=14,o.signWeight();case 14:if(!(c=e.sent).lt(o.config.threshold)||!1===r){e.next=17;break}throw new Bi("Sign message - wallet combined weight ".concat(c.toString()," below required ").concat(o.config.threshold.toString()));case 17:return e.abrupt("return",o.signMessage(t,void 0,r,i));case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"signAuthMessage",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(a.length>1&&void 0!==a[1])||a[1],r=a.length>2&&void 0!==a[2]&&a[2],e.abrupt("return",this.signMessage(t,null==(i=this.authWallet())?void 0:i.wallet,n,r));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signTypedData",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i){var a,s,o,u=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(u.length>4&&void 0!==u[4])||u[4],s=i?this.getWalletByNetwork(i).wallet:this.mainWallet().wallet,o=yt({domain:t,types:n,message:r}),e.abrupt("return",this.signMessage(o,s,a,!0));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_signTypedData",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i){var a,s=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=!(s.length>4&&void 0!==s[4])||s[4],e.abrupt("return",this.signTypedData(t,n,r,i,a));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"hasEnoughSigners",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?this.getWalletByNetwork(t).wallet:this.mainWallet().wallet,e.next=3,this.currentConfig(n);case 3:return r=e.sent,e.abrupt("return",n.useConfig(r).hasEnoughSigners());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeeOptions",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u,c,l,f,h=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(h.length>2&&void 0!==h[2])||h[2],a=n?this.getWalletByNetwork(n).wallet:this.mainWallet().wallet,s=this.options.context){e.next=5;break}throw new Error("missing wallet context");case 5:return e.next=7,Promise.all([this.currentConfig(a),this.prependConfigUpdate(t,n,i,!0)]);case 7:if(o=e.sent,u=(0,P.Z)(o,2),c=u[0],l=u[1],c){e.next=13;break}throw new Error("missing current config for chain ".concat(n));case 13:return e.next=15,hi(s,this.address,l);case 15:return f=e.sent,e.abrupt("return",(r=a.relayer).getFeeOptions.apply(r,[c,s].concat((0,M.Z)(f))));case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendTransaction",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u,c,l=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(l.length>2&&void 0!==l[2])||l[2],i=l.length>3?l[3]:void 0,a=l.length>4?l[4]:void 0,e.next=5,this.signTransactions(t,n,r);case 5:return s=e.sent,a&&(o=Fn(s.config,s.context),u=$r.apply(void 0,[o,s.chainId].concat((0,M.Z)(s.transactions))),a(s,u)),c=n?this.getWalletByNetwork(n).wallet:this.mainWallet().wallet,e.abrupt("return",c.sendSignedTransactions(s,n,i));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendTransactionBatch",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(s.length>2&&void 0!==s[2])||s[2],i=s.length>3?s[3]:void 0,a=s.length>4?s[4]:void 0,e.abrupt("return",this.sendTransaction(t,n,r,i,a));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"signTransactions",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){var i,a,s;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n?this.getWalletByNetwork(n).wallet:this.mainWallet().wallet,e.next=3,this.currentConfig(i);case 3:if(a=e.sent){e.next=10;break}return e.next=7,this.currentConfig();case 7:if(a=e.sent){e.next=10;break}throw new Error("missing auth chain config");case 10:return e.next=12,this.prependConfigUpdate(t,n,r);case 12:return s=e.sent,e.abrupt("return",i.useConfig(a).signTransactions(s));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"prependConfigUpdate",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i){var a,s,o,u,c,l,f,h;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ji(t);case 2:return a=e.sent,s=n?this.getWalletByNetwork(n).wallet:this.mainWallet().wallet,e.next=6,Promise.all([this.currentConfig(s),this.currentConfig()]);case 6:if(o=e.sent,u=(0,P.Z)(o,2),c=u[0],l=u[1],i){e.next=16;break}return e.next=13,s.useConfig(c).signWeight();case 13:if(!(f=e.sent).lt(c.threshold)||!r){e.next=16;break}throw new Bi("wallet combined weight ".concat(f.toString()," below required threshold ").concat(c.threshold.toString()));case 16:return e.next=18,s.isDeployed();case 18:if(e.t0=e.sent,!e.t0){e.next=21;break}e.t0=Hn(l,c);case 21:if(!e.t0){e.next=23;break}return e.abrupt("return",a);case 23:return h=Array.isArray(a)?a:[a],e.t1=[],e.t2=M.Z,e.next=28,s.buildUpdateConfigTransaction(l,!1);case 28:return e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t5=(0,M.Z)(h),e.abrupt("return",e.t1.concat.call(e.t1,e.t4,e.t5));case 32:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"sendSignedTransactions",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){var i;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n?this.getWalletByNetwork(n).wallet:this.mainWallet().wallet,e.abrupt("return",i.sendSignedTransactions(t,void 0,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"updateConfig",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i){var a,s,o,u,c;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.authWallet().wallet,t=t?Gn(t):a.config,!Hn(a.config,t)){e.next=9;break}return e.next=5,this.isDeployed();case 5:if(e.sent){e.next=9;break}return e.next=8,a.updateConfig(t,void 0,!0,n,r,i);case 8:return e.abrupt("return",e.sent);case 9:return e.next=11,this.currentConfig();case 11:if(s=e.sent,!Hn(s,t)){e.next=14;break}return e.abrupt("return",[Di({},s,{address:this.address}),void 0]);case 14:return e.next=16,a.useConfig(s).updateConfig(t,void 0,!0,n,r,i);case 16:return o=e.sent,u=(0,P.Z)(o,2),u[0],c=u[1],e.abrupt("return",[Di({},t,{address:this.address}),c]);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"publishConfig",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return this.authWallet().wallet.publishConfig(e,void 0,t,n,r)}},{key:"isDeployed",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r=this;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?t.address?t:r.getWalletByNetwork(t).wallet:r.authWallet().wallet,e.abrupt("return",n.isDeployed());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"currentConfig",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r=this;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?t.address?t:r.getWalletByNetwork(t).wallet:r.authWallet().wallet,e.next=3,this.getConfigFinder().findCurrentConfig({address:this.address,provider:n.provider,context:n.context,knownConfigs:[n.config]});case 3:return e.abrupt("return",e.sent.config);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getWallets",value:function(){return this._wallets}},{key:"getWalletByNetwork",value:function(e){var t=Mt(e),n=this._wallets.find((function(e){return e.network.chainId===t}));if(!n)throw new Error("network ".concat(e," not found in wallets list"));return n}},{key:"mainWallet",value:function(){var e=this._wallets.find((function(e){return e.network.isDefaultChain}));if(!e)throw new Error("mainWallet not found");return e}},{key:"authWallet",value:function(){var e=this._wallets.find((function(e){return e.network.isAuthChain}));if(!e)throw new Error("authChain wallet not found");return e}},{key:"setNetworks",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,i=[];if(this._chainId=void 0,r){var a=parseInt(r),s=e.find((function(e){return e.name===r||e.chainId===a})),o=n.find((function(e){return e.name===r||e.chainId===a}));if(!s&&!o)throw new Error("unable to set default network as chain '".concat(r,"' does not exist"));s?(e.forEach((function(e){return e.isDefaultChain=!1})),s.isDefaultChain=!0,i=e):o&&(n.forEach((function(e){return e.isDefaultChain=!1})),o.isDefaultChain=!0,i=n)}else i=e;return this.options.networks=qt(Vt(i)),this._wallets=this.options.networks.map((function(e){var n=(0,R.Z)(Hi,[{config:t.options.initialConfig,context:t.options.context}].concat((0,M.Z)(t._signers)));if(e.provider)n.setProvider(e.provider);else{if(!e.rpcUrl||""===e.rpcUrl)throw new Error("network config is missing provider settings for chainId ".concat(e.chainId));n.setProvider(e.rpcUrl)}if(Ui(e.relayer))n.setRelayer(e.relayer);else{if(!Ri(e.relayer))throw new Error("network config is missing relayer settings for chainId ".concat(e.chainId));n.setRelayer(new Mi(Di({provider:n.provider},e.relayer)))}return e.isDefaultChain&&(t._chainId=e.chainId,t.provider=n.provider),{network:e,wallet:n}})),this.options.networks.find((function(e){return e.isDefaultChain})).chainId}},{key:"connect",value:function(e){throw new Error("connect method is not supported in MultiWallet")}},{key:"signTransaction",value:function(e){throw new Error("signTransaction method is not supported in MultiWallet, please use signTransactions(...)")}}]),n}(qi);function Ki(e,t,n,r,i,a){return Ji.apply(this,arguments)}function Ji(){return Ji=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i,a,s){var o;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!$i(t,n,r)&&!Yi(t,n,r)){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,zi(t,n,r,i);case 4:if(void 0!==(o=e.sent)){e.next=7;break}return e.abrupt("return",Xi(t,n,r,a,i,s));case 7:return e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)}))),Ji.apply(this,arguments)}function $i(e,t,n){try{return 0===Vn(Ge.RJ(t,B.N(n)),e)}catch(Vs){return!1}}function Yi(e,t,n){try{var r=F.w(Be.P2(["string","bytes32"],["\x19Ethereum Signed Message:\n32",t]));return 0===Vn(Ge.RJ(r,B.N(n)),e)}catch(i){return!1}}function zi(e,t,n,r){return Qi.apply(this,arguments)}function Qi(){return Qi=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i){var a,s;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.prev=2,e.next=5,i.getCode(t);case 5:if(e.t0=e.sent,"0x"!==e.t0){e.next=8;break}return e.abrupt("return",void 0);case 8:return a=new W.CH(t,g.erc1271.abi,i),e.next=11,a.isValidSignature(n,r);case 11:return s=e.sent,e.abrupt("return",g.erc1271.returns.isValidSignatureBytes32===s);case 15:return e.prev=15,e.t1=e.catch(2),e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e,null,[[2,15]])}))),Qi.apply(this,arguments)}function Xi(e,t,n,r,i,a){return ea.apply(this,arguments)}function ea(){return ea=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i,a,s){var o,u,c,l,f;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a||s){e.next=2;break}return e.abrupt("return",void 0);case 2:if(i){e.next=4;break}return e.abrupt("return",void 0);case 4:if(e.prev=4,!s){e.next=9;break}e.t0=s,e.next=12;break;case 9:return e.next=11,a.getNetwork();case 11:e.t0=e.sent.chainId;case 12:return o=e.t0,u=ir(r),c=B.lE(F.w(et(t,o,n))),e.next=17,ra(c,u,a,i,s,!0);case 17:return l=e.sent,f=u.signers.reduce((function(e,t){return tr(t)||rr(t)?e+t.weight:e}),0),e.abrupt("return",0===Vn(Fn(l,i),t)&&f>=u.threshold);case 22:return e.prev=22,e.t1=e.catch(4),e.abrupt("return",!1);case 25:case"end":return e.stop()}}),e,null,[[4,22]])}))),ea.apply(this,arguments)}var ta=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getAddress();case 2:return n=e.sent,e.t0=W.CH,e.t1=n,e.t2=g.mainModuleUpgradable.abi,e.next=8,t.getProvider();case 8:return e.t3=e.sent,r=new e.t0(e.t1,e.t2,e.t3),e.next=12,r.functions.imageHash.call([]).catch((function(){return[]}));case 12:return i=e.sent,e.abrupt("return",i&&i.length>0?i[0]:"");case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),na=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i,a,s){var o;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=B.lE(F.w(t)),e.abrupt("return",ra(o,n,r,i,a,s));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a,s){return e.apply(this,arguments)}}(),ra=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i,a,s){var o,u;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=void 0!==n.threshold?n:ir(n),e.next=3,Promise.all(o.signers.map(function(){var e=(0,U.Z)((0,L.Z)().mark((function e(n){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!tr(n)){e.next=4;break}return e.abrupt("return",{weight:n.weight,address:sr(t,n)});case 4:if(!Xn(n)){e.next=8;break}return e.abrupt("return",{weight:n.weight,address:We.Kn(n.address)});case 8:if(!rr(n)){e.next=17;break}if(!s){e.next=14;break}return e.next=12,Ki(n.address,B.lE(t),B.Dv(n.signature),r,i,a);case 12:if(e.sent){e.next=14;break}throw Error("Invalid signature");case 14:return e.abrupt("return",{weight:n.weight,address:n.address});case 17:throw Error("Uknown signature type");case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return u=e.sent,e.abrupt("return",{threshold:o.threshold,signers:u});case 5:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a,s){return e.apply(this,arguments)}}();function ia(){return ia=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ia.apply(this,arguments)}var aa=604800,sa=3e7,oa=function(){function e(t,n,r,i,a,s,o,u,c){var l;((0,m.Z)(this,e),this.sequenceApiUrl=t,this.sequenceMetadataUrl=n,this.networks=r,this.config=i,this.context=a,this.account=s,this.metadata=o,this.authProvider=u,this._initialAuthRequest=void 0,this._jwt=void 0,this.proofStrings=new Map,this.onAuthCallbacks=[],this.apiClient=void 0,this.metadataClient=void 0,this.indexerClients=new Map,c)&&(this._jwt={token:Promise.resolve(c.token),expiration:null!=(l=c.expiration)?l:ca(c.token)})}return(0,b.Z)(e,[{key:"name",get:function(){return this.metadata.name}},{key:"expiration",get:function(){return this.metadata.expiration?Math.max(this.metadata.expiration,120):aa}},{key:"onAuth",value:function(e){this.onAuthCallbacks.push(e)}},{key:"setAccount",value:function(e){this.account=e}},{key:"setConfig",value:function(e){this.config=e}},{key:"auth",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){var t,n,r,i,a=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:5,n=this.sequenceApiUrl){e.next=4;break}throw Error("No sequence api url");case 4:i=0;case 5:return e.prev=5,e.next=8,this.getJWT(!0);case 8:return r=e.sent.token,e.abrupt("break",20);case 12:if(e.prev=12,e.t0=e.catch(5),i!==t-1){e.next=17;break}throw console.error("couldn't authenticate after ".concat(t," attempts"),e.t0),e.t0;case 17:i++,e.next=5;break;case 20:return e.abrupt("return",new N(n,r));case 21:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"isTestnetMode",get:function(){if(this.networks&&0!==this.networks.length)return!!this.networks[0].testnet}},{key:"getAPIClient",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){var t,n,r,i=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(i.length>0&&void 0!==i[0])||i[0],this.apiClient){e.next=9;break}if(n=this.sequenceApiUrl){e.next=5;break}throw Error("No chaind url");case 5:return e.next=7,this.getJWT(t);case 7:r=e.sent.token,this.apiClient=new N(n,r);case 9:return e.abrupt("return",this.apiClient);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMetadataClient",value:function(){return this.metadataClient||(this.metadataClient=new qr(this.sequenceMetadataUrl)),this.metadataClient}},{key:"getIndexerClient",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=jt(this.networks,t)){e.next=3;break}throw Error("No network for chain ".concat(t));case 3:return e.next=5,this.getJWT(!0);case 5:if(r=e.sent.token,this.indexerClients.has(n.chainId)){e.next=16;break}if(!n.indexer){e.next=11;break}this.indexerClients.set(n.chainId,n.indexer),e.next=16;break;case 11:if(!n.indexerUrl){e.next=15;break}this.indexerClients.set(n.chainId,new Sr(n.indexerUrl,r)),e.next=16;break;case 15:throw Error("No indexer url for chain ".concat(t));case 16:return e.abrupt("return",this.indexerClients.get(n.chainId));case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getJWT",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a,s,o,u,c,l,f,h=this;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this,r=this.sequenceApiUrl){e.next=4;break}throw Error("No chaind url");case 4:if(!this._jwt){e.next=12;break}return i=this._jwt,e.next=8,i.token;case 8:if(a=e.sent,!(this.now()<i.expiration)){e.next=11;break}return e.abrupt("return",{token:a,expiration:i.expiration});case 11:this._jwt=void 0;case 12:if(t){e.next=14;break}throw new Error("no auth token in memory");case 14:return s=this.getProofStringKey(),o=this.getProofString(s),u=o.proofString,c=o.expiration,l={token:u.then(function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var i,a;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new N(r),e.next=3,i.getAuthToken({ewtString:t,testnetMode:n.isTestnetMode});case 3:if(!0!==(null==(a=e.sent)?void 0:a.status)||0===a.jwtToken.length){e.next=8;break}return e.abrupt("return",a.jwtToken);case 8:return e.next=10,n.isProofStringValid(t);case 10:if(e.sent){e.next=12;break}n.proofStrings.delete(s);case 12:throw new Error("no auth token from server");case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){throw h._jwt=void 0,e})),expiration:c},this._jwt=l,l.token.then((function(){h.onAuthCallbacks.forEach((function(e){try{e({status:"fulfilled",value:void 0})}catch(Vs){}}))})).catch((function(e){h.onAuthCallbacks.forEach((function(t){try{t({status:"rejected",reason:e})}catch(n){}}))})),e.next=21,l.token;case 21:return f=e.sent,e.abrupt("return",{token:f,expiration:c});case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getProofString",value:function(e){var t=this;if(this.proofStrings.has(e)){var n=this.proofStrings.get(e);if(this.now()<n.expiration)return n;this.proofStrings.delete(e)}var r=new Ie({address:this.account.address});r.claims.app=this.name,r.setExpiryIn(this.expiration);var i=new Le,a=new Qn(this.authProvider),s=this.account.authWallet(),o=this.now()+this.expiration-60,u={proofString:a.findCurrentConfig({address:s.wallet.address,provider:this.authProvider,context:s.wallet.context,knownConfigs:[s.wallet.config]}).then((function(e){if(!e.config)throw Error("Can't find latest config");return s.wallet.useConfig(e.config).sign(r.messageDigest()).then((function(e){var t=ir(e),n=t.signers.filter(er).reduce((function(e,t){return e+t.weight}),0);if(n<t.threshold)throw Error("insufficient signing power, need ".concat(t.threshold,", have ").concat(n));return r.signature=e,i.encodeProof(r,!0)}))})).catch((function(n){throw t.proofStrings.delete(e),n})),expiration:o};return this.proofStrings.set(e,u),u}},{key:"getProofStringKey",value:function(){return"".concat(this.account.address," - ").concat(this.name)}},{key:"isProofStringValid",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(n=new Le).provider=this.authProvider,e.next=5,n.decodeProof(t);case 5:return e.abrupt("return",!0);case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"dump",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){var t,n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._jwt){e.next=12;break}return e.prev=1,n=this._jwt.expiration,e.next=5,this._jwt.token;case 5:e.t0=e.sent,e.t1=n,t={token:e.t0,expiration:e.t1},e.next=12;break;case 10:e.prev=10,e.t2=e.catch(1);case 12:return e.abrupt("return",{config:this.config,context:this.context,metadata:this.metadata,jwt:t});case 13:case"end":return e.stop()}}),e,this,[[1,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"now",value:function(){return Math.floor((new Date).getTime()/1e3)}}],[{key:"open",value:function(){var t=(0,U.Z)((0,L.Z)().mark((function t(n){var r,i,a,s,o,u,c,l,f,h,d,p,v,g,w,y,m,b,k,x,Z,C,E,_,S;return(0,L.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.sequenceApiUrl,i=n.sequenceMetadataUrl,a=n.context,s=n.networks,o=n.referenceSigner,u=n.signers,c=n.threshold,l=n.deepSearch,f=n.knownConfigs,h=n.noIndex,d=n.metadata,p=ua(s),v=n.configFinder?n.configFinder:new Qn(p),g=Promise.all(u.map(function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=ia,e.t1={},e.t2=t,"string"!==typeof t.signer){e.next=7;break}e.t3=t.signer,e.next=10;break;case 7:return e.next=9,t.signer.getAddress();case 9:e.t3=e.sent;case 10:return e.t4=e.t3,e.t5={address:e.t4},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t5));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),w=u.filter((function(e){return"string"!==typeof e.signer})).map((function(e){return e.signer})),t.next=7,v.findLastWalletOfInitialSigner({signer:o,context:a,provider:p,requireIndex:!l});case 7:if(!(y=t.sent.wallet)){t.next=37;break}return t.next=11,v.findCurrentConfig({address:y,provider:p,context:a,knownConfigs:f});case 11:if(m=t.sent.config){t.next=14;break}throw Error("Wallet config not found");case 14:return b=(0,R.Z)(Vi,[{initialConfig:m,networks:s,context:a}].concat((0,M.Z)(w))),k=new e(r,i,s,m,a,b,d,p),t.t0=b,t.t1=Kn,t.t2=m,t.t3=c,t.next=22,g;case 22:return t.t4=t.sent,t.t5={threshold:t.t3,set:t.t4},t.t6=(0,t.t1)(t.t2,t.t5),t.t7=!h,t.next=28,t.t0.updateConfig.call(t.t0,t.t6,t.t7);case 28:return x=t.sent,Z=(0,P.Z)(x,1),C=Z[0],k.setConfig(C),k.setAccount((0,R.Z)(Vi,[{initialConfig:C,networks:s,context:a}].concat((0,M.Z)(w)))),k._initialAuthRequest=r?k.auth():Promise.reject("no sequence api url"),t.abrupt("return",k);case 37:return t.t8=Jn,t.t9=c,t.next=41,g;case 41:return t.t10=t.sent,E=(0,t.t8)(t.t9,t.t10),_=(0,R.Z)(Vi,[{initialConfig:E,networks:s,context:a}].concat((0,M.Z)(w))),t.next=46,_.publishConfig(!h,[o]);case 46:return(S=new e(r,i,s,E,a,_,d,p))._initialAuthRequest=r?S.auth():Promise.reject("no sequence api url"),t.abrupt("return",S);case 49:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"load",value:function(t){var n=t.sequenceApiUrl,r=t.sequenceMetadataUrl,i=t.dump,a=t.signers,s=t.networks;return new e(n,r,s,i.config,i.context,(0,R.Z)(Vi,[{initialConfig:i.config,context:i.context,networks:s}].concat((0,M.Z)(a))),i.metadata,ua(s),i.jwt)}}]),e}();function ua(e){var t,n=Ut(e);if(!n)throw Error("Auth chain not found");return null!=(t=n.provider)?t:new D.r(n.rpcUrl)}function ca(e){return it(e).exp}var la=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getChainId();case 2:return r=e.sent,e.t0=q,e.next=6,t.getAddress();case 6:if(e.t1=e.sent,(i=e.t0.getAddress.call(e.t0,e.t1))&&""!==i&&"0x"!==i){e.next=10;break}throw ha;case 10:if((a=new Ie).address=i,n&&n.app&&""!==n.app){e.next=14;break}throw new fa("authorization options requires app to be set");case 14:return a.claims.app=n.app,a.claims.ogn=n.origin,a.setExpiryIn(n.expiry?Math.max(n.expiry,200):aa),s=a.messageTypedData(),e.next=20,t.signTypedData(s.domain,s.types,s.message,r);case 20:return a.signature=e.sent,o=new Le,e.next=24,o.encodeProof(a,!0);case 24:return u=e.sent,e.abrupt("return",{typedData:s,proofString:u});case 26:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),fa=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).name="AuthError",r}return(0,b.Z)(n)}((0,A.Z)(Error)),ha=new fa("auth error: account address is empty"),da=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){var i,a,s,o;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&void 0!==t&&void 0!==n){e.next=2;break}return e.abrupt("return",{isValid:!1});case 2:return i=r.messageDigest(),e.next=5,t.getCode(r.address);case 5:if(!("0x"===(a=e.sent)||a.length<=2)){e.next=8;break}throw new Error("ValidateSequenceDeployedWalletProof failed. unable to fetch wallet contract code");case 8:return s=["function isValidSignature(bytes32, bytes) public view returns (bytes4)"],o=new W.CH(r.address,s,t),e.next=12,o.isValidSignature(i,B.lE(r.signature));case 12:if(e.sent!==Ae){e.next=17;break}return e.abrupt("return",{isValid:!0});case 17:return e.abrupt("return",{isValid:!1});case 18:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),pa=function(e){return function(){var t=(0,U.Z)((0,L.Z)().mark((function t(n,r,i){var a,s,o;return(0,L.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&void 0!==n&&void 0!==r){t.next=2;break}return t.abrupt("return",{isValid:!1});case 2:return t.t0=q,t.next=5,n.getCode(i.address);case 5:if(t.t1=t.sent,0===t.t0.arrayify.call(t.t0,t.t1).length){t.next=9;break}return t.abrupt("return",{isValid:!1});case 9:return a=i.messageDigest(),s=B.lE(F.w(a)),t.next=13,Xi(i.address,s,i.signature,e||en,n,r);case 13:return o=t.sent,t.abrupt("return",{isValid:!!o});case 15:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()};function va(){return va=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},va.apply(this,arguments)}var ga="v1",wa="v0.4.0",ya="8d39664df13fabe72919e65140f9563b21aa3531",ma=function(){function e(t,n){var r=this;(0,m.Z)(this,e),this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Guard/",this.ping=function(e){return r.fetch(r.url("Ping"),ba({},e)).then((function(e){return ka(e).then((function(e){return{status:e.status}}))}))},this.version=function(e){return r.fetch(r.url("Version"),ba({},e)).then((function(e){return ka(e).then((function(e){return{version:e.version}}))}))},this.runtimeStatus=function(e){return r.fetch(r.url("RuntimeStatus"),ba({},e)).then((function(e){return ka(e).then((function(e){return{status:e.status}}))}))},this.getSequenceContext=function(e){return r.fetch(r.url("GetSequenceContext"),ba({},e)).then((function(e){return ka(e).then((function(e){return{data:e.data}}))}))},this.getSignerConfig=function(e){return r.fetch(r.url("GetSignerConfig"),ba({},e)).then((function(e){return ka(e).then((function(e){return{signerConfig:e.signerConfig}}))}))},this.sign=function(e,t){return r.fetch(r.url("Sign"),ba(e,t)).then((function(e){return ka(e).then((function(e){return{sig:e.sig}}))}))},this.hostname=t,this.fetch=function(e,t){return n(e,t)}}return(0,b.Z)(e,[{key:"url",value:function(e){return this.hostname+this.path+e}}]),e}(),ba=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{method:"POST",headers:va({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}},ka=function(e){return e.text().then((function(t){var n;try{n=JSON.parse(t)}catch(r){throw{code:"unknown",msg:"expecting JSON, got: ".concat(t),status:e.status}}if(!e.ok)throw n;return n}))},xa=n(78758),Za=n(34587),Ca=n(76817);function Ea(){return Ea=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ea.apply(this,arguments)}var _a,Sa,Ia,Ta=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,null,[{key:"new",value:function(e){return new URLSearchParams(e)}}]),n}((0,A.Z)(URLSearchParams));!function(e){e.OPEN="open",e.CLOSE="close",e.MESSAGE="message",e.CONNECT="connect",e.DISCONNECT="disconnect",e.ACCOUNTS_CHANGED="accountsChanged",e.CHAIN_CHANGED="chainChanged",e.NETWORKS="networks",e.WALLET_CONTEXT="walletContext",e.INIT="init",e.DEBUG="_debug"}(_a||(_a={})),function(e){e[e.CLOSED=0]="CLOSED",e[e.OPENING=1]="OPENING",e[e.OPENED=2]="OPENED"}(Sa||(Sa={})),function(e){e[e.NIL=0]="NIL",e[e.SENT_NONCE=1]="SENT_NONCE",e[e.OK=2]="OK"}(Ia||(Ia={}));var Oa=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).name="ProviderError",r}return(0,b.Z)(n)}((0,A.Z)(Error)),Na=new Oa("Wallet is not signed in. Connect a wallet and try again."),Aa=3e4,Pa=0,Ra=function(){return++Pa},Ma=function(){function e(){(0,m.Z)(this,e);var t=this;this.pendingMessageRequests=[],this.responseCallbacks=new Map,this.state=void 0,this.confirmationOnly=!1,this.events=new xa.EventEmitter2,this.openPayload=void 0,this.connectPayload=void 0,this.accountsChangedPayload=void 0,this.networksPayload=void 0,this.walletContextPayload=void 0,this._sessionId=void 0,this._init=void 0,this._registered=void 0,this.sendAsync=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(n,r,i){var a;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.state===Sa.CLOSED&&(t.confirmationOnly=!0),t.openWallet(void 0,{type:"jsonRpcRequest",method:n.method},i),e.prev=2,t.isOpened()){e.next=6;break}return e.next=6,t.waitUntilOpened();case 6:return e.next=8,t.sendMessageRequest({idx:Ra(),type:_a.MESSAGE,data:n,chainId:i});case 8:a=e.sent,r(void 0,a.data),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r(e.t0);case 15:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t,n,r){return e.apply(this,arguments)}}(),this.sendMessageRequest=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(n){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){(!n.idx||n.idx<=0)&&"init"!==n.type&&r(new Error("message idx not set"));var i=n.idx;t.responseCallbacks.get(i)?r(new Error("duplicate message idx, should never happen")):t.responseCallbacks.set(i,(function(t,n){if(t)r(t);else{if(!n)throw new Error("no valid response to return");e(n)}})),t.isOpened()?t.sendMessage(n):(ot.debug("pushing to pending requests",n),t.pendingMessageRequests.push(n))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.waitUntilOpened=(0,U.Z)((0,L.Z)().mark((function e(){var n,r,i=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>0&&void 0!==i[0]?i[0]:Aa,r=!1,e.abrupt("return",Promise.race([new Promise((function(e,i){var a=setTimeout((function(){clearTimeout(a),r||(t.state=Sa.CLOSED,t.events.emit("close",{code:1005,message:"opening wallet timed out"})),i(new Error("opening wallet timed out"))}),n)})),new Promise((function(e){var n;if(t.isOpened())return r=!0,void e(null==(n=t.openPayload)?void 0:n.session);t.events.once("open",(function(n){t.openPayload=n,r=!0,e(n.session)}))}))]));case 3:case"end":return e.stop()}}),e)}))),this.waitUntilConnected=(0,U.Z)((0,L.Z)().mark((function e(){var n,r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.waitUntilOpened();case 2:return n=new Promise((function(e){t.connectPayload?e(t.connectPayload):t.events.once("connect",(function(n){t.connectPayload=n,e(n)}))})),r=new Promise((function(e,n){t.events.once("close",(function(e){n(e?new Error("wallet closed due to ".concat(JSON.stringify(e))):new Error("user closed the wallet"))}))})),e.abrupt("return",Promise.race([n,r]));case 5:case"end":return e.stop()}}),e)}))),this.state=Sa.CLOSED,this._registered=!1,this._init=Ia.NIL}return(0,b.Z)(e,[{key:"registered",get:function(){return this._registered}},{key:"register",value:function(){throw new Error("abstract method")}},{key:"unregister",value:function(){throw new Error("abstract method")}},{key:"openWallet",value:function(e,t,n){throw new Error("abstract method")}},{key:"closeWallet",value:function(){throw new Error("abstract method")}},{key:"isOpened",value:function(){return this.registered&&this.state===Sa.OPENED}},{key:"isConnected",value:function(){var e,t=null==(e=this.openPayload)?void 0:e.session;return this.registered&&void 0!==t&&!!t.accountAddress&&42===t.accountAddress.length&&!!t.networks&&t.networks.length>0}},{key:"handleMessage",value:function(e){var t=this,n=this;if(e.type===_a.INIT){ot.debug("MessageProvider, received INIT message",e);var r=e.data.nonce;if(!r||0==r.length)return void ot.error("invalid init nonce");this._init=Ia.OK,this.sendMessage({idx:-1,type:_a.INIT,data:{sessionId:this._sessionId,nonce:r}})}if(this._init===Ia.OK){ot.debug("RECEIVED MESSAGE FROM WALLET",e.idx,e);var i=e.idx,a=this.responseCallbacks.get(i);if(i&&this.responseCallbacks.delete(i),e.type!==_a.OPEN||this.isOpened()){if(e.type===_a.MESSAGE){if(this.confirmationOnly&&setTimeout((function(){0===t.responseCallbacks.size&&t.closeWallet()}),500),!a)throw new Error("impossible state");if(a)return this.events.emit("message",e),void a(e.data.error,e)}if(e.type===_a.ACCOUNTS_CHANGED)return this.accountsChangedPayload={accounts:[]},void(e.data&&e.data.length>0?(this.accountsChangedPayload={accounts:[We.Kn(e.data[0])],origin:e.origin},this.events.emit("accountsChanged",this.accountsChangedPayload.accounts,this.accountsChangedPayload.origin)):this.events.emit("accountsChanged",[],e.origin));if(e.type!==_a.CHAIN_CHANGED){if(e.type===_a.NETWORKS)return this.networksPayload=e.data,void this.events.emit("networks",this.networksPayload);if(e.type===_a.WALLET_CONTEXT)return this.walletContextPayload=e.data,void this.events.emit("walletContext",this.walletContextPayload);e.type===_a.CLOSE&&this.state!==Sa.CLOSED&&this.close(e.data),e.type===_a.CONNECT&&(this.connectPayload=e.data,this.events.emit("connect",this.connectPayload)),e.type===_a.DISCONNECT&&this.isConnected()&&(this.events.emit("disconnect",e.data),this.close())}else this.events.emit("chainChanged",e.data)}else{var s,o;if(this._sessionId&&this._sessionId!==(null==(s=e.data)?void 0:s.sessionId))return void ot.debug("open event received from wallet, but does not match sessionId",this._sessionId);if(null!=(o=e.data)&&o.error){var u,c=new Error("opening wallet failed: received ".concat(null==(u=e.data)?void 0:u.error));throw ot.error(c),this.close(),c}this.state=Sa.OPENED,this.openPayload=e.data,this.events.emit("open",this.openPayload),0!==this.pendingMessageRequests.length&&this.pendingMessageRequests.splice(0,this.pendingMessageRequests.length).forEach(function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.sendMessage(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}}},{key:"sendMessage",value:function(e){throw new Error("abstract method")}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"once",value:function(e,t){this.events.once(e,t)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(t=this.events).emit.apply(t,[e].concat(r))}},{key:"close",value:function(e){this.state!==Sa.CLOSED&&(this.state=Sa.CLOSED,this.confirmationOnly=!1,this._sessionId=void 0,ot.info("closing wallet and flushing!"),this.pendingMessageRequests.length=0,this.responseCallbacks.forEach((function(e){e(Ea({},new Error("wallet closed"),{code:4001}))})),this.responseCallbacks.clear(),this.connectPayload=void 0,this.openPayload=void 0,this.accountsChangedPayload=void 0,this.networksPayload=void 0,this.walletContextPayload=void 0,this.events.emit("close",e))}}]),e}(),La=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];(0,m.Z)(this,e);var s=this;this.signer=void 0,this.signerReadyCallbacks=[],this.prompter=void 0,this.auxDataProvider=void 0,this.mainnetNetworks=void 0,this.testnetNetworks=void 0,this._openIntent=void 0,this._connectOptions=void 0,this._defaultNetworkId=void 0,this._chainId=void 0,this.events=new xa.EventEmitter2,this.promptConnect=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||s._connectOptions){e.next=2;break}throw new Error("prompter connect options are empty");case 2:if(s.prompter){e.next=4;break}return e.abrupt("return",s.connect(t));case 4:return e.next=6,s.prompter.promptConnect(t||s._connectOptions).catch((function(e){return{connected:!1}}));case 6:if(n=e.sent,!(r=n).connected||r.session){e.next=12;break}return e.next=11,s.walletSession();case 11:r.session=e.sent;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.sendAsync=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){var i,a,o,u,c,l,f,h,d,p,v,g,w,y,m,b,k,x,Z,C,E,_,S,I,T,O,N,A,R,M,U,D,W,B,F,j,G,H,V,K,J,$,Y,z,Q,X,ee,te,ne,re,ie,ae,se,oe,ue;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={jsonrpc:"2.0",id:t.id,result:null},e.next=3,s.getSigner();case 3:if(e.prev=3,s.signer&&null!==s.signer||Ua.includes(t.method)){e.next=6;break}throw Na;case 6:if(a=s.signer){e.next=9;break}throw new Error("WalletRequestHandler: wallet signer is not configured");case 9:return e.next=11,a.getProvider(r);case 11:if(o=e.sent){e.next=14;break}throw new Error("WalletRequestHandler: wallet provider is not configured for chainId ".concat(r));case 14:e.t0=t.method,e.next="net_version"===e.t0?17:"eth_chainId"===e.t0?22:"eth_accounts"===e.t0?27:"eth_getBalance"===e.t0?32:"personal_sign"===e.t0||"eth_sign"===e.t0?38:"eth_signTypedData"===e.t0||"eth_signTypedData_v4"===e.t0?60:"eth_sendTransaction"===e.t0?85:"eth_signTransaction"===e.t0?104:"eth_sendRawTransaction"===e.t0?122:"eth_getTransactionCount"===e.t0?139:"eth_blockNumber"===e.t0?158:"eth_getBlockByNumber"===e.t0?162:"eth_getBlockByHash"===e.t0?166:"eth_getTransactionByHash"===e.t0?170:"eth_call"===e.t0?174:"eth_getCode"===e.t0?179:"eth_estimateGas"===e.t0?184:"eth_gasPrice"===e.t0?189:"wallet_switchEthereumChain"===e.t0?194:"sequence_getWalletContext"===e.t0?205:"sequence_getWalletConfig"===e.t0?209:"sequence_getWalletState"===e.t0?214:"sequence_getNetworks"===e.t0?219:"sequence_updateConfig"===e.t0?223:"sequence_publishConfig"===e.t0?225:"sequence_gasRefundOptions"===e.t0?227:"sequence_getNonce"===e.t0?228:"sequence_relay"===e.t0?229:"sequence_setDefaultNetwork"===e.t0?230:242;break;case 17:return e.next=19,o.send("net_version",[]);case 19:return u=e.sent,i.result=u,e.abrupt("break",246);case 22:return e.next=24,o.send("eth_chainId",[]);case 24:return c=e.sent,i.result=c,e.abrupt("break",246);case 27:return e.next=29,a.getAddress();case 29:return l=e.sent,i.result=[l],e.abrupt("break",246);case 32:return f=(0,P.Z)(t.params,2),h=f[0],d=f[1],e.next=35,o.getBalance(h,d);case 35:return p=e.sent,i.result=p.toHexString(),e.abrupt("break",246);case 38:if("personal_sign"===t.method?(g=(0,P.Z)(t.params,2),w=g[0],g[1],v=w):(y=(0,P.Z)(t.params,2),y[0],m=y[1],v=m),b="",k=Ya(v),null!==s.prompter){e.next=47;break}return e.next=44,a.signMessage(k,r);case 44:b=e.sent,e.next=54;break;case 47:return e.next=49,s.handleConfirmWalletDeployPrompt(s.prompter,a,r);case 49:if(!e.sent){e.next=54;break}return e.next=53,s.prompter.promptSignMessage({chainId:r,message:k},s.connectOptions);case 53:b=e.sent;case 54:if(!(b&&b.length>0)){e.next=58;break}i.result=b,e.next=59;break;case 58:throw new Error("declined by user");case 59:return e.abrupt("break",246);case 60:if(x=(0,P.Z)(t.params,2),x[0],Z=x[1],C=void 0,"string"===typeof Z)try{C=JSON.parse(Z)}catch(L){}else C=Z;if(C&&C.domain&&C.types&&C.message){e.next=65;break}throw new Error("invalid typedData object");case 65:if(E="",null!==s.prompter){e.next=72;break}return e.next=69,a.signTypedData(C.domain,C.types,C.message,r);case 69:E=e.sent,e.next=79;break;case 72:return e.next=74,s.handleConfirmWalletDeployPrompt(s.prompter,a,r);case 74:if(!e.sent){e.next=79;break}return e.next=78,s.prompter.promptSignMessage({chainId:r,typedData:C},s.connectOptions);case 78:E=e.sent;case 79:if(!(E&&E.length>0)){e.next=83;break}i.result=E,e.next=84;break;case 83:throw new Error("declined by user");case 84:return e.abrupt("break",246);case 85:if(_=(0,P.Z)(t.params,1),"gas"in(S=_[0])&&void 0===S.gasLimit&&(S.gasLimit=S.gas,delete S.gas),I="",null!==s.prompter){e.next=95;break}return e.next=91,a.sendTransaction(S,r);case 91:T=e.sent,I=T.hash,e.next=98;break;case 95:return e.next=97,s.prompter.promptSendTransaction(S,r,s.connectOptions);case 97:I=e.sent;case 98:if(!I){e.next=102;break}i.result=I,e.next=103;break;case 102:throw new Error("declined by user");case 103:return e.abrupt("break",246);case 104:return O=(0,P.Z)(t.params,1),N=O[0],A=We.Kn(N.from),e.t1=A,e.next=109,a.getAddress();case 109:if(e.t2=e.sent,e.t1===e.t2){e.next=112;break}throw new Error("sender address does not match wallet");case 112:if(null!==s.prompter){e.next=118;break}return e.next=115,a.signTransactions(N,r);case 115:i.result=e.sent,e.next=121;break;case 118:return e.next=120,s.prompter.promptSignTransaction(N,r,s.connectOptions);case 120:i.result=e.sent;case 121:return e.abrupt("break",246);case 122:if(!fi(t.params[0])){e.next=134;break}return R=De.O$.from(t.params[0].chainId).toNumber(),e.next=126,a.getRelayer(R);case 126:return e.next=128,e.sent.relay(t.params[0]);case 128:return M=e.sent,e.next=131,M;case 131:i.result=e.sent.hash,e.next=138;break;case 134:return e.next=136,o.sendTransaction(t.params[0]);case 136:U=e.sent,i.result=U.hash;case 138:return e.abrupt("break",246);case 139:return D=We.Kn(t.params[0]),W=t.params[1],e.t3=q,e.next=144,a.getAddress();case 144:if(e.t4=e.sent,B=e.t3.getAddress.call(e.t3,e.t4),D!==B){e.next=153;break}return e.next=149,a.getTransactionCount(W);case 149:F=e.sent,i.result=De.O$.from(F).toHexString(),e.next=157;break;case 153:return e.next=155,o.getTransactionCount(D,W);case 155:j=e.sent,i.result=De.O$.from(j).toHexString();case 157:return e.abrupt("break",246);case 158:return e.next=160,o.getBlockNumber();case 160:return i.result=e.sent,e.abrupt("break",246);case 162:return e.next=164,o.getBlock(t.params[0]);case 164:return i.result=e.sent,e.abrupt("break",246);case 166:return e.next=168,o.getBlock(t.params[0]);case 168:return i.result=e.sent,e.abrupt("break",246);case 170:return e.next=172,o.getTransaction(t.params[0]);case 172:return i.result=e.sent,e.abrupt("break",246);case 174:return G=(0,P.Z)(t.params,2),H=G[0],V=G[1],e.next=177,o.call(H,V);case 177:return i.result=e.sent,e.abrupt("break",246);case 179:return K=(0,P.Z)(t.params,2),J=K[0],$=K[1],e.next=182,o.getCode(J,$);case 182:return i.result=e.sent,e.abrupt("break",246);case 184:return Y=(0,P.Z)(t.params,1),z=Y[0],e.next=187,o.estimateGas(z);case 187:return i.result=e.sent,e.abrupt("break",246);case 189:return e.next=191,o.getGasPrice();case 191:return Q=e.sent,i.result=Q.toHexString(),e.abrupt("break",246);case 194:if(X=(0,P.Z)(t.params,1),(ee=X[0]).chainId&&0!==ee.chainId.length){e.next=197;break}throw new Error("invalid chainId");case 197:return te=De.O$.from(ee.chainId),e.next=200,s.setDefaultNetwork(te.toString(),!0);case 200:if(e.sent){e.next=203;break}throw new Error("unable to set chainId ".concat(te));case 203:return i.result=null,e.abrupt("break",246);case 205:return e.next=207,a.getWalletContext();case 207:return i.result=e.sent,e.abrupt("break",246);case 209:return ne=(0,P.Z)(t.params,1),re=ne[0],e.next=212,a.getWalletConfig(re);case 212:return i.result=e.sent,e.abrupt("break",246);case 214:return ie=(0,P.Z)(t.params,1),ae=ie[0],e.next=217,a.getWalletState(ae);case 217:return i.result=e.sent,e.abrupt("break",246);case 219:return e.next=221,s.getNetworks(!0);case 221:return i.result=e.sent,e.abrupt("break",246);case 223:throw new Error("sequence_updateConfig method is not allowed from a dapp");case 225:throw new Error("sequence_publishConfig method is not allowed from a dapp");case 227:case 228:case 229:return e.abrupt("break",246);case 230:if(se=(0,P.Z)(t.params,1),oe=se[0]){e.next=233;break}throw new Error("invalid request, method argument defaultNetworkId cannot be empty");case 233:return e.next=235,s.setDefaultNetwork(oe);case 235:if(e.sent){e.next=238;break}throw new Error("unable to set default network ".concat(oe));case 238:return e.next=240,s.getNetworks(!0);case 240:return i.result=e.sent,e.abrupt("break",246);case 242:return e.next=244,o.send(t.method,t.params);case 244:ue=e.sent,i.result=ue;case 246:e.next=253;break;case 248:e.prev=248,e.t5=e.catch(3),ot.error(e.t5),i.result=null,i.error=Ea({},new Error(e.t5),{code:4001});case 253:n(void 0,i);case 254:case"end":return e.stop()}}),e,null,[[3,248]])})));return function(t,n,r){return e.apply(this,arguments)}}(),this.isSignedIn=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.signerReady();case 2:return e.abrupt("return",!!s.signer);case 3:case"end":return e.stop()}}),e)}))),this.getSigner=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.signerReady();case 2:if(void 0!==s.signer){e.next=4;break}throw new Error("signerReady failed resolve");case 4:return e.abrupt("return",s.signer);case 5:case"end":return e.stop()}}),e)}))),this.signer=t,this.prompter=n,this.auxDataProvider=r,this.mainnetNetworks=i,this.testnetNetworks=a}return(0,b.Z)(e,[{key:"signIn",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a,s,o,u,c,l=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:{},this.setSigner(t),r=n.connect,i=n.mainnetNetworks,a=n.testnetNetworks,s=n.defaultNetworkId,i&&i.length>0&&(this.mainnetNetworks=i),a&&a.length>0&&(this.testnetNetworks=a),this.mainnetNetworks&&0!==this.mainnetNetworks.length||this.testnetNetworks&&0!==this.testnetNetworks.length){e.next=7;break}throw new Error("signIn failed as network configuration is empty");case 7:if(!(o=s||this._defaultNetworkId)){e.next=13;break}return e.next=11,this.setDefaultNetwork(o,!1);case 11:if(e.sent){e.next=13;break}throw new Error("WalletRequestHandler setup unable to set defaultNetworkId ".concat(o));case 13:if(!r){e.next=20;break}return u=this._connectOptions,e.next=17,this.connect(u);case 17:c=e.sent,this.notifyConnect(c),u&&!0===u.keepWalletOpened||this.notifyClose();case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"signOut",value:function(){this.setSigner(null)}},{key:"signerReset",value:function(){this.signer=void 0}},{key:"signerReady",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;return new Promise((function(n,r){void 0!==e.signer?n():(setTimeout((function(){void 0===e.signer&&(e.signerReadyCallbacks=[],r("signerReady timed out"))}),t),e.signerReadyCallbacks.push(n))}))}},{key:"connect",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signer){e.next=2;break}return e.abrupt("return",{connected:!1,chainId:"0x0",error:"unable to connect without signed in account"});case 2:return e.t0=q,e.next=5,this.getChainId();case 5:if(e.t1=e.sent,e.t2=e.t0.hexlify.call(e.t0,e.t1),n={connected:!0,chainId:e.t2},!t||!t.askForEmail){e.next=13;break}return e.next=11,null==(r=this.auxDataProvider)?void 0:r.get("email");case 11:(i=e.sent)&&(n.email=i);case 13:if(!t||!t.authorize){e.next=25;break}return a={app:t.app,origin:t.origin,expiry:t.expiry},e.prev=15,e.next=18,la(this.signer,a);case 18:n.proof=e.sent,e.next=25;break;case 21:return e.prev=21,e.t3=e.catch(15),ot.warn("connect, signAuthorization failed for options: ".concat(JSON.stringify(t),", due to: ").concat(e.t3.message)),e.abrupt("return",{connected:!1,chainId:"0x0",error:"signAuthorization failed: ".concat(e.t3.message)});case 25:return e.next=27,this.walletSession();case 27:return n.session=e.sent,e.abrupt("return",n);case 29:case"end":return e.stop()}}),e,this,[[15,21]])})));return function(t){return e.apply(this,arguments)}}()},{key:"sendMessageRequest",value:function(e){var t=this;return new Promise((function(n){t.sendAsync(e.data,(function(t,r){var i=Ea({},e,{data:r});n(i)}),e.chainId)}))}},{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"once",value:function(e,t){this.events.once(e,t)}},{key:"getAddress",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signer){e.next=4;break}return e.abrupt("return","");case 4:return e.abrupt("return",this.signer.getAddress());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChainId",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signer){e.next=4;break}return e.abrupt("return",0);case 4:if(!this._chainId){e.next=6;break}return e.abrupt("return",this._chainId);case 6:return e.next=8,this.signer.getChainId();case 8:return this._chainId=e.sent,e.abrupt("return",this._chainId);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"openIntent",get:function(){return this._openIntent}},{key:"setOpenIntent",value:function(e){this._openIntent=e}},{key:"connectOptions",get:function(){return this._connectOptions}},{key:"setConnectOptions",value:function(e){this._connectOptions=e}},{key:"defaultNetworkId",get:function(){return this._defaultNetworkId}},{key:"setDefaultNetwork",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(i.length>1&&void 0!==i[1])||i[1],t){e.next=3;break}return e.abrupt("return",void 0);case 3:if(this._defaultNetworkId=t,this._chainId=void 0,!this.signer||!this.signer.setNetworks){e.next=13;break}if(!(r=this.signer.setNetworks(this.mainnetNetworks,this.testnetNetworks,t))||!n){e.next=10;break}return e.next=10,this.notifyNetworks();case 10:return e.abrupt("return",r);case 13:return e.abrupt("return",void 0);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNetworks",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signer){e.next=3;break}return ot.warn("signer not set: getNetworks is returning an empty list"),e.abrupt("return",[]);case 3:return e.next=5,this.signer.getNetworks();case 5:if(n=e.sent,!t){e.next=10;break}return e.abrupt("return",n.map((function(e){var t=Ea({},e);return t.provider=void 0,t.relayer=void 0,t})));case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"walletSession",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signer){e.next=4;break}e.t0=void 0,e.next=14;break;case 4:return e.next=6,this.signer.getWalletContext();case 6:return e.t1=e.sent,e.next=9,this.signer.getAddress();case 9:return e.t2=e.sent,e.next=12,this.getNetworks(!0);case 12:e.t3=e.sent,e.t0={walletContext:e.t1,accountAddress:e.t2,networks:e.t3};case 14:return e.abrupt("return",e.t0);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"notifyConnect",value:function(e,t){var n,r;(this.events.emit("connect",e),null!=(n=e.session)&&n.accountAddress)&&this.events.emit("accountsChanged",[null==(r=e.session)?void 0:r.accountAddress],t)}},{key:"notifyDisconnect",value:function(e){this.events.emit("accountsChanged",[],e),this.events.emit("disconnect")}},{key:"notifyNetworks",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t,e.t0){e.next=5;break}return e.next=4,this.getNetworks(!0);case 4:e.t0=e.sent;case 5:n=e.t0,this.events.emit("networks",n),n.length>0?(r=n.find((function(e){return e.isDefaultChain})),r&&this.events.emit("chainChanged",B.Dv(r.chainId))):this.events.emit("chainChanged","0x0");case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"notifyWalletContext",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){var t;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.signer){e.next=3;break}return ot.warn("signer not set: skipping to notify wallet context"),e.abrupt("return");case 3:return e.next=5,this.signer.getWalletContext();case 5:t=e.sent,this.events.emit("walletContext",t);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"notifyClose",value:function(e){this.events.emit("close",e)}},{key:"setSigner",value:function(e){if(this.signer=e,void 0!==e){for(var t=0;t<this.signerReadyCallbacks.length;t++)this.signerReadyCallbacks[t]();this.signerReadyCallbacks=[]}}},{key:"handleConfirmWalletDeployPrompt",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,rs(n,r);case 4:if(!e.sent){e.next=7;break}return e.abrupt("return",!0);case 7:return e.next=9,t.promptConfirmWalletDeploy(r,this.connectOptions);case 9:if(!e.sent){e.next=20;break}return e.next=13,rs(n,r);case 13:if(e.sent){e.next=19;break}return ot.error("WalletRequestHandler: result for promptConfirmWalletDeploy is not correct"),e.abrupt("return",!1);case 19:return e.abrupt("return",!0);case 20:return e.abrupt("return",!1);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}(),Ua=["net_version","eth_chainId","eth_getBalance","eth_getTransactionCount","eth_blockNumber","eth_getBlockByNumber","eth_getBlockByHash","eth_getTransactionByHash","eth_getCode","eth_estimateGas","eth_gasPrice","sequence_getWalletContext","sequence_getNetworks","sequence_setDefaultNetwork"],Da=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;(0,m.Z)(this,n);var a=new cn(e,Lt(r));return e=a,(i=t.call(this,e,"any"))._sender=void 0,i._isSequenceProvider=void 0,i._defaultChainId=void 0,i._sender=a,i._isSequenceProvider=!0,i._defaultChainId=Lt(r),i}return(0,b.Z)(n,[{key:"sendAsync",value:function(e,t,n){this._sender.sendAsync(e,t,n)}},{key:"send",value:function(e,t,n){return this._sender.send(e,t,n)}},{key:"request",value:function(e){return this.send(e.method,e.params||[],e.chainId)}},{key:"getSigner",value:function(){return new Ba(this,this._defaultChainId)}},{key:"getChainId",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){var t,n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.send("eth_chainId",[]);case 2:if(t=e.sent,n=De.O$.from(t).toNumber(),!this._defaultChainId||this._defaultChainId===n){e.next=6;break}throw new Error("provider chainId (".concat(n,") does not match provider-bound chainId ").concat(this._defaultChainId));case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"isSequenceProvider",value:function(e){return qa(e)}}]),n}(Za.Q);function qa(e){var t=e;return t&&void 0!==t.send&&!0===t._isSequenceProvider}var Wa=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){(0,m.Z)(this,n);var i=new La(e,null,null,r||[]);return t.call(this,i)}return(0,b.Z)(n)}(Da),Ba=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;return(0,m.Z)(this,n),(i=t.call(this)).provider=void 0,i.defaultChainId=void 0,i._address=void 0,i._index=void 0,i._context=void 0,i._networks=void 0,i._providers={},i.provider=e,i.defaultChainId=r,i}return(0,b.Z)(n,[{key:"getAddress",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){var t;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._address){e.next=2;break}return e.abrupt("return",this._address);case 2:return e.next=4,this.provider.send("eth_accounts",[]);case 4:return t=e.sent,this._address=t[0],this._index=0,e.abrupt("return",We.Kn(this._address));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signTransaction",value:function(e){throw new Error("signTransaction is unsupported, use signTransactions instead")}},{key:"connect",value:function(e){throw new Error("unsupported: cannot alter JSON-RPC Signer connection")}},{key:"getProvider",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return e.next=3,this.getChainId();case 3:if((n=e.sent)===t){e.next=6;break}throw new Error("signer is attempting to access chain ".concat(t,", but is already bound to chain ").concat(n));case 6:return e.abrupt("return",this.provider);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSender",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&(!t||t!==this.defaultChainId)){e.next=2;break}return e.abrupt("return",this.provider);case 2:return this._providers[t]||(this._providers[t]=new Da(new cn(this.provider,t),t)),e.abrupt("return",this._providers[t]);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRelayer",value:function(e){throw new Error("TODO")}},{key:"getWalletContext",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._context){e.next=4;break}return e.next=3,this.provider.send("sequence_getWalletContext",[]);case 3:this._context=e.sent;case 4:return e.abrupt("return",this._context);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWalletConfig",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.provider.send("sequence_getWalletConfig",[Lt(t)],Lt(t)||this.defaultChainId);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getWalletState",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.provider.send("sequence_getWalletState",[Lt(t)],Lt(t)||this.defaultChainId);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getNetworks",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._networks){e.next=4;break}return e.next=3,this.provider.send("sequence_getNetworks",[]);case 3:this._networks=e.sent;case 4:return e.abrupt("return",this._networks);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSigners",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){var t,n,r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getNetworks();case 2:if(t=e.sent,n=t.find((function(e){return e.isAuthChain}))){e.next=6;break}throw new Error("authChainId could not be determined from network list");case 6:return e.next=8,this.getWalletConfig(n);case 8:if((r=e.sent)&&0!==r.length){e.next=11;break}throw new Error("walletConfig returned zero results for authChainId {authChainId}");case 11:return e.abrupt("return",r[0].signers.map((function(e){return e.address})));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signMessage",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){var i,a,s;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSender(Lt(n)||this.defaultChainId);case 2:return i=e.sent,a="string"===typeof t?Ve.Y0(t):t,e.next=6,this.getAddress();case 6:return s=e.sent,e.next=9,i.send("personal_sign",[B.Dv(a),s]);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"signTypedData",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i,a){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.provider,e.next=3,this.getAddress();case 3:return e.t1=e.sent,e.t2=j.E.getPayload(t,n,r),e.t3=[e.t1,e.t2],e.t4=Lt(i)||this.defaultChainId,e.next=9,e.t0.send.call(e.t0,"eth_signTypedData_v4",e.t3,e.t4);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"sendTransaction",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){var i,a,s=this;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSender(Lt(n)||this.defaultChainId);case 2:return i=e.sent,a=this.sendUncheckedTransaction(t,n).then((function(e){return Ca.$l((function(){return i.getTransaction(e).then((function(t){if(null!==t)return i._wrapTransaction(t,e)}))}),{onceBlock:s.provider}).catch((function(t){throw t.transactionHash=e,t}))})),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sendTransactionBatch",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){var i,a;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ji(t);case 2:if((i=e.sent)&&0!==i.length){e.next=5;break}throw new Error("cannot send empty batch");case 5:if(!i.find((function(e){return void 0!==e.wait&&null!==e.wait}))){e.next=7;break}throw new Error("transaction request expected for sendTransactionBatch, transaction response found");case 7:return a=Ea({},i[0]),i.length>1&&(a.auxiliary=i.splice(1)),e.abrupt("return",this.sendTransaction(a,n,r));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"signTransactions",value:function(e,t,n){return e=Zt(e),this.provider.send("eth_signTransaction",[e],Lt(t)||this.defaultChainId)}},{key:"sendSignedTransactions",value:function(e,t){throw new Error("TODO")}},{key:"updateConfig",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a,s;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.provider.send("sequence_updateConfig",[t],this.defaultChainId);case 2:if(n=e.sent,r=(0,P.Z)(n,2),i=r[0],null!==(a=r[1])){e.next=8;break}return e.abrupt("return",[i,void 0]);case 8:return e.next=10,this.getSender(this.defaultChainId);case 10:return s=e.sent,e.abrupt("return",[i,s._wrapTransaction(a,a.hash)]);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"publishConfig",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){var t,n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSender(this.defaultChainId);case 2:return t=e.sent,e.next=5,t.send("sequence_publishConfig",[]);case 5:if(null!==(n=e.sent)){e.next=8;break}return e.abrupt("return",void 0);case 8:return e.abrupt("return",t._wrapTransaction(n,n.hash));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isDeployed",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSender(Lt(t));case 2:return n=e.sent,e.t0=n,e.next=6,this.getAddress();case 6:return e.t1=e.sent,e.next=9,e.t0.getCode.call(e.t0,e.t1);case 9:return r=e.sent,e.abrupt("return",!!r&&"0x"!==r);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_legacySignMessage",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){var i,a,s;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSender(Lt(n)||this.defaultChainId);case 2:return i=e.sent,a="string"===typeof t?Ve.Y0(t):t,e.next=6,this.getAddress();case 6:return s=e.sent,e.next=9,i.send("eth_sign",[s,B.Dv(a)]);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_signTypedData",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i,a){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.signTypedData(t,n,r,i,a));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"sendUncheckedTransaction",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Zt(t),r=this.getAddress(),e.next=4,this.getSender(Lt(n)||this.defaultChainId);case 4:return i=e.sent,e.t0=kt,e.t1=kt(t),e.next=9,r;case 9:return e.t2=e.sent,e.t3={tx:e.t1,sender:e.t2},e.abrupt("return",(0,e.t0)(e.t3).then((function(e){var n=e.tx,r=e.sender;if(null!=n.from){if(We.Kn(n.from)!==r)throw new Error("from address mismatch for transaction ".concat(t))}else n.from=r;var a=ja(n);return i.send("eth_sendTransaction",[a]).then((function(e){return e}),(function(e){throw e}))})));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"connectUnchecked",value:function(){return new Ga(this.provider,this.defaultChainId)}},{key:"unlock",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAddress();case 2:return n=e.sent,e.abrupt("return",this.provider.send("personal_unlockAccount",[n,t,null]));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(qi),Fa={chainId:!0,data:!0,gasLimit:!0,gasPrice:!0,nonce:!0,to:!0,value:!0,from:!0,auxiliary:!0,expiration:!0,afterNonce:!0,delegateCall:!0,revertOnError:!0},ja=function e(t,n){var r=Zt(Fa);if(n)for(var i in n)n[i]&&(r[i]=!0);Ke.uj(t,r);var a={};["gasLimit","gasPrice","nonce","value"].forEach((function(e){var n=t[e];if(null!==n&&void 0!==n){var r=B.$P(n);"gasLimit"===e&&(e="gas"),a[e]=r}})),["from","to","data"].forEach((function(e){t[e]&&(a[e]=B.Dv(t[e]))})),["delegateCall","revertOnError"].forEach((function(e){var n=t[e];void 0!==n&&null!==n&&(a[e]=n)}));var s=t.auxiliary;return s&&s.length>0&&(a.auxiliary=[],s.forEach((function(t){a.auxiliary.push(e(t))}))),a},Ga=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"sendTransaction",value:function(e){var t=this;return this.sendUncheckedTransaction(e).then((function(e){return{chainId:0,confirmations:0,data:"",from:"",gasLimit:qe._Y,gasPrice:qe._Y,hash:e,nonce:0,value:qe._Y,wait:function(n){return t.provider.waitForTransaction(e,n)}}}))}}]),n}(Ba);var Ha=[{name:"Decentraland Exception",predicate:function(e){try{var t=Ve.ZN(e);return Va.test(t)}catch(Vs){return!1}}},{name:"0x v3 Exception",predicate:function(e){var t=new Tt.vU(Ka);try{return t.decodeFunctionData("OrderWithHash",e),!0}catch(n){return!1}}}],Va=/^Decentraland Login\nEphemeral address: 0x[a-fA-F0-9]{40}\nExpiration: (\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)((-(\d{2}):(\d{2})|Z)?)$/;var Ka=[{inputs:[{components:[{internalType:"address",name:"makerAddress",type:"address"},{internalType:"address",name:"takerAddress",type:"address"},{internalType:"address",name:"feeRecipientAddress",type:"address"},{internalType:"address",name:"senderAddress",type:"address"},{internalType:"uint256",name:"makerAssetAmount",type:"uint256"},{internalType:"uint256",name:"takerAssetAmount",type:"uint256"},{internalType:"uint256",name:"makerFee",type:"uint256"},{internalType:"uint256",name:"takerFee",type:"uint256"},{internalType:"uint256",name:"expirationTimeSeconds",type:"uint256"},{internalType:"uint256",name:"salt",type:"uint256"},{internalType:"bytes",name:"makerAssetData",type:"bytes"},{internalType:"bytes",name:"takerAssetData",type:"bytes"},{internalType:"bytes",name:"makerFeeAssetData",type:"bytes"},{internalType:"bytes",name:"takerFeeAssetData",type:"bytes"}],internalType:"struct IEIP1271Data.Order",name:"order",type:"tuple"},{internalType:"bytes32",name:"orderHash",type:"bytes32"}],name:"OrderWithHash",outputs:[],stateMutability:"pure",type:"function"}],Ja=Ve.Y0("\x19Ethereum Signed Message:\n"),$a=function(e){return B._t(e)||B.A7(e)?B.lE(e):Ve.Y0(e)},Ya=function(e){var t=$a(e);return function(e){return Ha.some((function(t){return t.predicate(e)}))}(t)?t:B.zo([Ja,Ve.Y0(String(t.length)),t])},za=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i,a,s){var o;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=10;break}return e.next=3,i.getNetwork();case 3:if(e.t0=o=e.sent,null!=e.t0){e.next=8;break}e.t1=void 0,e.next=9;break;case 8:e.t1=o.chainId;case 9:a=e.t1;case 10:if(s||!Da.isSequenceProvider(i)){e.next=14;break}return e.next=13,i.getSigner().getWalletContext();case 13:s=e.sent;case 14:return e.abrupt("return",Ki(t,n,r,i,s,a));case 15:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a,s){return e.apply(this,arguments)}}(),Qa=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i,a,s){var o,u;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Ya(n),u=Xe(o),e.abrupt("return",za(t,u,r,i,a,s));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a,s){return e.apply(this,arguments)}}(),Xa=function(e,t,n,r,i,a){return za(e,yt(t),n,r,i,a)},es=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i,a){var s,o,u;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=et(t,i,n),e.next=3,na(s,r);case 3:if(o=e.sent,!a){e.next=11;break}if(u=Fn(o,a),!o.address||o.address===u){e.next=10;break}throw new Error("recovered address does not match the WalletConfig address, check the WalletContext");case 10:o.address=u;case 11:return e.abrupt("return",o);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}(),ts=function(){return"chrome-extension:"===window.location.protocol||"moz-extension:"===window.location.protocol},ns=function(){return!!navigator.userAgent.match(/UnitySequence/i)},rs=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r,i,a,s,o,u,c,l,f,h;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getWalletState();case 2:return i=e.sent,e.next=5,t.getNetworks();case 5:if(a=e.sent,s=i.find((function(e){return e.chainId===n}))){e.next=9;break}throw new Error("WalletRequestHandler: could not find wallet state for chainId ".concat(n));case 9:if(o=s.deployed,a){e.next=12;break}throw new Error("isWalletUpToDate util: could not get networks from signer");case 12:if(u=a.find((function(e){return e.isAuthChain})),u){e.next=15;break}throw new Error("isWalletUpToDate util: could not get auth chain network information");case 15:if(c=u.chainId,l=null==(r=i.find((function(e){return e.chainId===c})))?void 0:r.config){e.next=19;break}throw new Error("isWalletUpToDate util: could not get auth chain config");case 19:if(f=s.config){e.next=22;break}throw new Error("isWalletUpToDate util: could not get config for chainId ".concat(n));case 22:return h=Hn(l,f),e.abrupt("return",o&&h);case 24:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),is=function(){function e(){(0,m.Z)(this,e)}return(0,b.Z)(e,null,[{key:"getInstance",value:function(){return e._instance||(e._instance={getItem:function(e){return Promise.resolve(window.localStorage.getItem(e))},setItem:function(e,t){return Promise.resolve(window.localStorage.setItem(e,t))},removeItem:function(e){return Promise.resolve(window.localStorage.removeItem(e))}}),this._instance}},{key:"use",value:function(t){e._instance=t}}]),e}();is._instance=void 0;var as,ss,os=function(){function e(t,n){(0,m.Z)(this,e),this.def=n,this.key=void 0,this.key=t}return(0,b.Z)(e,[{key:"get",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){var t;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,is.getInstance().getItem(this.key);case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt("return",this.def);case 5:return e.prev=5,e.abrupt("return",JSON.parse(t));case 9:e.prev=9,e.t0=e.catch(5),console.error(e.t0);case 12:return e.abrupt("return");case 13:case"end":return e.stop()}}),e,this,[[5,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"set",value:function(e){e?is.getInstance().setItem(this.key,JSON.stringify(e)):is.getInstance().removeItem(this.key)}},{key:"del",value:function(){is.getInstance().removeItem(this.key)}}]),e}(),us="@sequence.transportSession",cs=function(){function e(t){var n=this;(0,m.Z)(this,e);var r=this;this.walletRequestHandler=void 0,this._sessionId=void 0,this._registered=void 0,this._init=void 0,this._initNonce=void 0,this._initCallback=void 0,this.appOrigin=void 0,this.sendAsync=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("abstract method");case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.handleMessage=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,i,a;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t,r._init===Ia.OK){e.next=10;break}if(n.type!==_a.INIT){e.next=9;break}if(!r.isValidInitAck(t)){e.next=7;break}r._initCallback&&r._initCallback(),e.next=9;break;case 7:return r._initCallback&&r._initCallback("invalid init"),e.abrupt("return");case 9:return e.abrupt("return");case 10:e.t0=n.type,e.next=e.t0===_a.OPEN?13:e.t0===_a.CLOSE?19:e.t0===_a.MESSAGE?22:28;break;case 13:if(r._init===Ia.OK){e.next=15;break}return e.abrupt("return");case 15:return i={sessionId:n.data.sessionId,intent:n.data.intent,networkId:n.data.networkId},e.next=18,r.open(i);case 18:return e.abrupt("return");case 19:if(r._init===Ia.OK){e.next=21;break}return e.abrupt("return");case 21:return e.abrupt("return");case 22:return e.next=24,r.walletRequestHandler.sendMessageRequest(n);case 24:return a=e.sent,r.sendMessage(a),a.data.error,e.abrupt("return");case 28:ot.error("unexpected payload type ".concat(n.type));case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.sendMessageRequest=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.walletRequestHandler.sendMessageRequest(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.open=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,i,a,s,o,u,c,l;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sessionId,i=t.intent,a=t.networkId,n&&(r._sessionId=dt(n),r.saveTransportSession({sessionId:n,intent:i,networkId:a})),r.walletRequestHandler.setOpenIntent(i),e.next=5,r.init();case 5:if(!i||"connect"!==i.type||!i.options){e.next=20;break}if(s=i.options,o=s,!r.appOrigin||null==o||!o.origin){e.next=14;break}if(ts()){e.next=12;break}if(o.origin===r.appOrigin){e.next=12;break}throw new Error("origin is invalid");case 12:e.next=15;break;case 14:!r.appOrigin&&null!=o&&o.origin?s.origin=vt(o.origin):r.appOrigin&&(s.origin=r.appOrigin);case 15:s.app&&(s.app=pt(s.app)),r.walletRequestHandler.setConnectOptions(s),s.networkId?a=s.networkId:a&&(s.networkId=a),e.next=21;break;case 20:r.walletRequestHandler.setConnectOptions(void 0);case 21:return e.next=23,r.walletRequestHandler.getSigner();case 23:return e.next=25,r.walletRequestHandler.isSignedIn();case 25:if(e.sent){e.next=30;break}return r.notifyOpen({sessionId:r._sessionId}),e.abrupt("return",!0);case 30:if(!i||"connect"!==i.type){e.next=64;break}if(u=void 0,e.prev=32,!a){e.next=39;break}return e.next=36,r.walletRequestHandler.setDefaultNetwork(a,!1);case 36:u=e.sent,e.next=42;break;case 39:return e.next=41,r.walletRequestHandler.getChainId();case 41:u=e.sent;case 42:e.next=47;break;case 44:e.prev=44,e.t0=e.catch(32),console.error(e.t0);case 47:return(!u||u<=0)&&console.log("Failed to set default network on open"),r.notifyOpen({sessionId:r._sessionId}),e.prev=49,e.next=52,r.walletRequestHandler.promptConnect(i.options);case 52:(c=e.sent).connected&&r.walletRequestHandler.notifyConnect(c),e.next=59;break;case 56:e.prev=56,e.t1=e.catch(49),ot.warn("promptConnect not connected:",e.t1);case 59:return e.prev=59,i.options&&!0===i.options.keepWalletOpened||r.notifyClose(),e.finish(59);case 62:e.next=91;break;case 64:if(l=void 0,e.prev=65,!a){e.next=72;break}return e.next=69,r.walletRequestHandler.setDefaultNetwork(a,!1);case 69:l=e.sent,e.next=75;break;case 72:return e.next=74,r.walletRequestHandler.getChainId();case 74:l=e.sent;case 75:e.next=80;break;case 77:e.prev=77,e.t2=e.catch(65),console.error(e.t2);case 80:if(l&&!(l<=0)){e.next=83;break}return r.notifyOpen({sessionId:r._sessionId,error:"failed to open wallet on network ".concat(a)}),e.abrupt("return",!1);case 83:return e.t3=r,e.t4=r._sessionId,e.t5="".concat(l),e.next=88,r.walletRequestHandler.walletSession();case 88:e.t6=e.sent,e.t7={sessionId:e.t4,chainId:e.t5,session:e.t6},e.t3.notifyOpen.call(e.t3,e.t7);case 91:return e.abrupt("return",!0);case 92:case"end":return e.stop()}}),e,null,[[32,44],[49,56,59,62],[65,77]])})));return function(t){return e.apply(this,arguments)}}(),this.saveTransportSession=function(e){is.getInstance().setItem(us,JSON.stringify(e))},this.getCachedTransportSession=(0,U.Z)((0,L.Z)().mark((function e(){var t;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,is.getInstance().getItem(us);case 2:return t=e.sent,e.prev=3,e.abrupt("return",t?JSON.parse(t):null);case 7:return e.prev=7,e.t0=e.catch(3),console.error("unable to parse transport session: ".concat(t)),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,null,[[3,7]])}))),this.walletRequestHandler=t,this._init=Ia.NIL,this.walletRequestHandler.on("connect",(function(e){n.registered&&n.notifyConnect(e)})),this.walletRequestHandler.on("disconnect",(function(e){n.registered&&n.notifyDisconnect(e)})),this.walletRequestHandler.on("accountsChanged",(function(e,t){n.registered&&n.notifyAccountsChanged(e,t)})),this.walletRequestHandler.on("networks",(function(e){n.registered&&(n.notifyNetworks(e),e&&0!==e.length?n.notifyChainChanged(B.Dv(e.find((function(e){return e.isDefaultChain})).chainId)):n.notifyChainChanged("0x0"))})),this.walletRequestHandler.on("walletContext",(function(e){n.registered&&e&&n.notifyWalletContext(e)})),this.walletRequestHandler.on("close",(function(e){n.registered&&n.notifyClose(e)}))}return(0,b.Z)(e,[{key:"registered",get:function(){return this._registered}},{key:"register",value:function(){throw new Error("abstract method")}},{key:"unregister",value:function(){throw new Error("abstract method")}},{key:"sendMessage",value:function(e){throw new Error("abstract method")}},{key:"notifyOpen",value:function(e){var t=e.chainId,n=e.sessionId,r=e.session,i=e.error;this.sendMessage({idx:-1,type:_a.OPEN,data:{chainId:t,sessionId:n,session:r,error:i}})}},{key:"notifyClose",value:function(e){this.sendMessage({idx:-1,type:_a.CLOSE,data:e?{error:e}:null})}},{key:"notifyConnect",value:function(e){this.sendMessage({idx:-1,type:_a.CONNECT,data:e})}},{key:"notifyDisconnect",value:function(e){this.sendMessage({idx:-1,type:_a.DISCONNECT,data:e?{error:e}:null})}},{key:"notifyAccountsChanged",value:function(e,t){this.sendMessage({idx:-1,type:_a.ACCOUNTS_CHANGED,data:e,origin:t})}},{key:"notifyChainChanged",value:function(e){this.sendMessage({idx:-1,type:_a.CHAIN_CHANGED,data:e})}},{key:"notifyNetworks",value:function(e){this.sendMessage({idx:-1,type:_a.NETWORKS,data:e})}},{key:"notifyWalletContext",value:function(e){this.sendMessage({idx:-1,type:_a.WALLET_CONTEXT,data:e})}},{key:"isValidInitAck",value:function(e){if(this._init===Ia.OK)return ot.warn("isValidInitAck, already in init'd state, so inquiry is invalid."),!1;if(e.type!==_a.INIT)return ot.warn("isValidInitAck, invalid message type, expecting init"),!1;var t=e.data,n=t.sessionId,r=t.nonce;return n&&0!==n.length&&r&&0!==r.length?n===this._sessionId&&r===this._initNonce||(ot.error("invalid init ack match"),!1):(ot.error("invalid init ack"),!1)}},{key:"init",value:function(){var e=this;return new Promise((function(t,n){if(e._init!==Ia.OK)if(e._init!==Ia.NIL||e._initCallback)n("transport init is in progress");else{var r=setTimeout((function(){ot.warn("transport init timed out"),e._initCallback&&e._initCallback("transport init timed out")}),Aa/2);e._initCallback=function(i){e._initCallback=void 0,clearTimeout(r),i?n(i):(e._init=Ia.OK,t())},e._initNonce="".concat(performance.now()),e.sendMessage({idx:-1,type:_a.INIT,data:{nonce:e._initNonce}}),e._init=Ia.SENT_NONCE}else t()}))}}]),e}(),ls=(0,b.Z)((function e(){(0,m.Z)(this,e),this.app=void 0,this.wallet=void 0;var t=new fs,n=new fs;t.conn=n,n.conn=t,this.app=t,this.wallet=n})),fs=function(){function e(){var t=this;(0,m.Z)(this,e),this.conn=void 0,this.events=new xa.EventEmitter2,this.handleMessage=function(e){throw new Error("ProxyMessageChannelPort is not registered")},this.sendMessage=function(e){t.conn.handleMessage(e),"open"===e.type&&t.events.emit("open",e),"close"===e.type&&t.events.emit("close",e),"connect"===e.type&&t.events.emit("connect",e),"disconnect"===e.type&&t.events.emit("disconnect",e)}}return(0,b.Z)(e,[{key:"on",value:function(e,t){this.events.on(e,t)}},{key:"once",value:function(e,t){this.events.once(e,t)}}]),e}(),hs=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;if((0,m.Z)(this,n),(r=t.call(this)).port=void 0,r.register=function(){r.port.handleMessage=function(e){r.handleMessage(e)},r.on("open",(function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=r.port.events).emit.apply(e,["open"].concat(n))})),r.on("close",(function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=r.port.events).emit.apply(e,["close"].concat(n))})),r.on("connect",(function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=r.port.events).emit.apply(e,["connect"].concat(n))})),r.on("disconnect",(function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=r.port.events).emit.apply(e,["disconnect"].concat(n))})),r._registered=!0},r.unregister=function(){r._registered=!1,r.closeWallet(),r.events.removeAllListeners(),r.port.handleMessage=void 0},r.openWallet=function(e,t,n){if(r.state===Sa.CLOSED){r.state=Sa.OPENING;var i="".concat(performance.now());r._sessionId=i,r.sendMessage({idx:-1,type:_a.OPEN,data:{path:e,intent:t,networkId:n,sessionId:i}})}},r.state=Sa.CLOSED,r.port=e,!e)throw new Error("port argument cannot be empty");return r._init=Ia.OK,r}return(0,b.Z)(n,[{key:"closeWallet",value:function(){this.sendMessage({idx:-1,type:_a.CLOSE,data:null}),this.close()}},{key:"sendMessage",value:function(e){if(!e.idx)throw new Error("message idx is empty");this.port.sendMessage(e)}}]),n}(Ma),ds=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;return(0,m.Z)(this,n),(i=t.call(this,e)).port=void 0,i.port=r,i._init=Ia.OK,i}return(0,b.Z)(n,[{key:"register",value:function(){var e=this;this.port.handleMessage=function(t){e.handleMessage(t)},this._registered=!0}},{key:"restoreSession",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){var t;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCachedTransportSession();case 2:(t=e.sent)&&this.open(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unregister",value:function(){this.port.handleMessage=void 0,this._registered=!1}},{key:"sendMessage",value:function(e){this.port.sendMessage(e)}}]),n}(cs),ps=function(){function e(){var t=this;(0,m.Z)(this,e);var n=this;this.messageProviders=void 0,this.provider=void 0,this.register=function(){if(1===t.messageProviders.length)return t.provider=t.messageProviders[0],void t.provider.register();t.messageProviders.forEach((function(e){e.register(),e.once("open",(function(){t.provider||(t.provider=e,t.messageProviders.forEach((function(e){t.provider!==e&&e.unregister()})))}))}))},this.unregister=function(){t.messageProviders.forEach((function(e){return e.unregister()})),t.provider=void 0},this.openWallet=function(e,n,r){t.provider?t.provider.openWallet(e,n,r):t.messageProviders.forEach((function(t){return t.openWallet(e,n,r)}))},this.sendAsync=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,r,i){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.provider){e.next=3;break}return n.provider.sendAsync(t,r,i),e.abrupt("return");case 3:throw new Error("impossible state, wallet must be opened first");case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.sendMessageRequest=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.provider){e.next=2;break}return e.abrupt("return",n.provider.sendMessageRequest(t));case 2:throw new Error("impossible state, wallet must be opened first");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.waitUntilOpened=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.provider){e.next=2;break}return e.abrupt("return",n.provider.waitUntilOpened());case 2:return e.abrupt("return",Promise.race(n.messageProviders.map((function(e){return e.waitUntilOpened()}))));case 3:case"end":return e.stop()}}),e)}))),this.waitUntilConnected=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.provider){e.next=2;break}return e.abrupt("return",n.provider.waitUntilConnected());case 2:throw new Error("impossible state, wallet must be opened first");case 3:case"end":return e.stop()}}),e)})));for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];this.messageProviders=i,this.provider=void 0}return(0,b.Z)(e,[{key:"add",value:function(){var e;(e=this.messageProviders).push.apply(e,arguments)}},{key:"closeWallet",value:function(){this.provider&&this.provider.closeWallet()}},{key:"isOpened",value:function(){return!!this.provider&&this.provider.isOpened()}},{key:"isConnected",value:function(){return!!this.provider&&this.provider.isConnected()}},{key:"on",value:function(e,t){this.provider?this.provider.on(e,t):this.messageProviders.forEach((function(n){n.on(e,t)}))}},{key:"once",value:function(e,t){this.provider?this.provider.once(e,t):this.messageProviders.forEach((function(n){n.once(e,t)}))}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i;if(this.provider)return(i=this.provider).emit.apply(i,[e].concat(n));for(var a=0;a<this.messageProviders.length;a++){var s;(s=this.messageProviders[a]).emit.apply(s,[e].concat(n))}return!0}},{key:"sendMessage",value:function(e){if(!e.idx||e.idx<=0)throw new Error("message idx is empty");if(!this.provider)throw new Error("impossible state, wallet must be opened first");this.provider.sendMessage(e)}},{key:"handleMessage",value:function(e){if(!this.provider)throw new Error("impossible state, wallet must be opened first");this.provider.handleMessage(e)}}]),e}(),vs=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).walletURL=void 0,r.walletWindow=void 0,r.register=function(){as&&(as.unregister(),as=(0,It.Z)(r)),window.addEventListener("message",r.onWindowEvent),as=(0,It.Z)(r),r.on("open",(function(){var e=r.walletWindow,t=setInterval((function(){e&&e.closed&&(clearInterval(t),r.close())}),500)})),r.on("close",(function(){r.walletWindow&&(r.walletWindow.close(),r.walletWindow=null)})),r._registered=!0},r.unregister=function(){r._registered=!1,r.closeWallet(),as===(0,It.Z)(r)&&(as=void 0),window.removeEventListener("message",r.onWindowEvent),r.events.removeAllListeners()},r.openWallet=function(e,t,n){if(r.walletWindow&&r.isOpened())r.walletWindow.focus();else{var i,a,s=new URL(r.walletURL.href),o=new Ta;e&&""!==e&&(s.pathname=e.toLowerCase()),r._init=Ia.NIL,r._sessionId="".concat(performance.now()),o.set("sid",r._sessionId),t&&("connect"===t.type&&(t.options||(t.options={}),ts()||ns()||(t.options.origin=window.location.origin)),o.set("intent",Ye(t))),n&&o.set("net","".concat(n)),ts()?(i=[450,750],a=[Math.abs(window.screen.width/2-i[0]/2),Math.abs(window.screen.height/2-i[1]/2)]):(i=[450,750],a=[Math.abs(window.screenX+window.innerWidth/2-i[0]/2),Math.abs(window.screenY+window.innerHeight/2-i[1]/2)]);var u="toolbar=0,location=0,menubar=0,scrollbars=yes,status=yes"+",width=".concat(i[0],",height=").concat(i[1])+",left=".concat(a[0],",top=").concat(a[1]);s.search=o.toString(),r.walletWindow=window.open(s.href,"sequence.app",u)}},r.onWindowEvent=function(e){if(e.origin===r.walletURL.origin){var t;try{t=JSON.parse(e.data)}catch(n){return}if(!t)throw new Error("ProviderMessage object is empty");r.handleMessage(t)}},r.walletURL=new URL(e),r}return(0,b.Z)(n,[{key:"closeWallet",value:function(){var e;this.close(),null==(e=this.walletWindow)||e.close()}},{key:"sendMessage",value:function(e){if(this.walletWindow){var t="string"!==typeof e?JSON.stringify(e):e;this.walletWindow.postMessage(t,this.walletURL.origin)}else ot.warn("WindowMessageProvider: sendMessage failed as walletWindow is unavailable")}}]),n}(Ma),gs=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r,i;return(0,m.Z)(this,n),r=t.call(this,e),i=(0,It.Z)(r),r.parentWindow=void 0,r._isPopup=!1,r.onWindowEvent=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.origin&&""!==t.origin){e.next=2;break}return e.abrupt("return");case 2:if(!i.appOrigin||t.origin===i.appOrigin){e.next=4;break}return e.abrupt("return");case 4:e.prev=4,n=JSON.parse(t.data),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(4),e.abrupt("return");case 11:if(ot.debug("RECEIVED MESSAGE",n),i._init!==Ia.OK&&i.isValidInitAck(n)&&(i.appOrigin=t.origin),i._init!==Ia.OK||i.appOrigin&&!(i.appOrigin.length<8)){e.next=16;break}return ot.error("impossible state, init.OK and appOrigin required"),e.abrupt("return");case 16:i.handleMessage(n);case 17:case"end":return e.stop()}}),e,null,[[4,8]])})));return function(t){return e.apply(this,arguments)}}(),r.getWindowTransportSession=function(e){var t=new Ta(e);return{sessionId:t.get("sid"),networkId:t.get("net"),intent:Qe(t.get("intent"))}},r._init=Ia.NIL,r}return(0,b.Z)(n,[{key:"register",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a,s=this;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null!==parent.window.opener,this._isPopup=n,!0===n){e.next=4;break}return e.abrupt("return");case 4:if(r=new URL(t||window.location.href),r.pathname,i=r.search,a=this.getWindowTransportSession(i),!!a.sessionId){e.next=11;break}return e.next=10,this.getCachedTransportSession();case 10:a=e.sent;case 11:if(a){e.next=14;break}return ot.error("window session is undefined"),e.abrupt("return");case 14:this.parentWindow=parent.window.opener,window.addEventListener("message",this.onWindowEvent,!1),this._registered=!0,this.open(a).then((function(e){if(!e){var t,n="failed to open to network ".concat(null==(t=a)?void 0:t.networkId);ot.error(n),s.notifyClose({message:n}),window.close()}})).catch((function(e){var t,n="failed to open to network ".concat(null==(t=a)?void 0:t.networkId,", due to: ").concat(e);ot.error(n),s.notifyClose({message:n}),window.close()}));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unregister",value:function(){window.removeEventListener("message",this.onWindowEvent),this._registered=!1}},{key:"sendMessage",value:function(e){var t=JSON.stringify(e);e.type===_a.INIT?this.postMessage(t,!0):this.postMessage(t)}},{key:"isPopup",get:function(){return this._isPopup}},{key:"postMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===t||this._init===Ia.OK?t?this.parentWindow.postMessage(e,"*"):this.appOrigin&&this.appOrigin.length>4?this.parentWindow.postMessage(e,this.appOrigin):ot.error("unable to postMessage as parentOrigin is invalid"):ot.error("impossible state, should not be calling postMessage until inited")}}]),n}(cs),ws="sequence-extension-message-handler",ys=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e,r){var i;return(0,m.Z)(this,n),(i=t.call(this,e)).runtime=r,i.port=void 0,i._init=Ia.OK,i}return(0,b.Z)(n,[{key:"register",value:function(){this._registered=!0,this.port=this.runtime.connect({name:ws})}},{key:"sendMessage",value:function(e){ot.info("[ExtensionMessageHandler send]",e),this.port.postMessage(e)}}]),n}(cs),ms=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).register=function(){r._registered=!0},e.onConnect.addListener((function(e){e.name===ws&&(r._init=Ia.OK,e.onMessage.addListener((function(e){r.handleMessage(e)})))})),r}return(0,b.Z)(n,[{key:"sendMessage",value:function(e){}},{key:"unregister",value:function(){}},{key:"openWallet",value:function(e,t,n){}},{key:"closeWallet",value:function(){}}]),n}(Ma),bs=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r,i;return(0,m.Z)(this,n),r=t.call(this),i=(0,It.Z)(r),r.stream=e,r.responseCallbacks=new Map,r._messageIdx=0,r.nextMessageIdx=function(){return++r._messageIdx},r.handleMessage=function(e){if(e.type&&e.data){ot.info("[received message]",e);var t=e.idx,n=r.responseCallbacks.get(t);switch(t&&r.responseCallbacks.delete(t),e.type){case _a.MESSAGE:if(!n)throw new Error("impossible state");r.emit(_a.MESSAGE,e),n(e.data.error,e);break;case _a.DISCONNECT:case _a.ACCOUNTS_CHANGED:case _a.CHAIN_CHANGED:r.emit(e.type,e.data);break;default:console.error("unknown message type",e)}}},r.sendMessageRequest=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){(!t.idx||t.idx<=0)&&n(new Error("message idx not set"));var r=t.idx;i.responseCallbacks.get(r)?n(new Error("duplicate message idx, should never happen")):i.responseCallbacks.set(r,(function(t,r){if(t)n(t);else{if(!r)throw new Error("no valid response to return");e(r)}})),i.sendMessage(t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.stream.on("data",r.handleMessage),r}return(0,b.Z)(n,[{key:"sendMessage",value:function(e){this.stream.writable||console.error("window post message stream is not writable"),this.stream.write(e)}}]),n}(xa.EventEmitter2);function ks(e){var t;if(null!=(t=window.ue)&&t.sequencewallettransport&&!window.logsOverriddenForUnreal){var n,r=null==(n=window.ue)?void 0:n.sequencewallettransport;console.log=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];r.logfromjs("".concat(e,": ").concat(xs(n)))},console.warn=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];r.warnfromjs("".concat(e,": ").concat(xs(n)))},console.error=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];r.errorfromjs("".concat(e,": ").concat(xs(n)))},window.logsOverriddenForUnreal=!0}}function xs(e){return e.map((function(e){return"object"===typeof e?e instanceof Error?e.message:JSON.stringify(e):String(e)})).join(" ")}var Zs,Cs=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).walletURL=void 0,r.register=function(){var e;ks("dapp"),ss&&(ss.unregister(),ss=(0,It.Z)(r)),null!=(e=window.ue)&&e.sequencewallettransport&&(window.ue.sequencewallettransport.onmessagefromwallet=r.onUnrealCallback),ss=(0,It.Z)(r),r._registered=!0,console.log("registering transport!")},r.unregister=function(){var e,t;r._registered=!1,r.closeWallet(),ss===(0,It.Z)(r)&&(ss=void 0),(null==(e=window.ue)||null==(t=e.sequencewallettransport)?void 0:t.onmessagefromwallet)===r.onUnrealCallback&&delete window.ue.sequencewallettransport.onmessagefromwallet,r.events.removeAllListeners()},r.openWallet=function(e,t,n){if(r.isOpened())console.log("wallet already open!");else{console.log("opening wallet!");var i=new URL(r.walletURL.href),a=new Ta;e&&(i.pathname=e.toLowerCase()),r._init=Ia.NIL,r._sessionId="".concat(performance.now()),a.set("sid",r._sessionId),t&&a.set("intent",Ye(t)),n&&a.set("net","".concat(n)),i.search=a.toString(),console.log("opening wallet to",i.href),window.open(i.href)}},r.onUnrealCallback=function(e){if(!e)throw new Error("ProviderMessage object is empty");r.handleMessage(e)},r.walletURL=new URL(e),r}return(0,b.Z)(n,[{key:"closeWallet",value:function(){this.close()}},{key:"sendMessage",value:function(e){var t,n,r="string"!==typeof e?JSON.stringify(e):e;console.log("Sending message to wallet:",r),null==(t=window.ue)||null==(n=t.sequencewallettransport)||n.sendmessagetowallet(r)}}]),n}(Ma),Es=function(e){(0,w.Z)(n,e);var t=(0,y.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).onMessageFromUnreal=function(e){ot.debug("RECEIVED MESSAGE",e),r.handleMessage(e)},r.getUnrealTransportSession=function(e){var t=new Ta(e);return{sessionId:t.get("sid"),networkId:t.get("net"),intent:Qe(t.get("intent"))}},r._init=Ia.NIL,r}return(0,b.Z)(n,[{key:"register",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r,i,a,s=this;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(null==(n=window.ue)?void 0:n.sequencewallettransport)){e.next=2;break}return e.abrupt("return");case 2:if(ks("wallet"),r=new URL(t||window.location.href),i=r.search,a=this.getUnrealTransportSession(i),!!a.sessionId){e.next=10;break}return e.next=9,this.getCachedTransportSession();case 9:a=e.sent;case 10:if(a){e.next=13;break}return ot.error("unreal session is undefined"),e.abrupt("return");case 13:window.ue.sequencewallettransport.onmessagefromsequencejs=this.onMessageFromUnreal,this._registered=!0,this.open(a).then((function(e){if(!e){var t,n="failed to open to network ".concat(null==(t=a)?void 0:t.networkId);ot.error(n),s.notifyClose({message:n}),window.close()}})).catch((function(e){var t,n="failed to open to network ".concat(null==(t=a)?void 0:t.networkId,", due to: ").concat(e);ot.error(n),s.notifyClose({message:n}),window.close()}));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unregister",value:function(){var e,t;(null==(e=window.ue)||null==(t=e.sequencewallettransport)?void 0:t.onmessagefromsequencejs)===this.onMessageFromUnreal&&delete window.ue.sequencewallettransport.onmessagefromsequencejs,this._registered=!1}},{key:"sendMessage",value:function(e){var t,n;if(e.type===_a.INIT||this._init===Ia.OK){var r=JSON.stringify(e);null==(t=window.ue)||null==(n=t.sequencewallettransport)||n.sendmessagetosequencejs(r)}else ot.error("impossible state, should not be calling postMessage until inited")}}]),n}(cs),_s=function(){function e(t){(0,m.Z)(this,e);var n=this;this.wallet=void 0,this.recoverWalletConfig=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,r,i,a,s){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=s,e.t0){e.next=5;break}return e.next=4,n.wallet.getWalletContext();case 4:e.t0=e.sent;case 5:return s=e.t0,e.abrupt("return",es(t,r,i,a,s));case 7:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}(),this.recoverWalletConfigFromMessage=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,r,i,a,s){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=s,e.t0){e.next=5;break}return e.next=4,n.wallet.getWalletContext();case 4:e.t0=e.sent;case 5:return s=e.t0,e.abrupt("return",es(t,Xe(Ya(r)),i,a,s));case 7:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}(),this.recoverWalletConfigFromTypedData=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,r,i,a,s){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=s,e.t0){e.next=5;break}return e.next=4,n.wallet.getWalletContext();case 4:e.t0=e.sent;case 5:return s=e.t0,e.abrupt("return",es(t,yt(r),i,a,s));case 7:case"end":return e.stop()}}),e)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}(),this.wallet=t}return(0,b.Z)(e,[{key:"signMessage",value:function(e,t,n){var r=this.wallet.getSigner();if(!r)throw new Error("unable to get signer");return r.signMessage(e,t,n)}},{key:"signAuthMessage",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){var r;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wallet.getAuthSigner();case 2:if(r=e.sent){e.next=5;break}throw new Error("unable to get AuthChain signer");case 5:return e.t0=r,e.t1=t,e.next=9,r.getChainId();case 9:return e.t2=e.sent,e.t3=n,e.abrupt("return",e.t0.signMessage.call(e.t0,e.t1,e.t2,e.t3));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"signTypedData",value:function(e,t,n,r,i){var a=this.wallet.getSigner();if(!a)throw new Error("unable to get signer");return a.signTypedData(e,t,n,r,i)}},{key:"signAuthTypedData",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i){var a;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wallet.getAuthSigner();case 2:if(a=e.sent){e.next=5;break}throw new Error("unable to get AuthChain signer");case 5:return e.t0=a,e.t1=t,e.t2=n,e.t3=r,e.next=11,a.getChainId();case 11:return e.t4=e.sent,e.t5=i,e.abrupt("return",e.t0.signTypedData.call(e.t0,e.t1,e.t2,e.t3,e.t4,e.t5));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"isValidSignature",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i,a){var s;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.wallet.getProvider(i)){e.next=3;break}throw new Error("unable to get provider for chainId ".concat(i));case 3:return e.abrupt("return",za(t,n,r,s,i,a));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"isValidMessageSignature",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r,i,a){var s,o,u;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.wallet.getProvider(i)){e.next=3;break}throw new Error("unable to get provider for chainId ".concat(i));case 3:return o=Ya(n),u=Xe(o),e.abrupt("return",za(t,u,r,s,i,a));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()},{key:"isValidTypedDataSignature",value:function(e,t,n,r,i){return this.isValidSignature(e,yt(t),n,r,i)}}]),e}(),Ss=function(){function e(t,n){var r=this;(0,m.Z)(this,e);var i=this;this.utils=void 0,this.config=void 0,this.session=void 0,this.connectedSites=void 0,this.transport=void 0,this.networks=void 0,this.providers=void 0,this.init=function(){var e,t,n,i,a,s,o,u;r.transport.provider||(r.transport.messageProvider=new ps,null!=(e=r.config.transports)&&null!=(t=e.windowTransport)&&t.enabled&&(r.transport.windowMessageProvider=new vs(r.config.walletAppURL),r.transport.messageProvider.add(r.transport.windowMessageProvider)),null!=(n=r.config.transports)&&null!=(i=n.proxyTransport)&&i.enabled&&(r.transport.proxyMessageProvider=new hs(r.config.transports.proxyTransport.appPort),r.transport.messageProvider.add(r.transport.proxyMessageProvider)),null!=(a=r.config.transports)&&null!=(s=a.extensionTransport)&&s.enabled&&(r.transport.extensionMessageProvider=new ms(r.config.transports.extensionTransport.runtime),r.transport.messageProvider.add(r.transport.extensionMessageProvider)),null!=(o=r.config.transports)&&null!=(u=o.unrealTransport)&&u.enabled&&(r.transport.unrealMessageProvider=new Cs(r.config.walletAppURL),r.transport.messageProvider.add(r.transport.unrealMessageProvider)),r.transport.messageProvider.register(),r.transport.allowProvider=hn((function(e){if("sequence_setDefaultNetwork"===e.method)return!0;var t=r.isConnected();if(!t)throw new Error("Sequence: wallet not connected");return t})),r.transport.networkProvider=wn((function(e){return r.networks&&0!==r.networks.length?r.networks.find((function(e){return e.isDefaultChain})).chainId:0})),r.transport.cachedProvider=new dn,r.transport.cachedProvider.onUpdate((function(){r.session||(r.session={providerCache:{}}),r.session.providerCache=r.transport.cachedProvider.getCache(),r.saveSession(r.session)})),r.transport.router=new nn([gn,r.transport.networkProvider,r.transport.allowProvider,vn,r.transport.cachedProvider],r.transport.messageProvider),r.transport.provider=new Da(r.transport.router),r.transport.messageProvider.on("open",(function(e){var t=e.session;t?r.useSession(t,!0):(r.session&&r.session.accountAddress&&r.transport.messageProvider.emit("disconnect"),r.clearSession())})),r.transport.messageProvider.on("accountsChanged",(function(e,t){t?e.length>0&&r.useSession({accountAddress:e[0]},!0):e&&0!==e.length&&""!==e[0]?r.useSession({accountAddress:e[0]},!0):r.clearSession()})),r.transport.messageProvider.on("networks",(function(e){r.useSession({networks:e},!0)})),r.transport.messageProvider.on("walletContext",(function(e){r.useSession({walletContext:e},!0)})))},this.loadSession=(0,U.Z)((0,L.Z)().mark((function e(){var t,n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,is.getInstance().getItem("@sequence.session");case 2:if((t=e.sent)&&""!==t){e.next=5;break}return e.abrupt("return",void 0);case 5:return e.prev=5,(n=JSON.parse(t))&&i.useSession(n,!1),e.abrupt("return",n);case 11:return e.prev=11,e.t0=e.catch(5),ot.warn("loadSession failed, unable to parse session payload from storage."),e.abrupt("return",void 0);case 15:case"end":return e.stop()}}),e,null,[[5,11]])}))),this.connect=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0===(null==t?void 0:t.refresh)&&i.disconnect(),e.t3=i.isConnected(),!e.t3){e.next=6;break}return e.next=5,i.isSiteConnected(null==t?void 0:t.origin);case 5:e.t3=e.sent;case 6:if(e.t2=e.t3,!e.t2){e.next=9;break}e.t2=!!i.session;case 9:if(e.t1=e.t2,!e.t1){e.next=12;break}e.t1=!(null!=t&&t.authorize);case 12:if(e.t0=e.t1,!e.t0){e.next=15;break}e.t0=!(null!=t&&t.askForEmail);case 15:if(!e.t0){e.next=23;break}return e.t4=i.session,e.t5=q,e.next=20,i.getChainId();case 20:return e.t6=e.sent,e.t7=e.t5.hexlify.call(e.t5,e.t6),e.abrupt("return",{connected:!0,session:e.t4,chainId:e.t7});case 23:if(!t){e.next=26;break}if(!t.authorize||t.app&&""!==t.app){e.next=26;break}throw new Error("connecting with 'authorize' option also requires 'app' to be set");case 26:return e.next=28,i.openWallet(void 0,{type:"connect",options:t});case 28:return e.next=30,i.transport.messageProvider.waitUntilConnected().catch((function(e){return e instanceof Error?{connected:!1,error:e.message}:{connected:!1,error:JSON.stringify(e)}}));case 30:if(!(n=e.sent).connected){e.next=38;break}if(!n.session){e.next=37;break}i.useSession(n.session,!0),i.addConnectedSite(null==t?void 0:t.origin),e.next=38;break;case 37:throw new Error("impossible state, connect response is missing session");case 38:return e.abrupt("return",n);case 39:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.authorize=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.connect(Ea({},t,{authorize:!0})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getSession=function(){if(r.isConnected())return r.session},this.getAddress=(0,U.Z)((0,L.Z)().mark((function e(){var t;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isConnected()){e.next=2;break}throw new Error("connect first");case 2:return t=i.getSession(),e.abrupt("return",t.accountAddress);case 4:case"end":return e.stop()}}),e)}))),this.getNetworks=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.isConnected()&&i.networks){e.next=2;break}throw new Error("connect first");case 2:if(!t){e.next=5;break}return n=jt(i.networks,t),e.abrupt("return",n?[n]:[]);case 5:return e.abrupt("return",i.networks);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getChainId=(0,U.Z)((0,L.Z)().mark((function e(){var t;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.networks&&!(i.networks.length<1)){e.next=2;break}throw new Error("networks have not been set by session. connect first.");case 2:if(t=i.networks.find((function(e){return e.isDefaultChain}))){e.next=5;break}throw new Error("networks must have a default chain specified");case 5:return e.abrupt("return",t.chainId);case 6:case"end":return e.stop()}}),e)}))),this.getAuthChainId=(0,U.Z)((0,L.Z)().mark((function e(){var t;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.networks&&!(i.networks.length<1)){e.next=2;break}throw new Error("networks have not been set by session. connect first.");case 2:if(t=i.networks.find((function(e){return e.isAuthChain}))){e.next=5;break}throw new Error("networks must have an auth chain specified");case 5:return e.abrupt("return",t.chainId);case 6:case"end":return e.stop()}}),e)}))),this.openWallet=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n,r){var a;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("connect"===(null==n?void 0:n.type)||i.isConnected()){e.next=2;break}throw new Error("connect first");case 2:if(i.networks&&!(i.networks.length<1)){e.next=6;break}a=i.config.defaultNetworkId,e.next=9;break;case 6:return e.next=8,i.getChainId();case 8:a=e.sent;case 9:return i.transport.messageProvider.openWallet(t,n,r||a),e.next=12,i.transport.messageProvider.waitUntilOpened();case 12:return e.abrupt("return",!0);case 13:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),this.closeWallet=function(){r.transport.messageProvider.closeWallet()},this.saveSession=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ot.debug("wallet provider: saving session"),n=JSON.stringify(t),e.next=4,is.getInstance().setItem("@sequence.session",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.useSession=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n,r=arguments;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!(r.length>1&&void 0!==r[1])||r[1],i.session||(i.session={}),i.config.walletContext?i.session.walletContext=i.config.walletContext:t.walletContext&&(i.session.walletContext=t.walletContext),t.accountAddress&&i.useAccountAddress(t.accountAddress),t.networks&&i.useNetworks(t.networks),t.providerCache&&i.transport.cachedProvider.setCache(t.providerCache),n&&i.saveSession(i.session);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.config=Ea({},Is),n&&(this.config=Ea({},this.config,n)),t?this.config.defaultNetworkId=t:this.config.defaultNetworkId||(this.config.defaultNetworkId="mainnet"),null!=n&&n.localStorage&&is.use(n.localStorage),this.transport={},this.networks=[],this.providers={},this.connectedSites=new os("@sequence.connectedSites",[]),this.utils=new _s(this),this.init()}return(0,b.Z)(e,[{key:"addConnectedSite",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||window.location.origin,e.next=3,this.connectedSites.get();case 3:if(!(n=e.sent)){e.next=10;break}if(!n.includes(t)){e.next=7;break}return e.abrupt("return");case 7:this.connectedSites.set([].concat((0,M.Z)(n),[t])),e.next=11;break;case 10:this.connectedSites.set([t]);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeConnectedSite",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.connectedSites.get();case 2:(n=e.sent)&&this.connectedSites.set(n.filter((function(e){return e!==t})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConnectedSites",value:function(){return this.connectedSites.get()}},{key:"isSiteConnected",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t){var n;return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.connectedSites.get();case 2:return n=e.sent,e.abrupt("return",!!n&&n.includes(t||window.location.origin));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){this.isOpened()&&this.closeWallet(),this.clearSession()}},{key:"getProviderConfig",value:function(){return this.config}},{key:"isOpened",value:function(){return this.transport.messageProvider.isOpened()}},{key:"isConnected",value:function(){return void 0!==this.session&&void 0!==this.session.networks&&this.session.networks.length>0&&void 0!==this.networks&&this.networks.length>0&&!!this.session.accountAddress&&this.session.accountAddress.startsWith("0x")}},{key:"getProvider",value:function(e){if(!this.isConnected()){if(e)throw new Error("session is empty. connect and try again.");return this.transport.provider}var t,n=this.networks.find((function(e){return e.isDefaultChain}));if(e&&!(n=jt(this.networks,e)))throw new Error("network ".concat(e," is not in the network list"));if(this.providers[n.chainId])return this.providers[n.chainId];var r=n.provider?n.provider:new D.r(n.rpcUrl,n.chainId);if(n.isDefaultChain){var i=new nn([gn,vn,new pn({accountAddress:this.session.accountAddress,walletContext:this.session.walletContext}),new mn(this.transport.provider),this.transport.cachedProvider],new cn(r));t=new Da(i,n.chainId)}else{var a=new nn([gn,vn,new pn({accountAddress:this.session.accountAddress,walletContext:this.session.walletContext,chainId:n.chainId}),new mn(this.transport.provider),new dn(n.chainId)],new cn(r));t=new Da(a,n.chainId)}return this.providers[n.chainId]=t,t}},{key:"getAuthProvider",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this.getAuthNetwork();case 3:return e.t1=e.sent.chainId,e.abrupt("return",e.t0.getProvider.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAuthNetwork",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getNetworks();case 2:return e.abrupt("return",e.sent.find((function(e){return e.isAuthChain})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllProviders",value:function(){return this.providers}},{key:"getSigner",value:function(e){return this.getProvider(e).getSigner()}},{key:"getAuthSigner",value:function(){var e=(0,U.Z)((0,L.Z)().mark((function e(){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAuthProvider();case 2:return e.abrupt("return",e.sent.getSigner());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWalletConfig",value:function(e){return this.getSigner().getWalletConfig(e)}},{key:"getWalletState",value:function(e){return this.getSigner().getWalletState(e)}},{key:"getWalletContext",value:function(){return this.getSigner().getWalletContext()}},{key:"isDeployed",value:function(e){return this.getSigner(e).isDeployed()}},{key:"on",value:function(e,t){this.transport.messageProvider.on(e,t)}},{key:"once",value:function(e,t){this.transport.messageProvider.once(e,t)}},{key:"useAccountAddress",value:function(e){this.session||(this.session={}),this.session.accountAddress=We.Kn(e)}},{key:"useNetworks",value:function(e){var t=this;if(this.session||(this.session={}),this.session.networks=e,this.session.networks&&0!==this.session.networks.length)if(this.config.networks||this.config.networkRpcUrl){if(this.networks=e,this.config.networks&&(this.networks=e.map((function(e){return Ea({},e)})),this.config.networks.forEach((function(e){var n=jt(t.networks,e.chainId||e.name);n&&Bt(e,n)})),qt(this.networks,!0)),this.config.networkRpcUrl){var n=this.networks.find((function(e){return e.isDefaultChain}));n&&(n.rpcUrl=this.config.networkRpcUrl)}}else this.networks=e}},{key:"clearSession",value:function(){var e;ot.debug("wallet provider: clearing session"),is.getInstance().removeItem("@sequence.session"),this.session=void 0,this.networks=[],this.providers={},null==(e=this.transport.cachedProvider)||e.clearCache()}}]),e}(),Is={walletAppURL:"https://sequence.app",transports:{windowTransport:{enabled:!0},proxyTransport:{enabled:!1}}},Ts=function(){var e=(0,U.Z)((0,L.Z)().mark((function e(t,n){return(0,L.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Zs&&Zs.isOpened()&&Zs.closeWallet(),Zs=new Ss(t,n),e.next=4,Zs.loadSession();case 4:return e.abrupt("return",Zs);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Os=function(){if(!Zs)throw new Error("Wallet has not been initialized, call sequence.initWallet(network, config) first.");return Zs};function Ns(e,t){return t.forEach((function(t){t&&"string"!==typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var As=Ns({__proto__:null},[r]),Ps=Ns({__proto__:null},[i]),Rs=Ns({__proto__:null},[d]),Ms=Ns({__proto__:null},[u]),Ls=Ns({__proto__:null},[p]),Us=Ns({__proto__:null},[c]),Ds=Ns({__proto__:null},[l]),qs=Ns({__proto__:null},[o]),Ws=Ns({__proto__:null},[s]),Bs=Ns({__proto__:null},[v]),Fs=Ns({__proto__:null},[h]),js=Ns({__proto__:null},[f]),Gs=Ns({__proto__:null,isValidSignature:za,isValidMessageSignature:Qa,isValidTypedDataSignature:Xa,recoverWalletConfig:es,isWalletUpToDate:rs},[a]),Hs=Object.freeze({__proto__:null,abi:As,api:Ps,auth:Rs,config:Ms,guard:Ls,indexer:Us,metadata:Ds,multicall:qs,network:Ws,provider:Bs,relayer:Fs,transactions:js,utils:Gs,initWallet:Ts,getWallet:Os,Wallet:Ss})},78758:function(e,t,n){var r,i=n(54501);!function(a){var s=Object.hasOwnProperty,o=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},u="object"==typeof i&&"function"==typeof i.nextTick,c="function"===typeof Symbol,l="object"===typeof Reflect,f="function"===typeof setImmediate?setImmediate:setTimeout,h=c?l&&"function"===typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function d(){this._events={},this._conf&&p.call(this,this._conf)}function p(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==a&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function v(e,t){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+t+"."),"undefined"!==typeof i&&i.emitWarning){var r=new Error(n);r.name="MaxListenersExceededWarning",r.emitter=this,r.count=e,i.emitWarning(r)}else console.error(n),console.trace&&console.trace()}var g=function(e,t,n){var r=arguments.length;switch(r){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,n];default:for(var i=new Array(r);r--;)i[r]=arguments[r];return i}};function w(e,t){for(var n={},r=e.length,i=t?t.length:0,s=0;s<r;s++)n[e[s]]=s<i?t[s]:a;return n}function y(e,t,n){var r,i;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(n.on||n.off)&&(r=n.on,i=n.off),t.addEventListener?(r=t.addEventListener,i=t.removeEventListener):t.addListener?(r=t.addListener,i=t.removeListener):t.on&&(r=t.on,i=t.off),!r&&!i)throw Error("target does not implement any known event API");if("function"!==typeof r)throw TypeError("on method must be a function");if("function"!==typeof i)throw TypeError("off method must be a function");this._on=r,this._off=i;var a=e._observers;a?a.push(this):e._observers=[this]}function m(e,t,n,r){var i=Object.assign({},t);if(!e)return i;if("object"!==typeof e)throw TypeError("options must be an object");var o,u,c,l=Object.keys(e),f=l.length;function h(e){throw Error('Invalid "'+o+'" option value'+(e?". Reason: "+e:""))}for(var d=0;d<f;d++){if(o=l[d],!r&&!s.call(t,o))throw Error('Unknown "'+o+'" option');(u=e[o])!==a&&(c=n[o],i[o]=c?c(u,h):u)}return i}function b(e,t){return"function"===typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function k(e){var t="value must be type of "+e.join("|"),n=e.length,r=e[0],i=e[1];return 1===n?function(e,n){if(typeof e===r)return e;n(t)}:2===n?function(e,n){var a=typeof e;if(a===r||a===i)return e;n(t)}:function(r,i){for(var a=typeof r,s=n;s-- >0;)if(a===e[s])return r;i(t)}}Object.assign(y.prototype,{subscribe:function(e,t,n){var r=this,i=this._target,a=this._emitter,s=this._listeners,o=function(){var r=g.apply(null,arguments),s={data:r,name:t,original:e};if(n){var o=n.call(i,s);!1!==o&&a.emit.apply(a,[s.name].concat(r))}else a.emit.apply(a,[t].concat(r))};if(s[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,a._newListener&&a._removeListener&&!r._onNewListener?(this._onNewListener=function(n){n===t&&null===s[e]&&(s[e]=o,r._on.call(i,e,o))},a.on("newListener",this._onNewListener),this._onRemoveListener=function(n){n===t&&!a.hasListeners(n)&&s[e]&&(s[e]=null,r._off.call(i,e,o))},s[e]=null,a.on("removeListener",this._onRemoveListener)):(s[e]=o,r._on.call(i,e,o))},unsubscribe:function(e){var t,n,r,i=this,a=this._listeners,s=this._emitter,o=this._off,u=this._target;if(e&&"string"!==typeof e)throw TypeError("event must be a string");function c(){i._onNewListener&&(s.off("newListener",i._onNewListener),s.off("removeListener",i._onRemoveListener),i._onNewListener=null,i._onRemoveListener=null);var e=E.call(s,i);s._observers.splice(e,1)}if(e){if(!(t=a[e]))return;o.call(u,e,t),delete a[e],--this._listenersCount||c()}else{for(r=(n=h(a)).length;r-- >0;)e=n[r],o.call(u,e,a[e]);this._listeners={},this._listenersCount=0,c()}}});var x=k(["function"]),Z=k(["object","function"]);function C(e,t,n){var r,i,a,s=0,o=new e((function(u,c,l){function f(){i&&(i=null),s&&(clearTimeout(s),s=0)}n=m(n,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!==typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),r=!n.overload&&"function"===typeof e.prototype.cancel&&"function"===typeof l;var h=function(e){f(),u(e)},d=function(e){f(),c(e)};r?t(h,d,l):(i=[function(e){d(e||Error("canceled"))}],t(h,d,(function(e){if(a)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!==typeof e)throw TypeError("onCancel callback must be a function");i.push(e)})),a=!0),n.timeout>0&&(s=setTimeout((function(){var e=Error("timeout");e.code="ETIMEDOUT",s=0,o.cancel(e),c(e)}),n.timeout))}));return r||(o.cancel=function(e){if(i){for(var t=i.length,n=1;n<t;n++)i[n](e);i[0](e),i=null}}),o}function E(e){var t=this._observers;if(!t)return-1;for(var n=t.length,r=0;r<n;r++)if(t[r]._target===e)return r;return-1}function _(e,t,n,r,i){if(!n)return null;if(0===r){var a=typeof t;if("string"===a){var s,o,u=0,c=0,l=this.delimiter,f=l.length;if(-1!==(o=t.indexOf(l))){s=new Array(5);do{s[u++]=t.slice(c,o),c=o+f}while(-1!==(o=t.indexOf(l,c)));s[u++]=t.slice(c),t=s,i=u}else t=[t],i=1}else"object"===a?i=t.length:(t=[t],i=1)}var d,p,v,g,w,y,m,b=null,k=t[r],x=t[r+1];if(r===i)n._listeners&&("function"===typeof n._listeners?(e&&e.push(n._listeners),b=[n]):(e&&e.push.apply(e,n._listeners),b=[n]));else{if("*"===k){for(o=(y=h(n)).length;o-- >0;)"_listeners"!==(d=y[o])&&(m=_(e,t,n[d],r+1,i))&&(b?b.push.apply(b,m):b=m);return b}if("**"===k){for((w=r+1===i||r+2===i&&"*"===x)&&n._listeners&&(b=_(e,t,n,i,i)),o=(y=h(n)).length;o-- >0;)"_listeners"!==(d=y[o])&&("*"===d||"**"===d?(n[d]._listeners&&!w&&(m=_(e,t,n[d],i,i))&&(b?b.push.apply(b,m):b=m),m=_(e,t,n[d],r,i)):m=_(e,t,n[d],d===x?r+2:r,i),m&&(b?b.push.apply(b,m):b=m));return b}n[k]&&(b=_(e,t,n[k],r+1,i))}if((p=n["*"])&&_(e,t,p,r+1,i),v=n["**"])if(r<i)for(v._listeners&&_(e,t,v,i,i),o=(y=h(v)).length;o-- >0;)"_listeners"!==(d=y[o])&&(d===x?_(e,t,v[d],r+2,i):d===k?_(e,t,v[d],r+1,i):((g={})[d]=v[d],_(e,t,{"**":g},r+1,i)));else v._listeners?_(e,t,v,i,i):v["*"]&&v["*"]._listeners&&_(e,t,v["*"],i,i);return b}function S(e,t,n){var r,i,a=0,s=0,o=this.delimiter,u=o.length;if("string"===typeof e)if(-1!==(r=e.indexOf(o))){i=new Array(5);do{i[a++]=e.slice(s,r),s=r+u}while(-1!==(r=e.indexOf(o,s)));i[a++]=e.slice(s)}else i=[e],a=1;else i=e,a=e.length;if(a>1)for(r=0;r+1<a;r++)if("**"===i[r]&&"**"===i[r+1])return;var c,l=this.listenerTree;for(r=0;r<a;r++)if(l=l[c=i[r]]||(l[c]={}),r===a-1)return l._listeners?("function"===typeof l._listeners&&(l._listeners=[l._listeners]),n?l._listeners.unshift(t):l._listeners.push(t),!l._listeners.warned&&this._maxListeners>0&&l._listeners.length>this._maxListeners&&(l._listeners.warned=!0,v.call(this,l._listeners.length,c))):l._listeners=t,!0;return!0}function I(e,t,n,r){for(var i,a,s,o,u=h(e),c=u.length,l=e._listeners;c-- >0;)i=e[a=u[c]],s="_listeners"===a?n:n?n.concat(a):[a],o=r||"symbol"===typeof a,l&&t.push(o?s:s.join(this.delimiter)),"object"===typeof i&&I.call(this,i,t,s,o);return t}function T(e){for(var t,n,r,i=h(e),a=i.length;a-- >0;)(t=e[n=i[a]])&&(r=!0,"_listeners"===n||T(t)||delete e[n]);return r}function O(e,t,n){this.emitter=e,this.event=t,this.listener=n}function N(e,t,n){if(!0===n)s=!0;else if(!1===n)r=!0;else{if(!n||"object"!==typeof n)throw TypeError("options should be an object or true");var r=n.async,s=n.promisify,o=n.nextTick,c=n.objectify}if(r||o||s){var l=t,h=t._origin||t;if(o&&!u)throw Error("process.nextTick is not supported");s===a&&(s="AsyncFunction"===t.constructor.name),t=function(){var e=arguments,t=this,n=this.event;return s?o?Promise.resolve():new Promise((function(e){f(e)})).then((function(){return t.event=n,l.apply(t,e)})):(o?i.nextTick:f)((function(){t.event=n,l.apply(t,e)}))},t._async=!0,t._origin=h}return[t,c?new O(this,e,t):this]}function A(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,p.call(this,e)}O.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},A.EventEmitter2=A,A.prototype.listenTo=function(e,t,n){if("object"!==typeof e)throw TypeError("target musts be an object");var r=this;function i(t){if("object"!==typeof t)throw TypeError("events must be an object");var i,a=n.reducers,s=E.call(r,e);i=-1===s?new y(r,e,n):r._observers[s];for(var o,u=h(t),c=u.length,l="function"===typeof a,f=0;f<c;f++)o=u[f],i.subscribe(o,t[o]||o,l?a:a&&a[o])}return n=m(n,{on:a,off:a,reducers:a},{on:x,off:x,reducers:Z}),o(t)?i(w(t)):i("string"===typeof t?w(t.split(/\s+/)):t),this},A.prototype.stopListeningTo=function(e,t){var n=this._observers;if(!n)return!1;var r,i=n.length,a=!1;if(e&&"object"!==typeof e)throw TypeError("target should be an object");for(;i-- >0;)r=n[i],e&&r._target!==e||(r.unsubscribe(t),a=!0);return a},A.prototype.delimiter=".",A.prototype.setMaxListeners=function(e){e!==a&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},A.prototype.getMaxListeners=function(){return this._maxListeners},A.prototype.event="",A.prototype.once=function(e,t,n){return this._once(e,t,!1,n)},A.prototype.prependOnceListener=function(e,t,n){return this._once(e,t,!0,n)},A.prototype._once=function(e,t,n,r){return this._many(e,1,t,n,r)},A.prototype.many=function(e,t,n,r){return this._many(e,t,n,!1,r)},A.prototype.prependMany=function(e,t,n,r){return this._many(e,t,n,!0,r)},A.prototype._many=function(e,t,n,r,i){var a=this;if("function"!==typeof n)throw new Error("many only accepts instances of Function");function s(){return 0===--t&&a.off(e,s),n.apply(this,arguments)}return s._origin=n,this._on(e,s,r,i)},A.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||d.call(this);var e,t,n,r,i,a,s=arguments[0],o=this.wildcard;if("newListener"===s&&!this._newListener&&!this._events.newListener)return!1;if(o&&(e=s,"newListener"!==s&&"removeListener"!==s&&"object"===typeof s)){if(n=s.length,c)for(r=0;r<n;r++)if("symbol"===typeof s[r]){a=!0;break}a||(s=s.join(this.delimiter))}var u,l=arguments.length;if(this._all&&this._all.length)for(r=0,n=(u=this._all.slice()).length;r<n;r++)switch(this.event=s,l){case 1:u[r].call(this,s);break;case 2:u[r].call(this,s,arguments[1]);break;case 3:u[r].call(this,s,arguments[1],arguments[2]);break;default:u[r].apply(this,arguments)}if(o)u=[],_.call(this,u,e,this.listenerTree,0,n);else{if("function"===typeof(u=this._events[s])){switch(this.event=s,l){case 1:u.call(this);break;case 2:u.call(this,arguments[1]);break;case 3:u.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(l-1),i=1;i<l;i++)t[i-1]=arguments[i];u.apply(this,t)}return!0}u&&(u=u.slice())}if(u&&u.length){if(l>3)for(t=new Array(l-1),i=1;i<l;i++)t[i-1]=arguments[i];for(r=0,n=u.length;r<n;r++)switch(this.event=s,l){case 1:u[r].call(this);break;case 2:u[r].call(this,arguments[1]);break;case 3:u[r].call(this,arguments[1],arguments[2]);break;default:u[r].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===s)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},A.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||d.call(this);var e,t,n,r,i,a,s=arguments[0],o=this.wildcard;if("newListener"===s&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(o&&(e=s,"newListener"!==s&&"removeListener"!==s&&"object"===typeof s)){if(r=s.length,c)for(i=0;i<r;i++)if("symbol"===typeof s[i]){t=!0;break}t||(s=s.join(this.delimiter))}var u,l=[],f=arguments.length;if(this._all)for(i=0,r=this._all.length;i<r;i++)switch(this.event=s,f){case 1:l.push(this._all[i].call(this,s));break;case 2:l.push(this._all[i].call(this,s,arguments[1]));break;case 3:l.push(this._all[i].call(this,s,arguments[1],arguments[2]));break;default:l.push(this._all[i].apply(this,arguments))}if(o?(u=[],_.call(this,u,e,this.listenerTree,0)):u=this._events[s],"function"===typeof u)switch(this.event=s,f){case 1:l.push(u.call(this));break;case 2:l.push(u.call(this,arguments[1]));break;case 3:l.push(u.call(this,arguments[1],arguments[2]));break;default:for(n=new Array(f-1),a=1;a<f;a++)n[a-1]=arguments[a];l.push(u.apply(this,n))}else if(u&&u.length){if(u=u.slice(),f>3)for(n=new Array(f-1),a=1;a<f;a++)n[a-1]=arguments[a];for(i=0,r=u.length;i<r;i++)switch(this.event=s,f){case 1:l.push(u[i].call(this));break;case 2:l.push(u[i].call(this,arguments[1]));break;case 3:l.push(u[i].call(this,arguments[1],arguments[2]));break;default:l.push(u[i].apply(this,n))}}else if(!this.ignoreErrors&&!this._all&&"error"===s)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(l)},A.prototype.on=function(e,t,n){return this._on(e,t,!1,n)},A.prototype.prependListener=function(e,t,n){return this._on(e,t,!0,n)},A.prototype.onAny=function(e){return this._onAny(e,!1)},A.prototype.prependAny=function(e){return this._onAny(e,!0)},A.prototype.addListener=A.prototype.on,A.prototype._onAny=function(e,t){if("function"!==typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},A.prototype._on=function(e,t,n,r){if("function"===typeof e)return this._onAny(e,t),this;if("function"!==typeof t)throw new Error("on only accepts instances of Function");this._events||d.call(this);var i,s=this;return r!==a&&(t=(i=N.call(this,e,t,r))[0],s=i[1]),this._newListener&&this.emit("newListener",e,t),this.wildcard?(S.call(this,e,t,n),s):(this._events[e]?("function"===typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,v.call(this,this._events[e].length,e))):this._events[e]=t,s)},A.prototype.off=function(e,t){if("function"!==typeof t)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var i="string"===typeof e?e.split(this.delimiter):e.slice();if(!(r=_.call(this,null,i,this.listenerTree,0)))return this}else{if(!this._events[e])return this;n=this._events[e],r.push({_listeners:n})}for(var a=0;a<r.length;a++){var s=r[a];if(n=s._listeners,o(n)){for(var u=-1,c=0,l=n.length;c<l;c++)if(n[c]===t||n[c].listener&&n[c].listener===t||n[c]._origin&&n[c]._origin===t){u=c;break}if(u<0)continue;return this.wildcard?s._listeners.splice(u,1):this._events[e].splice(u,1),0===n.length&&(this.wildcard?delete s._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete s._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&T(this.listenerTree),this},A.prototype.offAny=function(e){var t,n=0,r=0;if(e&&this._all&&this._all.length>0){for(n=0,r=(t=this._all).length;n<r;n++)if(e===t[n])return t.splice(n,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(n=0,r=t.length;n<r;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},A.prototype.removeListener=A.prototype.off,A.prototype.removeAllListeners=function(e){if(e===a)return!this._events||d.call(this),this;if(this.wildcard){var t,n=_.call(this,null,e,this.listenerTree,0);if(!n)return this;for(t=0;t<n.length;t++)n[t]._listeners=null;this.listenerTree&&T(this.listenerTree)}else this._events&&(this._events[e]=null);return this},A.prototype.listeners=function(e){var t,n,r,i,s,o=this._events;if(e===a){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!o)return[];for(i=(t=h(o)).length,r=[];i-- >0;)"function"===typeof(n=o[t[i]])?r.push(n):r.push.apply(r,n);return r}if(this.wildcard){if(!(s=this.listenerTree))return[];var u=[],c="string"===typeof e?e.split(this.delimiter):e.slice();return _.call(this,u,c,s,0),u}return o&&(n=o[e])?"function"===typeof n?[n]:n:[]},A.prototype.eventNames=function(e){var t=this._events;return this.wildcard?I.call(this,this.listenerTree,[],null,e):t?h(t):[]},A.prototype.listenerCount=function(e){return this.listeners(e).length},A.prototype.hasListeners=function(e){if(this.wildcard){var t=[],n="string"===typeof e?e.split(this.delimiter):e.slice();return _.call(this,t,n,this.listenerTree,0),t.length>0}var r=this._events,i=this._all;return!!(i&&i.length||r&&(e===a?h(r).length:r[e]))},A.prototype.listenersAny=function(){return this._all?this._all:[]},A.prototype.waitFor=function(e,t){var n=this,r=typeof t;return"number"===r?t={timeout:t}:"function"===r&&(t={filter:t}),C((t=m(t,{timeout:0,filter:a,handleError:!1,Promise:Promise,overload:!1},{filter:x,Promise:b})).Promise,(function(r,i,a){function s(){var a=t.filter;if(!a||a.apply(n,arguments))if(n.off(e,s),t.handleError){var o=arguments[0];o?i(o):r(g.apply(null,arguments).slice(1))}else r(g.apply(null,arguments))}a((function(){n.off(e,s)})),n._on(e,s,!1)}),{timeout:t.timeout,overload:t.overload})};var P=A.prototype;Object.defineProperties(A,{defaultMaxListeners:{get:function(){return P._maxListeners},set:function(e){if("number"!==typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");P._maxListeners=e},enumerable:!0},once:{value:function(e,t,n){return C((n=m(n,{Promise:Promise,timeout:0,overload:!1},{Promise:b})).Promise,(function(n,r,i){var a;if("function"===typeof e.addEventListener)return a=function(){n(g.apply(null,arguments))},i((function(){e.removeEventListener(t,a)})),void e.addEventListener(t,a,{once:!0});var s,o=function(){s&&e.removeListener("error",s),n(g.apply(null,arguments))};"error"!==t&&(s=function(n){e.removeListener(t,o),r(n)},e.once("error",s)),i((function(){s&&e.removeListener("error",s),e.removeListener(t,o)})),e.once(t,o)}),{timeout:n.timeout,overload:n.overload})},writable:!0,configurable:!0}}),Object.defineProperties(P,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),(r=function(){return A}.call(t,n,t,e))===a||(e.exports=r)}()}}]);
//# sourceMappingURL=7572.04637634.chunk.js.map